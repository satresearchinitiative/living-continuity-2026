{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///Applications/MAMP/htdocs/35-SAT/SAT/app/api/submit-floor-plan/route.js"],"sourcesContent":["import { Resend } from 'resend';\n\nexport const dynamic = 'force-dynamic';\n\nexport async function POST(request) {\n  try {\n    const formData = await request.formData();\n    const screenshot = formData.get('screenshot');\n\n    if (!screenshot) {\n      return Response.json(\n        { error: 'Screenshot is required' },\n        { status: 400 }\n      );\n    }\n\n    if (!process.env.RESEND_API_KEY) {\n      console.error('RESEND_API_KEY is not configured');\n      return Response.json(\n        { error: 'Email service is not configured' },\n        { status: 500 }\n      );\n    }\n\n    const resend = new Resend(process.env.RESEND_API_KEY);\n\n    const toEmail = process.env.RESEND_FLOOR_PLAN_EMAIL || process.env.RESEND_TO_EMAIL || 'admin@example.com';\n\n    const screenshotBuffer = await screenshot.arrayBuffer();\n    const screenshotBase64 = Buffer.from(screenshotBuffer).toString('base64');\n\n    const result = await resend.emails.send({\n      from: process.env.RESEND_FROM_EMAIL || 'onboarding@resend.dev',\n      to: toEmail,\n      reply_to: process.env.RESEND_REPLY_TO_EMAIL || toEmail,\n      subject: 'New Floor Plan Arrangement Submission',\n      html: `\n        <h2>New Floor Plan Arrangement Submission</h2>\n        <p><strong>Submitted:</strong> ${new Date().toISOString()}</p>\n        <p><strong>Floor Plan:</strong></p>\n        <img src=\"data:image/png;base64,${screenshotBase64}\" alt=\"Floor Plan Arrangement\" style=\"max-width: 100%; height: auto;\" />\n      `,\n      attachments: [\n        {\n          filename: `floor-plan-${Date.now()}.png`,\n          content: screenshotBuffer\n        }\n      ]\n    });\n    \n    return Response.json(\n      { \n        success: true, \n        messageId: result.id,\n        message: 'Floor plan submitted successfully' \n      },\n      { status: 200 }\n    );\n\n  } catch (error) {\n    console.error('Error processing floor plan submission:', error);\n    return Response.json(\n      { \n        error: 'Internal server error',\n        details: error instanceof Error ? error.message : 'Unknown error'\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,UAAU;AAEhB,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,aAAa,SAAS,GAAG,CAAC;QAEhC,IAAI,CAAC,YAAY;YACf,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAyB,GAClC;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;YAC/B,QAAQ,KAAK,CAAC;YACd,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAkC,GAC3C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,SAAS,IAAI,oJAAM,CAAC,QAAQ,GAAG,CAAC,cAAc;QAEpD,MAAM,UAAU,QAAQ,GAAG,CAAC,uBAAuB,IAAI,QAAQ,GAAG,CAAC,eAAe,IAAI;QAEtF,MAAM,mBAAmB,MAAM,WAAW,WAAW;QACrD,MAAM,mBAAmB,OAAO,IAAI,CAAC,kBAAkB,QAAQ,CAAC;QAEhE,MAAM,SAAS,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC;YACtC,MAAM,QAAQ,GAAG,CAAC,iBAAiB,IAAI;YACvC,IAAI;YACJ,UAAU,QAAQ,GAAG,CAAC,qBAAqB,IAAI;YAC/C,SAAS;YACT,MAAM,CAAC;;uCAE0B,EAAE,IAAI,OAAO,WAAW,GAAG;;wCAE1B,EAAE,iBAAiB;MACrD,CAAC;YACD,aAAa;gBACX;oBACE,UAAU,CAAC,WAAW,EAAE,KAAK,GAAG,GAAG,IAAI,CAAC;oBACxC,SAAS;gBACX;aACD;QACH;QAEA,OAAO,SAAS,IAAI,CAClB;YACE,SAAS;YACT,WAAW,OAAO,EAAE;YACpB,SAAS;QACX,GACA;YAAE,QAAQ;QAAI;IAGlB,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,2CAA2C;QACzD,OAAO,SAAS,IAAI,CAClB;YACE,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}