module.exports=[62562,(a,b,c)=>{b.exports=a.x("module",()=>require("module"))},22373,a=>{a.v({bottomButtons:"styles-module-scss-module__dJBWzG__bottomButtons",bottom_bar_wrapper:"styles-module-scss-module__dJBWzG__bottom_bar_wrapper",bottombarbutton:"styles-module-scss-module__dJBWzG__bottombarbutton",box_wrapper:"styles-module-scss-module__dJBWzG__box_wrapper",button:"styles-module-scss-module__dJBWzG__button",button_wrapper:"styles-module-scss-module__dJBWzG__button_wrapper",camera_modal:"styles-module-scss-module__dJBWzG__camera_modal",camera_modal_1:"styles-module-scss-module__dJBWzG__camera_modal_1",center_button:"styles-module-scss-module__dJBWzG__center_button",full:"styles-module-scss-module__dJBWzG__full",half:"styles-module-scss-module__dJBWzG__half",highlightedTerm:"styles-module-scss-module__dJBWzG__highlightedTerm",isDesktop:"styles-module-scss-module__dJBWzG__isDesktop",isMobile:"styles-module-scss-module__dJBWzG__isMobile",left:"styles-module-scss-module__dJBWzG__left",left_wrapper:"styles-module-scss-module__dJBWzG__left_wrapper",modal:"styles-module-scss-module__dJBWzG__modal",optionsbutton:"styles-module-scss-module__dJBWzG__optionsbutton",right:"styles-module-scss-module__dJBWzG__right",small_button:"styles-module-scss-module__dJBWzG__small_button",stoprotationbutton:"styles-module-scss-module__dJBWzG__stoprotationbutton",submenu:"styles-module-scss-module__dJBWzG__submenu",supplementbutton:"styles-module-scss-module__dJBWzG__supplementbutton",title:"styles-module-scss-module__dJBWzG__title",topbar_wrapper:"styles-module-scss-module__dJBWzG__topbar_wrapper",topbar_wrapper_mobile:"styles-module-scss-module__dJBWzG__topbar_wrapper_mobile",visible:"styles-module-scss-module__dJBWzG__visible",wrapper:"styles-module-scss-module__dJBWzG__wrapper"})},578,a=>{a.v({close_button:"style-module-scss-module__CB8I9q__close_button",content:"style-module-scss-module__CB8I9q__content",modal_wrapper:"style-module-scss-module__CB8I9q__modal_wrapper"})},93827,a=>{a.v({camera_modal:"style-module-scss-module__ALzo2W__camera_modal",camera_wrapper:"style-module-scss-module__ALzo2W__camera_wrapper",item:"style-module-scss-module__ALzo2W__item",link:"style-module-scss-module__ALzo2W__link"})},30100,a=>{"use strict";let b,c,d;var e,f,g,h,i,j=a.i(87924),k=a.i(39705),l=a.i(72131),m=a.i(65521),n=a.i(98754),o=a.i(2293),o=o,p=a.i(24042),q=o,r=a.i(35258),s=r,t=a.i(60554);class u extends s.Mesh{constructor(a,b){var c,d;const e=(a=>a&&a.isCubeTexture)(a),f=Math.floor(Math.log2((null!=(d=e?null==(c=a.image[0])?void 0:c.width:a.image.width)?d:1024)/4)),g=Math.pow(2,f),h=3*Math.max(g,112),i=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,j=[e?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/h}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*g)}`,`#define CUBEUV_MAX_MIP ${f}.0`].join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${t.version>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,k={map:{value:a},height:{value:(null==b?void 0:b.height)||15},radius:{value:(null==b?void 0:b.radius)||100}};super(new s.IcosahedronGeometry(1,16),new s.ShaderMaterial({uniforms:k,fragmentShader:j,vertexShader:i,side:s.DoubleSide}))}set radius(a){this.material.uniforms.radius.value=a}get radius(){return this.material.uniforms.radius.value}set height(a){this.material.uniforms.height.value=a}get height(){return this.material.uniforms.height.value}}var v=a.i(18852),w=r;class x extends w.DataTextureLoader{constructor(a){super(a),this.type=w.HalfFloatType}parse(a){let b,c,d,e=function(a,b){switch(a){case 1:throw Error("THREE.RGBELoader: Read Error: "+(b||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(b||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(b||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(b||""))}},f=function(a,b,c){b=b||1024;let d=a.pos,e=-1,f=0,g="",h=String.fromCharCode.apply(null,new Uint16Array(a.subarray(d,d+128)));for(;0>(e=h.indexOf("\n"))&&f<b&&d<a.byteLength;)g+=h,f+=h.length,d+=128,h+=String.fromCharCode.apply(null,new Uint16Array(a.subarray(d,d+128)));return -1<e&&(!1!==c&&(a.pos+=f+e+1),g+h.slice(0,e))},g=new Uint8Array(a);g.pos=0;let h=function(a){let b,c,d=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,g=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,h=/^\s*FORMAT=(\S+)\s*$/,i=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,j={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(a.pos>=a.byteLength)&&(b=f(a))||e(1,"no header found"),(c=b.match(/^#\?(\S+)/))||e(3,"bad initial token"),j.valid|=1,j.programtype=c[1],j.string+=b+"\n";!1!==(b=f(a));){if(j.string+=b+"\n","#"===b.charAt(0)){j.comments+=b+"\n";continue}if((c=b.match(d))&&(j.gamma=parseFloat(c[1])),(c=b.match(g))&&(j.exposure=parseFloat(c[1])),(c=b.match(h))&&(j.valid|=2,j.format=c[1]),(c=b.match(i))&&(j.valid|=4,j.height=parseInt(c[1],10),j.width=parseInt(c[2],10)),2&j.valid&&4&j.valid)break}return 2&j.valid||e(3,"missing format specifier"),4&j.valid||e(3,"missing image size specifier"),j}(g),i=h.width,j=h.height,k=function(a,b,c){if(b<8||b>32767||2!==a[0]||2!==a[1]||128&a[2])return new Uint8Array(a);b!==(a[2]<<8|a[3])&&e(3,"wrong scanline width");let d=new Uint8Array(4*b*c);d.length||e(4,"unable to allocate buffer space");let f=0,g=0,h=4*b,i=new Uint8Array(4),j=new Uint8Array(h),k=c;for(;k>0&&g<a.byteLength;){g+4>a.byteLength&&e(1),i[0]=a[g++],i[1]=a[g++],i[2]=a[g++],i[3]=a[g++],(2!=i[0]||2!=i[1]||(i[2]<<8|i[3])!=b)&&e(3,"bad rgbe scanline format");let c=0,l;for(;c<h&&g<a.byteLength;){let b=(l=a[g++])>128;if(b&&(l-=128),(0===l||c+l>h)&&e(3,"bad scanline data"),b){let b=a[g++];for(let a=0;a<l;a++)j[c++]=b}else j.set(a.subarray(g,g+l),c),c+=l,g+=l}for(let a=0;a<b;a++){let c=0;d[f]=j[a+c],c+=b,d[f+1]=j[a+c],c+=b,d[f+2]=j[a+c],c+=b,d[f+3]=j[a+c],f+=4}k--}return d}(g.subarray(g.pos),i,j);switch(this.type){case w.FloatType:let l=new Float32Array(4*(d=k.length/4));for(let a=0;a<d;a++)!function(a,b,c,d){let e=Math.pow(2,a[b+3]-128)/255;c[d+0]=a[b+0]*e,c[d+1]=a[b+1]*e,c[d+2]=a[b+2]*e,c[d+3]=1}(k,4*a,l,4*a);b=l,c=w.FloatType;break;case w.HalfFloatType:let m=new Uint16Array(4*(d=k.length/4));for(let a=0;a<d;a++)!function(a,b,c,d){let e=Math.pow(2,a[b+3]-128)/255;c[d+0]=w.DataUtils.toHalfFloat(Math.min(a[b+0]*e,65504)),c[d+1]=w.DataUtils.toHalfFloat(Math.min(a[b+1]*e,65504)),c[d+2]=w.DataUtils.toHalfFloat(Math.min(a[b+2]*e,65504)),c[d+3]=w.DataUtils.toHalfFloat(1)}(k,4*a,m,4*a);b=m,c=w.HalfFloatType;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:i,height:j,data:b,header:h.string,gamma:h.gamma,exposure:h.exposure,type:c}}setDataType(a){return this.type=a,this}load(a,b,c,d){return super.load(a,function(a,c){switch(a.type){case w.FloatType:case w.HalfFloatType:"colorSpace"in a?a.colorSpace="srgb-linear":a.encoding=3e3,a.minFilter=w.LinearFilter,a.magFilter=w.LinearFilter,a.generateMipmaps=!1,a.flipY=!0}b&&b(a,c)},c,d)}}var y=r,z=(0,a.i(62562).createRequire)("/");try{d5=z("worker_threads").Worker}catch(a){}var A=d5?function(a,b,c,d,e){var f=!1,g=new d5(a+";var __w=require('worker_threads');__w.parentPort.on('message',function(m){onmessage({data:m})}),postMessage=function(m,t){__w.parentPort.postMessage(m,t)},close=process.exit;self=global",{eval:!0}).on("error",function(a){return e(a,null)}).on("message",function(a){return e(null,a)}).on("exit",function(a){a&&!f&&e(Error("exited with code "+a),null)});return g.postMessage(c,d),g.terminate=function(){return f=!0,d5.prototype.terminate.call(g)},g}:function(a,b,c,d,e){setImmediate(function(){return e(Error("async operations unsupported - update to Node 12+ (or Node 10-11 with the --experimental-worker CLI flag)"),null)});var f=function(){};return{terminate:f,postMessage:f}},B=Uint8Array,C=Uint16Array,D=Uint32Array,E=new B([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),F=new B([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),G=new B([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),H=function(a,b){for(var c=new C(31),d=0;d<31;++d)c[d]=b+=1<<a[d-1];for(var e=new D(c[30]),d=1;d<30;++d)for(var f=c[d];f<c[d+1];++f)e[f]=f-c[d]<<5|d;return[c,e]},I=H(E,2),J=I[0],K=I[1];J[28]=258,K[258]=28;for(var L=H(F,0),M=L[0],N=L[1],O=new C(32768),P=0;P<32768;++P){var Q=(43690&P)>>>1|(21845&P)<<1;Q=(61680&(Q=(52428&Q)>>>2|(13107&Q)<<2))>>>4|(3855&Q)<<4,O[P]=((65280&Q)>>>8|(255&Q)<<8)>>>1}for(var R=function(a,b,c){for(var d,e=a.length,f=0,g=new C(b);f<e;++f)++g[a[f]-1];var h=new C(b);for(f=0;f<b;++f)h[f]=h[f-1]+g[f-1]<<1;if(c){d=new C(1<<b);var i=15-b;for(f=0;f<e;++f)if(a[f])for(var j=f<<4|a[f],k=b-a[f],l=h[a[f]-1]++<<k,m=l|(1<<k)-1;l<=m;++l)d[O[l]>>>i]=j}else for(f=0,d=new C(e);f<e;++f)a[f]&&(d[f]=O[h[a[f]-1]++]>>>15-a[f]);return d},S=new B(288),P=0;P<144;++P)S[P]=8;for(var P=144;P<256;++P)S[P]=9;for(var P=256;P<280;++P)S[P]=7;for(var P=280;P<288;++P)S[P]=8;for(var T=new B(32),P=0;P<32;++P)T[P]=5;var U=R(S,9,0),V=R(S,9,1),W=R(T,5,0),X=R(T,5,1),Y=function(a){for(var b=a[0],c=1;c<a.length;++c)a[c]>b&&(b=a[c]);return b},Z=function(a,b,c){var d=b/8|0;return(a[d]|a[d+1]<<8)>>(7&b)&c},$=function(a,b){var c=b/8|0;return(a[c]|a[c+1]<<8|a[c+2]<<16)>>(7&b)},_=function(a){return(a/8|0)+(7&a&&1)},aa=function(a,b,c){(null==b||b<0)&&(b=0),(null==c||c>a.length)&&(c=a.length);var d=new(a instanceof C?C:a instanceof D?D:B)(c-b);return d.set(a.subarray(b,c)),d},ab=function(a,b,c){var d=a.length;if(!d||c&&!c.l&&d<5)return b||new B(0);var e=!b||c,f=!c||c.i;c||(c={}),b||(b=new B(3*d));var g=function(a){var c=b.length;if(a>c){var d=new B(Math.max(2*c,a));d.set(b),b=d}},h=c.f||0,i=c.p||0,j=c.b||0,k=c.l,l=c.d,m=c.m,n=c.n,o=8*d;do{if(!k){c.f=h=Z(a,i,1);var p=Z(a,i+1,3);if(i+=3,p)if(1==p)k=V,l=X,m=9,n=5;else if(2==p){var q=Z(a,i,31)+257,r=Z(a,i+10,15)+4,s=q+Z(a,i+5,31)+1;i+=14;for(var t=new B(s),u=new B(19),v=0;v<r;++v)u[G[v]]=Z(a,i+3*v,7);i+=3*r;for(var w=Y(u),x=(1<<w)-1,y=R(u,w,1),v=0;v<s;){var z=y[Z(a,i,x)];i+=15&z;var A=z>>>4;if(A<16)t[v++]=A;else{var C=0,D=0;for(16==A?(D=3+Z(a,i,3),i+=2,C=t[v-1]):17==A?(D=3+Z(a,i,7),i+=3):18==A&&(D=11+Z(a,i,127),i+=7);D--;)t[v++]=C}}var H=t.subarray(0,q),I=t.subarray(q);m=Y(H),n=Y(I),k=R(H,m,1),l=R(I,n,1)}else throw"invalid block type";else{var A=_(i)+4,K=a[A-4]|a[A-3]<<8,L=A+K;if(L>d){if(f)throw"unexpected EOF";break}e&&g(j+K),b.set(a.subarray(A,L),j),c.b=j+=K,c.p=i=8*L;continue}if(i>o){if(f)throw"unexpected EOF";break}}e&&g(j+131072);for(var N=(1<<m)-1,O=(1<<n)-1,P=i;;P=i){var C=k[$(a,i)&N],Q=C>>>4;if((i+=15&C)>o){if(f)throw"unexpected EOF";break}if(!C)throw"invalid length/literal";if(Q<256)b[j++]=Q;else if(256==Q){P=i,k=null;break}else{var S=Q-254;if(Q>264){var v=Q-257,T=E[v];S=Z(a,i,(1<<T)-1)+J[v],i+=T}var U=l[$(a,i)&O],W=U>>>4;if(!U)throw"invalid distance";i+=15&U;var I=M[W];if(W>3){var T=F[W];I+=$(a,i)&(1<<T)-1,i+=T}if(i>o){if(f)throw"unexpected EOF";break}e&&g(j+131072);for(var ab=j+S;j<ab;j+=4)b[j]=b[j-I],b[j+1]=b[j+1-I],b[j+2]=b[j+2-I],b[j+3]=b[j+3-I];j=ab}}c.l=k,c.p=P,c.b=j,k&&(h=1,c.m=m,c.d=l,c.n=n)}while(!h)return j==b.length?b:aa(b,0,j)},ac=function(a,b,c){c<<=7&b;var d=b/8|0;a[d]|=c,a[d+1]|=c>>>8},ad=function(a,b,c){c<<=7&b;var d=b/8|0;a[d]|=c,a[d+1]|=c>>>8,a[d+2]|=c>>>16},ae=function(a,b){for(var c=[],d=0;d<a.length;++d)a[d]&&c.push({s:d,f:a[d]});var e=c.length,f=c.slice();if(!e)return[al,0];if(1==e){var g=new B(c[0].s+1);return g[c[0].s]=1,[g,1]}c.sort(function(a,b){return a.f-b.f}),c.push({s:-1,f:25001});var h=c[0],i=c[1],j=0,k=1,l=2;for(c[0]={s:-1,f:h.f+i.f,l:h,r:i};k!=e-1;)h=c[c[j].f<c[l].f?j++:l++],i=c[j!=k&&c[j].f<c[l].f?j++:l++],c[k++]={s:-1,f:h.f+i.f,l:h,r:i};for(var m=f[0].s,d=1;d<e;++d)f[d].s>m&&(m=f[d].s);var n=new C(m+1),o=af(c[k-1],n,0);if(o>b){var d=0,p=0,q=o-b,r=1<<q;for(f.sort(function(a,b){return n[b.s]-n[a.s]||a.f-b.f});d<e;++d){var s=f[d].s;if(n[s]>b)p+=r-(1<<o-n[s]),n[s]=b;else break}for(p>>>=q;p>0;){var t=f[d].s;n[t]<b?p-=1<<b-n[t]++-1:++d}for(;d>=0&&p;--d){var u=f[d].s;n[u]==b&&(--n[u],++p)}o=b}return[new B(n),o]},af=function(a,b,c){return -1==a.s?Math.max(af(a.l,b,c+1),af(a.r,b,c+1)):b[a.s]=c},ag=function(a){for(var b=a.length;b&&!a[--b];);for(var c=new C(++b),d=0,e=a[0],f=1,g=function(a){c[d++]=a},h=1;h<=b;++h)if(a[h]==e&&h!=b)++f;else{if(!e&&f>2){for(;f>138;f-=138)g(32754);f>2&&(g(f>10?f-11<<5|28690:f-3<<5|12305),f=0)}else if(f>3){for(g(e),--f;f>6;f-=6)g(8304);f>2&&(g(f-3<<5|8208),f=0)}for(;f--;)g(e);f=1,e=a[h]}return[c.subarray(0,d),b]},ah=function(a,b){for(var c=0,d=0;d<b.length;++d)c+=a[d]*b[d];return c},ai=function(a,b,c){var d=c.length,e=_(b+2);a[e]=255&d,a[e+1]=d>>>8,a[e+2]=255^a[e],a[e+3]=255^a[e+1];for(var f=0;f<d;++f)a[e+f+4]=c[f];return(e+4+d)*8},aj=function(a,b,c,d,e,f,g,h,i,j,k){ac(b,k++,c),++e[256];for(var l,m,n,o,p=ae(e,15),q=p[0],r=p[1],s=ae(f,15),t=s[0],u=s[1],v=ag(q),w=v[0],x=v[1],y=ag(t),z=y[0],A=y[1],B=new C(19),D=0;D<w.length;++D)B[31&w[D]]++;for(var D=0;D<z.length;++D)B[31&z[D]]++;for(var H=ae(B,7),I=H[0],J=H[1],K=19;K>4&&!I[G[K-1]];--K);var L=j+5<<3,M=ah(e,S)+ah(f,T)+g,N=ah(e,q)+ah(f,t)+g+14+3*K+ah(B,I)+(2*B[16]+3*B[17]+7*B[18]);if(L<=M&&L<=N)return ai(b,k,a.subarray(i,i+j));if(ac(b,k,1+(N<M)),k+=2,N<M){l=R(q,r,0),m=q,n=R(t,u,0),o=t;var O=R(I,J,0);ac(b,k,x-257),ac(b,k+5,A-1),ac(b,k+10,K-4),k+=14;for(var D=0;D<K;++D)ac(b,k+3*D,I[G[D]]);k+=3*K;for(var P=[w,z],Q=0;Q<2;++Q)for(var V=P[Q],D=0;D<V.length;++D){var X=31&V[D];ac(b,k,O[X]),k+=I[X],X>15&&(ac(b,k,V[D]>>>5&127),k+=V[D]>>>12)}}else l=U,m=S,n=W,o=T;for(var D=0;D<h;++D)if(d[D]>255){var X=d[D]>>>18&31;ad(b,k,l[X+257]),k+=m[X+257],X>7&&(ac(b,k,d[D]>>>23&31),k+=E[X]);var Y=31&d[D];ad(b,k,n[Y]),k+=o[Y],Y>3&&(ad(b,k,d[D]>>>5&8191),k+=F[Y])}else ad(b,k,l[d[D]]),k+=m[d[D]];return ad(b,k,l[256]),k+m[256]},ak=new D([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),al=new B(0),am=function(a,b,c,d,e,f){var g=a.length,h=new B(d+g+5*(1+Math.ceil(g/7e3))+e),i=h.subarray(d,h.length-e),j=0;if(!b||g<8)for(var k=0;k<=g;k+=65535){var l=k+65535;l<g?j=ai(i,j,a.subarray(k,l)):(i[k]=f,j=ai(i,j,a.subarray(k,g)))}else{for(var m=ak[b-1],n=m>>>13,o=8191&m,p=(1<<c)-1,q=new C(32768),r=new C(p+1),s=Math.ceil(c/3),t=2*s,u=function(b){return(a[b]^a[b+1]<<s^a[b+2]<<t)&p},v=new D(25e3),w=new C(288),x=new C(32),y=0,z=0,k=0,A=0,G=0,H=0;k<g;++k){var I=u(k),J=32767&k,L=r[I];if(q[J]=L,r[I]=J,G<=k){var M=g-k;if((y>7e3||A>24576)&&M>423){j=aj(a,i,0,v,w,x,z,A,H,k-H,j),A=y=z=0,H=k;for(var O=0;O<286;++O)w[O]=0;for(var O=0;O<30;++O)x[O]=0}var P=2,Q=0,R=o,S=J-L&32767;if(M>2&&I==u(k-S))for(var T=Math.min(n,M)-1,U=Math.min(32767,k),V=Math.min(258,M);S<=U&&--R&&J!=L;){if(a[k+P]==a[k+P-S]){for(var W=0;W<V&&a[k+W]==a[k+W-S];++W);if(W>P){if(P=W,Q=S,W>T)break;for(var X=Math.min(S,W-2),Y=0,O=0;O<X;++O){var Z=k-S+O+32768&32767,$=q[Z],ab=Z-$+32768&32767;ab>Y&&(Y=ab,L=Z)}}}L=q[J=L],S+=J-L+32768&32767}if(Q){v[A++]=0x10000000|K[P]<<18|N[Q];var ac=31&K[P],ad=31&N[Q];z+=E[ac]+F[ad],++w[257+ac],++x[ad],G=k+P,++y}else v[A++]=a[k],++w[a[k]]}}j=aj(a,i,f,v,w,x,z,A,H,k-H,j),!f&&7&j&&(j=ai(i,j+1,al))}return aa(h,0,d+_(j)+e)},an=function(){for(var a=new Int32Array(256),b=0;b<256;++b){for(var c=b,d=9;--d;)c=(1&c&&-0x12477ce0)^c>>>1;a[b]=c}return a}(),ao=function(){var a=-1;return{p:function(b){for(var c=a,d=0;d<b.length;++d)c=an[255&c^b[d]]^c>>>8;a=c},d:function(){return~a}}},ap=function(){var a=1,b=0;return{p:function(c){for(var d=a,e=b,f=c.length,g=0;g!=f;){for(var h=Math.min(g+2655,f);g<h;++g)e+=d+=c[g];d=(65535&d)+15*(d>>16),e=(65535&e)+15*(e>>16)}a=d,b=e},d:function(){return a%=65521,b%=65521,(255&a)<<24|a>>>8<<16|(255&b)<<8|b>>>8}}},aq=function(a,b,c,d,e){return am(a,null==b.level?6:b.level,null==b.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+b.mem,c,d,!e)},ar=function(a,b){var c={};for(var d in a)c[d]=a[d];for(var d in b)c[d]=b[d];return c},as=function(a,b,c){for(var d=a(),e=a.toString(),f=e.slice(e.indexOf("[")+1,e.lastIndexOf("]")).replace(/ /g,"").split(","),g=0;g<d.length;++g){var h=d[g],i=f[g];if("function"==typeof h){b+=";"+i+"=";var j=h.toString();if(h.prototype)if(-1!=j.indexOf("[native code]")){var k=j.indexOf(" ",8)+1;b+=j.slice(k,j.indexOf("(",k))}else for(var l in b+=j,h.prototype)b+=";"+i+".prototype."+l+"="+h.prototype[l].toString();else b+=j}else c[i]=h}return[b,c]},at=[],au=function(a){var b=[];for(var c in a)(a[c]instanceof B||a[c]instanceof C||a[c]instanceof D)&&b.push((a[c]=new a[c].constructor(a[c])).buffer);return b},av=function(a,b,c,d){if(!at[c]){for(var e,f="",g={},h=a.length-1,i=0;i<h;++i)f=(e=as(a[i],f,g))[0],g=e[1];at[c]=as(a[h],f,g)}var j=ar({},at[c][1]);return A(at[c][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+b.toString()+"}",c,j,au(j),d)},aw=function(){return[B,C,D,E,F,G,J,M,V,X,O,R,Y,Z,$,_,aa,ab,aU,aA,aB]},ax=function(){return[B,C,D,E,F,G,K,N,U,S,W,T,O,ak,al,R,ac,ad,ae,af,ag,ah,ai,aj,_,aa,am,aq,aR,aA]},ay=function(){return[aJ,aK]},az=function(){return[aN]},aA=function(a){return postMessage(a,[a.buffer])},aB=function(a){return a&&a.size&&new B(a.size)},aC=function(a){return a.ondata=function(a,b){return postMessage([a,b],[a.buffer])},function(b){return a.push(b.data[0],b.data[1])}},aD=function(a,b,c,d,e){var f,g=av(a,d,e,function(a,c){a?(g.terminate(),b.ondata.call(b,a)):(c[1]&&g.terminate(),b.ondata.call(b,a,c[0],c[1]))});g.postMessage(c),b.push=function(a,c){if(f)throw"stream finished";if(!b.ondata)throw"no stream handler";g.postMessage([a,f=c],[a.buffer])},b.terminate=function(){g.terminate()}},aE=function(a,b){return a[b]|a[b+1]<<8},aF=function(a,b){return(a[b]|a[b+1]<<8|a[b+2]<<16|a[b+3]<<24)>>>0},aG=function(a,b){return aF(a,b)+0x100000000*aF(a,b+4)},aH=function(a,b,c){for(;c;++b)a[b]=c,c>>>=8},aI=function(a,b){var c=b.filename;if(a[0]=31,a[1]=139,a[2]=8,a[8]=b.level<2?4:2*(9==b.level),a[9]=3,0!=b.mtime&&aH(a,4,Math.floor(new Date(b.mtime||Date.now())/1e3)),c){a[3]=8;for(var d=0;d<=c.length;++d)a[d+10]=c.charCodeAt(d)}},aJ=function(a){if(31!=a[0]||139!=a[1]||8!=a[2])throw"invalid gzip data";var b=a[3],c=10;4&b&&(c+=a[10]|(a[11]<<8)+2);for(var d=(b>>3&1)+(b>>4&1);d>0;d-=!a[c++]);return c+(2&b)},aK=function(a){var b=a.length;return(a[b-4]|a[b-3]<<8|a[b-2]<<16|a[b-1]<<24)>>>0},aL=function(a){return 10+(a.filename&&a.filename.length+1||0)},aM=function(a,b){var c=b.level,d=0==c?0:c<6?1:9==c?3:2;a[0]=120,a[1]=d<<6|(d?32-2*d:1)},aN=function(a){if((15&a[0])!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(32&a[1])throw"invalid zlib data: preset dictionaries not supported"};function aO(a,b){return b||"function"!=typeof a||(b=a,a={}),this.ondata=b,a}var aP=function(){function a(a,b){b||"function"!=typeof a||(b=a,a={}),this.ondata=b,this.o=a||{}}return a.prototype.p=function(a,b){this.ondata(aq(a,this.o,0,0,!b),b)},a.prototype.push=function(a,b){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=b,this.p(a,b||!1)},a}(),aQ=function(a,b){aD([ax,function(){return[aC,aP]}],this,aO.call(this,a,b),function(a){onmessage=aC(new aP(a.data))},6)};function aR(a,b){return aq(a,b||{},0,0)}var aS=function(){function a(a){this.s={},this.p=new B(0),this.ondata=a}return a.prototype.e=function(a){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var b=this.p.length,c=new B(b+a.length);c.set(this.p),c.set(a,b),this.p=c},a.prototype.c=function(a){this.d=this.s.i=a||!1;var b=this.s.b,c=ab(this.p,this.o,this.s);this.ondata(aa(c,b,this.s.b),this.d),this.o=aa(c,this.s.b-32768),this.s.b=this.o.length,this.p=aa(this.p,this.s.p/8|0),this.s.p&=7},a.prototype.push=function(a,b){this.e(a),this.c(b)},a}(),aT=function(a){this.ondata=a,aD([aw,function(){return[aC,aS]}],this,0,function(){onmessage=aC(new aS)},7)};function aU(a,b){return ab(a,b)}(function(){function a(a,b){this.c=ao(),this.l=0,this.v=1,aP.call(this,a,b)}a.prototype.push=function(a,b){aP.prototype.push.call(this,a,b)},a.prototype.p=function(a,b){this.c.p(a),this.l+=a.length;var c=aq(a,this.o,this.v&&aL(this.o),b&&8,!b);this.v&&(aI(c,this.o),this.v=0),b&&(aH(c,c.length-8,this.c.d()),aH(c,c.length-4,this.l)),this.ondata(c,b)}})();var aV=function(){function a(a){this.v=1,aS.call(this,a)}return a.prototype.push=function(a,b){if(aS.prototype.e.call(this,a),this.v){var c=this.p.length>3?aJ(this.p):4;if(c>=this.p.length&&!b)return;this.p=this.p.subarray(c),this.v=0}if(b){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}aS.prototype.c.call(this,b)},a}(),aW=function(a){this.ondata=a,aD([aw,ay,function(){return[aC,aS,aV]}],this,0,function(){onmessage=aC(new aV)},9)},aX=(function(){function a(a,b){this.c=ap(),this.v=1,aP.call(this,a,b)}a.prototype.push=function(a,b){aP.prototype.push.call(this,a,b)},a.prototype.p=function(a,b){this.c.p(a);var c=aq(a,this.o,this.v&&2,b&&4,!b);this.v&&(aM(c,this.o),this.v=0),b&&aH(c,c.length-4,this.c.d()),this.ondata(c,b)}}(),function(){function a(a){this.v=1,aS.call(this,a)}return a.prototype.push=function(a,b){if(aS.prototype.e.call(this,a),this.v){if(this.p.length<2&&!b)return;this.p=this.p.subarray(2),this.v=0}if(b){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}aS.prototype.c.call(this,b)},a}()),aY=function(a){this.ondata=a,aD([aw,az,function(){return[aC,aS,aX]}],this,0,function(){onmessage=aC(new aX)},11)};function aZ(a,b){return ab((aN(a),a.subarray(2,-4)),b)}var a$=function(){function a(a){this.G=aV,this.I=aS,this.Z=aX,this.ondata=a}return a.prototype.push=function(a,b){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(a,b);else{if(this.p&&this.p.length){var c=new B(this.p.length+a.length);c.set(this.p),c.set(a,this.p.length)}else this.p=a;if(this.p.length>2){var d=this,e=function(){d.ondata.apply(d,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(e):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(e):new this.Z(e),this.s.push(this.p,b),this.p=null}}},a}();(function(a){this.G=aW,this.I=aT,this.Z=aY,this.ondata=a}).prototype.push=function(a,b){a$.prototype.push.call(this,a,b)};var a_="undefined"!=typeof TextEncoder&&new TextEncoder,a0="undefined"!=typeof TextDecoder&&new TextDecoder,a1=0;try{a0.decode(al,{stream:!0}),a1=1}catch(a){}var a2=function(a){for(var b="",c=0;;){var d=a[c++],e=(d>127)+(d>223)+(d>239);if(c+e>a.length)return[b,aa(a,c-1)];e?3==e?b+=String.fromCharCode(55296|(d=((15&d)<<18|(63&a[c++])<<12|(63&a[c++])<<6|63&a[c++])-65536)>>10,56320|1023&d):1&e?b+=String.fromCharCode((31&d)<<6|63&a[c++]):b+=String.fromCharCode((15&d)<<12|(63&a[c++])<<6|63&a[c++]):b+=String.fromCharCode(d)}};function a3(a,b){if(b){for(var c=new B(a.length),d=0;d<a.length;++d)c[d]=a.charCodeAt(d);return c}if(a_)return a_.encode(a);for(var e=a.length,f=new B(a.length+(a.length>>1)),g=0,h=function(a){f[g++]=a},d=0;d<e;++d){if(g+5>f.length){var i=new B(g+8+(e-d<<1));i.set(f),f=i}var j=a.charCodeAt(d);j<128||b?h(j):(j<2048?h(192|j>>6):(j>55295&&j<57344?(h(240|(j=65536+(1047552&j)|1023&a.charCodeAt(++d))>>18),h(128|j>>12&63)):h(224|j>>12),h(128|j>>6&63)),h(128|63&j))}return aa(f,0,g)}(function(a){this.ondata=a,a1?this.t=new TextDecoder:this.p=al}).prototype.push=function(a,b){if(!this.ondata)throw"no callback";if(b=!!b,this.t){if(this.ondata(this.t.decode(a,{stream:!0}),b),b){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var c=new B(this.p.length+a.length);c.set(this.p),c.set(a,this.p.length);var d=a2(c),e=d[0],f=d[1];if(b){if(f.length)throw"invalid utf-8 data";this.p=null}else this.p=f;this.ondata(e,b)},(function(a){this.ondata=a}).prototype.push=function(a,b){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(a3(a),this.d=b||!1)};var a4=function(a){return 1==a?3:a<6?2:+(9==a)},a5=function(a,b){for(;1!=aE(a,b);b+=4+aE(a,b+2));return[aG(a,b+12),aG(a,b+4),aG(a,b+20)]},a6=function(a){var b=0;if(a)for(var c in a){var d=a[c].length;if(d>65535)throw"extra field too long";b+=d+4}return b},a7=function(a,b,c,d,e,f,g,h){var i=d.length,j=c.extra,k=h&&h.length,l=a6(j);aH(a,b,null!=g?0x2014b50:0x4034b50),b+=4,null!=g&&(a[b++]=20,a[b++]=c.os),a[b]=20,b+=2,a[b++]=c.flag<<1|(null==f&&8),a[b++]=e&&8,a[b++]=255&c.compression,a[b++]=c.compression>>8;var m=new Date(null==c.mtime?Date.now():c.mtime),n=m.getFullYear()-1980;if(n<0||n>119)throw"date not in range 1980-2099";if(aH(a,b,n<<25|m.getMonth()+1<<21|m.getDate()<<16|m.getHours()<<11|m.getMinutes()<<5|m.getSeconds()>>>1),b+=4,null!=f&&(aH(a,b,c.crc),aH(a,b+4,f),aH(a,b+8,c.size)),aH(a,b+12,i),aH(a,b+14,l),b+=16,null!=g&&(aH(a,b,k),aH(a,b+6,c.attrs),aH(a,b+10,g),b+=14),a.set(d,b),b+=i,l)for(var o in j){var p=j[o],q=p.length;aH(a,b,+o),aH(a,b+2,q),a.set(p,b+4),b+=4+q}return k&&(a.set(h,b),b+=k),b},a8=function(a,b,c,d,e){aH(a,b,0x6054b50),aH(a,b+8,c),aH(a,b+10,c),aH(a,b+12,d),aH(a,b+16,e)},a9=function(){function a(a){this.filename=a,this.c=ao(),this.size=0,this.compression=0}return a.prototype.process=function(a,b){this.ondata(null,a,b)},a.prototype.push=function(a,b){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(a),this.size+=a.length,b&&(this.crc=this.c.d()),this.process(a,b||!1)},a}();function ba(a,b){var c=this;b||(b={}),a9.call(this,a),this.d=new aP(b,function(a,b){c.ondata(null,a,b)}),this.compression=8,this.flag=a4(b.level)}function bb(a,b){var c=this;b||(b={}),a9.call(this,a),this.d=new aQ(b,function(a,b,d){c.ondata(a,b,d)}),this.compression=8,this.flag=a4(b.level),this.terminate=this.d.terminate}function bc(a){this.ondata=a,this.u=[],this.d=1}ba.prototype.process=function(a,b){try{this.d.push(a,b)}catch(a){this.ondata(a,null,b)}},ba.prototype.push=function(a,b){a9.prototype.push.call(this,a,b)},bb.prototype.process=function(a,b){this.d.push(a,b)},bb.prototype.push=function(a,b){a9.prototype.push.call(this,a,b)},bc.prototype.add=function(a){var b=this;if(2&this.d)throw"stream finished";var c=a3(a.filename),d=c.length,e=a.comment,f=e&&a3(e),g=d!=a.filename.length||f&&e.length!=f.length,h=d+a6(a.extra)+30;if(d>65535)throw"filename too long";var i=new B(h);a7(i,0,a,c,g);var j=[i],k=function(){for(var a=0,c=j;a<c.length;a++){var d=c[a];b.ondata(null,d,!1)}j=[]},l=this.d;this.d=0;var m=this.u.length,n=ar(a,{f:c,u:g,o:f,t:function(){a.terminate&&a.terminate()},r:function(){if(k(),l){var a=b.u[m+1];a?a.r():b.d=1}l=1}}),o=0;a.ondata=function(c,d,e){if(c)b.ondata(c,d,e),b.terminate();else if(o+=d.length,j.push(d),e){var f=new B(16);aH(f,0,0x8074b50),aH(f,4,a.crc),aH(f,8,o),aH(f,12,a.size),j.push(f),n.c=o,n.b=h+o+16,n.crc=a.crc,n.size=a.size,l&&n.r(),l=1}else l&&k()},this.u.push(n)},bc.prototype.end=function(){var a=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&a.d&&(a.u.splice(-1,1),a.e())},t:function(){}}),this.d=3},bc.prototype.e=function(){for(var a=0,b=0,c=0,d=0,e=this.u;d<e.length;d++){var f=e[d];c+=46+f.f.length+a6(f.extra)+(f.o?f.o.length:0)}for(var g=new B(c+22),h=0,i=this.u;h<i.length;h++){var f=i[h];a7(g,a,f,f.f,f.u,f.c,b,f.o),a+=46+f.f.length+a6(f.extra)+(f.o?f.o.length:0),b+=f.b}a8(g,a,this.u.length,c,b),this.ondata(null,g,!0),this.d=2},bc.prototype.terminate=function(){for(var a=0,b=this.u;a<b.length;a++)b[a].t();this.d=2};var bd=function(){function a(){}return a.prototype.push=function(a,b){this.ondata(null,a,b)},a.compression=0,a}();function be(){var a=this;this.i=new aS(function(b,c){a.ondata(null,b,c)})}function bf(a,b){var c=this;b<32e4?this.i=new aS(function(a,b){c.ondata(null,a,b)}):(this.i=new aT(function(a,b,d){c.ondata(a,b,d)}),this.terminate=this.i.terminate)}function bg(a){this.onfile=a,this.k=[],this.o={0:bd},this.p=al}be.prototype.push=function(a,b){try{this.i.push(a,b)}catch(c){this.ondata(c,a,b)}},be.compression=8,bf.prototype.push=function(a,b){this.i.terminate&&(a=aa(a,0)),this.i.push(a,b)},bf.compression=8,bg.prototype.push=function(a,b){var c=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var d=Math.min(this.c,a.length),e=a.subarray(0,d);if(this.c-=d,this.d?this.d.push(e,!this.c):this.k[0].push(e),(a=a.subarray(d)).length)return this.push(a,b)}else{var f=0,g=0,h=void 0,i=void 0;this.p.length?a.length?((i=new B(this.p.length+a.length)).set(this.p),i.set(a,this.p.length)):i=this.p:i=a;for(var j=i.length,k=this.c,l=k&&this.d,m=this;g<j-4&&"break"!==function(){var a=aF(i,g);if(0x4034b50==a){f=1,h=g,m.d=null,m.c=0;var b=aE(i,g+6),d=aE(i,g+8),e=8&b,l=aE(i,g+26),n=aE(i,g+28);if(j>g+30+l+n){var o,p,q=[];m.k.unshift(q),f=2;var r=aF(i,g+18),s=aF(i,g+22),t=function(a,b){if(b){for(var c="",d=0;d<a.length;d+=16384)c+=String.fromCharCode.apply(null,a.subarray(d,d+16384));return c}if(a0)return a0.decode(a);var e=a2(a),f=e[0];if(e[1].length)throw"invalid utf-8 data";return f}(i.subarray(g+30,g+=30+l),!(2048&b));0xffffffff==r?(r=(o=e?[-2]:a5(i,g))[0],s=o[1]):e&&(r=-1),g+=n,m.c=r;var u={name:t,compression:d,start:function(){if(!u.ondata)throw"no callback";if(r){var a=c.o[d];if(!a)throw"unknown compression type "+d;(p=r<0?new a(t):new a(t,r,s)).ondata=function(a,b,c){u.ondata(a,b,c)};for(var b=0;b<q.length;b++){var e=q[b];p.push(e,!1)}c.k[0]==q&&c.c?c.d=p:p.push(al,!0)}else u.ondata(null,al,!0)},terminate:function(){p&&p.terminate&&p.terminate()}};r>=0&&(u.size=r,u.originalSize=s),m.onfile(u)}return"break"}if(k){if(0x8074b50==a)return h=g+=12+(-2==k&&8),f=3,m.c=0,"break";else if(0x2014b50==a)return h=g-=4,f=3,m.c=0,"break"}}();++g);if(this.p=al,k<0){var n=f?i.subarray(0,h-12-(-2==k&&8)-(0x8074b50==aF(i,h-16)&&4)):i.subarray(0,g);l?l.push(n,!!f):this.k[+(2==f)].push(n)}if(2&f)return this.push(i.subarray(g),b);this.p=i.subarray(g)}if(b){if(this.c)throw"invalid zip file";this.p=null}},bg.prototype.register=function(a){this.o[a.compression]=a};let bh=t.version>=152;class bi extends y.DataTextureLoader{constructor(a){super(a),this.type=y.HalfFloatType}parse(a){let b={l:0,c:0,lc:0};function c(a,c,d,e,f){for(;d<a;)c=c<<8|A(e,f),d+=8;b.l=c>>(d-=a)&(1<<a)-1,b.c=c,b.lc=d}let d=Array(59),e={c:0,lc:0};function f(a,b,c,d){a=a<<8|A(c,d),b+=8,e.c=a,e.lc=b}let g={c:0,lc:0};function h(a,b,c,d,h,i,j,k,l,m){if(a==b){d<8&&(f(c,d,h,j),c=e.c,d=e.lc);var n=c>>(d-=8),n=new Uint8Array([n])[0];if(l.value+n>m)return!1;for(var o=k[l.value-1];n-- >0;)k[l.value++]=o}else{if(!(l.value<m))return!1;k[l.value++]=a}g.c=c,g.lc=d}function i(a){var b=65535&a;return b>32767?b-65536:b}let j={a:0,b:0};function k(a,b){var c=i(a),d=i(b),e=c+(1&d)+(d>>1),f=e-d;j.a=e,j.b=f}function l(a,b){var c=65535&b,d=(65535&a)-(c>>1)&65535;j.a=c+d-32768&65535,j.b=d}function m(a,i,j,k,l,m){var n=j.value,o=z(i,j),p=z(i,j);j.value+=4;var q=z(i,j);if(j.value+=4,o<0||o>=65537||p<0||p>=65537)throw"Something wrong with HUF_ENCSIZE";for(var r=Array(65537),s=Array(16384),t=0;t<16384;t++)s[t]={},s[t].len=0,s[t].lit=0,s[t].p=null;var u=k-(j.value-n);if(!function(a,e,f,g,h,i,j){for(var k=0,l=0;h<=i;h++){if(f.value-f.value>g)return!1;c(6,k,l,a,f);var m=b.l;if(k=b.c,l=b.lc,j[h]=m,63==m){if(f.value-f.value>g)throw"Something wrong with hufUnpackEncTable";c(8,k,l,a,f);var n=b.l+6;if(k=b.c,l=b.lc,h+n>i+1)throw"Something wrong with hufUnpackEncTable";for(;n--;)j[h++]=0;h--}else if(m>=59){var n=m-59+2;if(h+n>i+1)throw"Something wrong with hufUnpackEncTable";for(;n--;)j[h++]=0;h--}}!function(a){for(var b=0;b<=58;++b)d[b]=0;for(var b=0;b<65537;++b)d[a[b]]+=1;for(var c=0,b=58;b>0;--b){var e=c+d[b]>>1;d[b]=c,c=e}for(var b=0;b<65537;++b){var f=a[b];f>0&&(a[b]=f|d[f]++<<6)}}(j)}(a,0,j,u,o,p,r),q>8*(k-(j.value-n)))throw"Something wrong with hufUncompress";!function(a,b,c,d){for(;b<=c;b++){var e=a[b]>>6,f=63&a[b];if(e>>f)throw"Invalid table entry";if(f>14){var g=d[e>>f-14];if(g.len)throw"Invalid table entry";if(g.lit++,g.p){var h=g.p;g.p=Array(g.lit);for(var i=0;i<g.lit-1;++i)g.p[i]=h[i]}else g.p=[,];g.p[g.lit-1]=b}else if(f)for(var j=0,i=1<<14-f;i>0;i--){var g=d[(e<<14-f)+j];if(g.len||g.p)throw"Invalid table entry";g.len=f,g.lit=b,j++}}}(r,o,p,s),function(a,b,c,d,i,j,k,l,m,n){for(var o=0,p=0,q=Math.trunc(i.value+(j+7)/8);i.value<q;)for(f(o,p,c,i),o=e.c,p=e.lc;p>=14;){var r=b[o>>p-14&16383];if(r.len)p-=r.len,h(r.lit,k,o,p,c,d,i,m,n,l),o=g.c,p=g.lc;else{if(!r.p)throw"hufDecode issues";for(s=0;s<r.lit;s++){for(var s,t=63&a[r.p[s]];p<t&&i.value<q;)f(o,p,c,i),o=e.c,p=e.lc;if(p>=t&&a[r.p[s]]>>6==(o>>p-t&(1<<t)-1)){p-=t,h(r.p[s],k,o,p,c,d,i,m,n,l),o=g.c,p=g.lc;break}}if(s==r.lit)throw"hufDecode issues"}}var u=8-j&7;for(o>>=u,p-=u;p>0;){var r=b[o<<14-p&16383];if(r.len)p-=r.len,h(r.lit,k,o,p,c,d,i,m,n,l),o=g.c,p=g.lc;else throw"hufDecode issues"}}(r,s,a,i,j,q,p,m,l,{value:0})}function n(a){for(var b=1;b<a.length;b++){var c=a[b-1]+a[b]-128;a[b]=c}}function o(a,b){for(var c=0,d=Math.floor((a.length+1)/2),e=0,f=a.length-1;!(e>f)&&(b[e++]=a[c++],!(e>f));){;b[e++]=a[d++]}}function p(a){for(var b=a.byteLength,c=[],d=0,e=new DataView(a);b>0;){var f=e.getInt8(d++);if(f<0){var g=-f;b-=g+1;for(var h=0;h<g;h++)c.push(e.getUint8(d++))}else{var g=f;b-=2;for(var i=e.getUint8(d++),h=0;h<g+1;h++)c.push(i)}}return c}function q(a){return new DataView(a.array.buffer,a.offset.value,a.size)}function r(a){var b=new Uint8Array(p(a.viewer.buffer.slice(a.offset.value,a.offset.value+a.size))),c=new Uint8Array(b.length);return n(b),o(b,c),new DataView(c.buffer)}function s(a){var b=aZ(a.array.slice(a.offset.value,a.offset.value+a.size)),c=new Uint8Array(b.length);return n(b),o(b,c),new DataView(c.buffer)}function t(a){for(var b=a.viewer,c={value:a.offset.value},d=new Uint16Array(a.width*a.scanlineBlockSize*(a.channels*a.type)),e=new Uint8Array(8192),f=0,g=Array(a.channels),h=0;h<a.channels;h++)g[h]={},g[h].start=f,g[h].end=g[h].start,g[h].nx=a.width,g[h].ny=a.lines,g[h].size=a.type,f+=g[h].nx*g[h].ny*g[h].size;var i=G(b,c),n=G(b,c);if(n>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(i<=n)for(var h=0;h<n-i+1;h++)e[h+i]=B(b,c);var o=new Uint16Array(65536),p=function(a,b){for(var c=0,d=0;d<65536;++d)(0==d||a[d>>3]&1<<(7&d))&&(b[c++]=d);for(var e=c-1;c<65536;)b[c++]=0;return e}(e,o),q=z(b,c);m(a.array,b,c,q,d,f);for(var h=0;h<a.channels;++h)for(var r=g[h],s=0;s<g[h].size;++s)!function(a,b,c,d,e,f,g){for(var h=g<16384,i=c>e?e:c,m=1;m<=i;)m<<=1;for(m>>=1,n=m,m>>=1;m>=1;){for(var n,o,p,q,r,s=0,t=0+f*(e-n),u=f*m,v=f*n,w=d*m,x=d*n;s<=t;s+=v){for(var y=s,z=s+d*(c-n);y<=z;y+=x){var A=y+w,B=y+u,C=B+w;h?(k(a[y+b],a[B+b]),o=j.a,q=j.b,k(a[A+b],a[C+b]),p=j.a,r=j.b,k(o,p),a[y+b]=j.a,a[A+b]=j.b,k(q,r)):(l(a[y+b],a[B+b]),o=j.a,q=j.b,l(a[A+b],a[C+b]),p=j.a,r=j.b,l(o,p),a[y+b]=j.a,a[A+b]=j.b,l(q,r)),a[B+b]=j.a,a[C+b]=j.b}if(c&m){var B=y+u;h?k(a[y+b],a[B+b]):l(a[y+b],a[B+b]),o=j.a,a[B+b]=j.b,a[y+b]=o}}if(e&m)for(var y=s,z=s+d*(c-n);y<=z;y+=x){var A=y+w;h?k(a[y+b],a[A+b]):l(a[y+b],a[A+b]),o=j.a,a[A+b]=j.b,a[y+b]=o}n=m,m>>=1}}(d,r.start+s,r.nx,r.size,r.ny,r.nx*r.size,p);for(var t=f,u=0;u<t;++u)d[u]=o[d[u]];for(var v=0,w=new Uint8Array(d.buffer.byteLength),x=0;x<a.lines;x++)for(var y=0;y<a.channels;y++){var r=g[y],A=r.nx*r.size,C=new Uint8Array(d.buffer,2*r.end,2*A);w.set(C,v),v+=2*A,r.end+=A}return new DataView(w.buffer)}function u(a){var b=aZ(a.array.slice(a.offset.value,a.offset.value+a.size));let c=a.lines*a.channels*a.width,d=1==a.type?new Uint16Array(c):new Uint32Array(c),e=0,f=0,g=[,,,,];for(let c=0;c<a.lines;c++)for(let c=0;c<a.channels;c++){let c=0;switch(a.type){case 1:g[0]=e,g[1]=g[0]+a.width,e=g[1]+a.width;for(let e=0;e<a.width;++e)c+=b[g[0]++]<<8|b[g[1]++],d[f]=c,f++;break;case 2:g[0]=e,g[1]=g[0]+a.width,g[2]=g[1]+a.width,e=g[2]+a.width;for(let e=0;e<a.width;++e)c+=b[g[0]++]<<24|b[g[1]++]<<16|b[g[2]++]<<8,d[f]=c,f++}}return new DataView(d.buffer)}function v(a){var b=a.viewer,c={value:a.offset.value},d=new Uint8Array(a.width*a.lines*(a.channels*a.type*2)),e={version:C(b,c),unknownUncompressedSize:C(b,c),unknownCompressedSize:C(b,c),acCompressedSize:C(b,c),dcCompressedSize:C(b,c),rleCompressedSize:C(b,c),rleUncompressedSize:C(b,c),rleRawSize:C(b,c),totalAcUncompressedCount:C(b,c),totalDcUncompressedCount:C(b,c),acCompression:C(b,c)};if(e.version<2)throw"EXRLoader.parse: "+L.compression+" version "+e.version+" is unsupported";for(var f=[],g=G(b,c)-2;g>0;){var h=w(b.buffer,c),i=B(b,c),j=i>>2&3,k=new Int8Array([(i>>4)-1])[0],l=B(b,c);f.push({name:h,index:k,type:l,compression:j}),g-=h.length+3}for(var n=L.channels,o=Array(a.channels),q=0;q<a.channels;++q){var r=o[q]={},t=n[q];r.name=t.name,r.compression=0,r.decoded=!1,r.type=t.pixelType,r.pLinear=t.pLinear,r.width=a.width,r.height=a.lines}for(var u={idx:[,,,]},v=0;v<a.channels;++v)for(var r=o[v],q=0;q<f.length;++q){var x=f[q];r.name==x.name&&(r.compression=x.compression,x.index>=0&&(u.idx[x.index]=v),r.offset=v)}if(e.acCompressedSize>0)switch(e.acCompression){case 0:var z=new Uint16Array(e.totalAcUncompressedCount);m(a.array,b,c,e.acCompressedSize,z,e.totalAcUncompressedCount);break;case 1:var A=a.array.slice(c.value,c.value+e.totalAcUncompressedCount),D=aZ(A),z=new Uint16Array(D.buffer);c.value+=e.totalAcUncompressedCount}if(e.dcCompressedSize>0){var E=new Uint16Array(s({array:a.array,offset:c,size:e.dcCompressedSize}).buffer);c.value+=e.dcCompressedSize}if(e.rleRawSize>0){var A=a.array.slice(c.value,c.value+e.rleCompressedSize),D=aZ(A),H=p(D.buffer);c.value+=e.rleCompressedSize}for(var I=0,J=Array(o.length),q=0;q<J.length;++q)J[q]=[];for(var K=0;K<a.lines;++K)for(var M=0;M<o.length;++M)J[M].push(I),I+=o[M].width*a.type*2;!function(a,b,c,d,e,f){var g=new DataView(f.buffer),h=c[a.idx[0]].width,i=c[a.idx[0]].height,j=Math.floor(h/8),k=Math.ceil(h/8),l=Math.ceil(i/8),m=h-(k-1)*8,n=i-(l-1)*8,o={value:0},p=[,,,],q=[,,,],r=[,,,],s=[,,,],t=[,,,];for(let c=0;c<3;++c)t[c]=b[a.idx[c]],p[c]=c<1?0:p[c-1]+k*l,q[c]=new Float32Array(64),r[c]=new Uint16Array(64),s[c]=new Uint16Array(64*k);for(let b=0;b<l;++b){var u,v,w=8;b==l-1&&(w=n);var x=8;for(let a=0;a<k;++a){a==k-1&&(x=m);for(let a=0;a<3;++a){r[a].fill(0),r[a][0]=e[p[a]++],function(a,b,c){for(var d,e=1;e<64;)65280==(d=b[a.value])?e=64:d>>8==255?e+=255&d:(c[e]=d,e++),a.value++}(o,d,r[a]),u=r[a],(v=q[a])[0]=F(u[0]),v[1]=F(u[1]),v[2]=F(u[5]),v[3]=F(u[6]),v[4]=F(u[14]),v[5]=F(u[15]),v[6]=F(u[27]),v[7]=F(u[28]),v[8]=F(u[2]),v[9]=F(u[4]),v[10]=F(u[7]),v[11]=F(u[13]),v[12]=F(u[16]),v[13]=F(u[26]),v[14]=F(u[29]),v[15]=F(u[42]),v[16]=F(u[3]),v[17]=F(u[8]),v[18]=F(u[12]),v[19]=F(u[17]),v[20]=F(u[25]),v[21]=F(u[30]),v[22]=F(u[41]),v[23]=F(u[43]),v[24]=F(u[9]),v[25]=F(u[11]),v[26]=F(u[18]),v[27]=F(u[24]),v[28]=F(u[31]),v[29]=F(u[40]),v[30]=F(u[44]),v[31]=F(u[53]),v[32]=F(u[10]),v[33]=F(u[19]),v[34]=F(u[23]),v[35]=F(u[32]),v[36]=F(u[39]),v[37]=F(u[45]),v[38]=F(u[52]),v[39]=F(u[54]),v[40]=F(u[20]),v[41]=F(u[22]),v[42]=F(u[33]),v[43]=F(u[38]),v[44]=F(u[46]),v[45]=F(u[51]),v[46]=F(u[55]),v[47]=F(u[60]),v[48]=F(u[21]),v[49]=F(u[34]),v[50]=F(u[37]),v[51]=F(u[47]),v[52]=F(u[50]),v[53]=F(u[56]),v[54]=F(u[59]),v[55]=F(u[61]),v[56]=F(u[35]),v[57]=F(u[36]),v[58]=F(u[48]),v[59]=F(u[49]),v[60]=F(u[57]),v[61]=F(u[58]),v[62]=F(u[62]),v[63]=F(u[63]),function(a){let b=.5*Math.cos(3.14159/16),c=.5*Math.cos(3.14159/8),d=.5*Math.cos(3*3.14159/16),e=.5*Math.cos(3*3.14159/8);for(var f=[,,,,],g=[,,,,],h=[,,,,],i=[,,,,],j=0;j<8;++j){var k=8*j;f[0]=c*a[k+2],f[1]=e*a[k+2],f[2]=c*a[k+6],f[3]=e*a[k+6],g[0]=b*a[k+1]+d*a[k+3]+.2777854612564676*a[k+5]+.09754573032714427*a[k+7],g[1]=d*a[k+1]-.09754573032714427*a[k+3]-b*a[k+5]-.2777854612564676*a[k+7],g[2]=.2777854612564676*a[k+1]-b*a[k+3]+.09754573032714427*a[k+5]+d*a[k+7],g[3]=.09754573032714427*a[k+1]-.2777854612564676*a[k+3]+d*a[k+5]-b*a[k+7],h[0]=.35355362513961314*(a[k+0]+a[k+4]),h[3]=.35355362513961314*(a[k+0]-a[k+4]),h[1]=f[0]+f[3],h[2]=f[1]-f[2],i[0]=h[0]+h[1],i[1]=h[3]+h[2],i[2]=h[3]-h[2],i[3]=h[0]-h[1],a[k+0]=i[0]+g[0],a[k+1]=i[1]+g[1],a[k+2]=i[2]+g[2],a[k+3]=i[3]+g[3],a[k+4]=i[3]-g[3],a[k+5]=i[2]-g[2],a[k+6]=i[1]-g[1],a[k+7]=i[0]-g[0]}for(var l=0;l<8;++l)f[0]=c*a[16+l],f[1]=e*a[16+l],f[2]=c*a[48+l],f[3]=e*a[48+l],g[0]=b*a[8+l]+d*a[24+l]+.2777854612564676*a[40+l]+.09754573032714427*a[56+l],g[1]=d*a[8+l]-.09754573032714427*a[24+l]-b*a[40+l]-.2777854612564676*a[56+l],g[2]=.2777854612564676*a[8+l]-b*a[24+l]+.09754573032714427*a[40+l]+d*a[56+l],g[3]=.09754573032714427*a[8+l]-.2777854612564676*a[24+l]+d*a[40+l]-b*a[56+l],h[0]=.35355362513961314*(a[l]+a[32+l]),h[3]=.35355362513961314*(a[l]-a[32+l]),h[1]=f[0]+f[3],h[2]=f[1]-f[2],i[0]=h[0]+h[1],i[1]=h[3]+h[2],i[2]=h[3]-h[2],i[3]=h[0]-h[1],a[0+l]=i[0]+g[0],a[8+l]=i[1]+g[1],a[16+l]=i[2]+g[2],a[24+l]=i[3]+g[3],a[32+l]=i[3]-g[3],a[40+l]=i[2]-g[2],a[48+l]=i[1]-g[1],a[56+l]=i[0]-g[0]}(q[a])}for(var z=q,A=0;A<64;++A){var B=z[0][A],C=z[1][A],D=z[2][A];z[0][A]=B+1.5747*D,z[1][A]=B-.1873*C-.4682*D,z[2][A]=B+1.8556*C}for(let b=0;b<3;++b)!function(a,b,c){for(var d,e=0;e<64;++e){b[c+e]=y.DataUtils.toHalfFloat((d=a[e])<=1?Math.sign(d)*Math.pow(Math.abs(d),2.2):Math.sign(d)*Math.pow(9.025013291561939,Math.abs(d)-1))}}(q[b],s[b],64*a)}let f=0;for(let d=0;d<3;++d){let e=c[a.idx[d]].type;for(let a=8*b;a<8*b+w;++a){f=t[d][a];for(let b=0;b<j;++b){let c=64*b+(7&a)*8;g.setUint16(f+0*e,s[d][c+0],!0),g.setUint16(f+2*e,s[d][c+1],!0),g.setUint16(f+4*e,s[d][c+2],!0),g.setUint16(f+6*e,s[d][c+3],!0),g.setUint16(f+8*e,s[d][c+4],!0),g.setUint16(f+10*e,s[d][c+5],!0),g.setUint16(f+12*e,s[d][c+6],!0),g.setUint16(f+14*e,s[d][c+7],!0),f+=16*e}}if(j!=k)for(let a=8*b;a<8*b+w;++a){let b=t[d][a]+8*j*2*e,c=64*j+(7&a)*8;for(let a=0;a<x;++a)g.setUint16(b+2*a*e,s[d][c+a],!0)}}}for(var E=new Uint16Array(h),g=new DataView(f.buffer),G=0;G<3;++G){c[a.idx[G]].decoded=!0;var H=c[a.idx[G]].type;if(2==c[G].type)for(var I=0;I<i;++I){let a=t[G][I];for(var J=0;J<h;++J)E[J]=g.getUint16(a+2*J*H,!0);for(var J=0;J<h;++J)g.setFloat32(a+2*J*H,F(E[J]),!0)}}}(u,J,o,z,E,d);for(var q=0;q<o.length;++q){var r=o[q];if(!r.decoded)if(2===r.compression)for(var N=0,O=0,K=0;K<a.lines;++K){for(var P=J[q][N],Q=0;Q<r.width;++Q){for(var R=0;R<2*r.type;++R)d[P++]=H[O+R*r.width*r.height];O++}N++}else throw"EXRLoader.parse: unsupported channel compression"}return new DataView(d.buffer)}function w(a,b){for(var c=new Uint8Array(a),d=0;0!=c[b.value+d];)d+=1;var e=new TextDecoder().decode(c.slice(b.value,b.value+d));return b.value=b.value+d+1,e}function x(a,b){var c=a.getInt32(b.value,!0);return b.value=b.value+4,c}function z(a,b){var c=a.getUint32(b.value,!0);return b.value=b.value+4,c}function A(a,b){var c=a[b.value];return b.value=b.value+1,c}function B(a,b){var c=a.getUint8(b.value);return b.value=b.value+1,c}let C=function(a,b){let c;return c="getBigInt64"in DataView.prototype?Number(a.getBigInt64(b.value,!0)):a.getUint32(b.value+4,!0)+Number(a.getUint32(b.value,!0)<<32),b.value+=8,c};function D(a,b){var c=a.getFloat32(b.value,!0);return b.value+=4,c}function E(a,b){return y.DataUtils.toHalfFloat(D(a,b))}function F(a){var b=(31744&a)>>10,c=1023&a;return(a>>15?-1:1)*(b?31===b?c?NaN:1/0:Math.pow(2,b-15)*(1+c/1024):c/1024*6103515625e-14)}function G(a,b){var c=a.getUint16(b.value,!0);return b.value+=2,c}function H(a,b){return F(G(a,b))}let I=new DataView(a),J=new Uint8Array(a),K={value:0},L=function(a,b,c){let d={};if(0x1312f76!=a.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";d.version=a.getUint8(4);let e=a.getUint8(5);d.spec={singleTile:!!(2&e),longName:!!(4&e),deepFormat:!!(8&e),multiPart:!!(16&e)},c.value=8;for(var f=!0;f;){var g=w(b,c);if(0==g)f=!1;else{var h=w(b,c),i=z(a,c),j=function(a,b,c,d,e){var f,g,h,i,j,k,l;if("string"===d||"stringvector"===d||"iccProfile"===d)return f=new TextDecoder().decode(new Uint8Array(b).slice(c.value,c.value+e)),c.value=c.value+e,f;if("chlist"===d)return function(a,b,c,d){for(var e=c.value,f=[];c.value<e+d-1;){var g=w(b,c),h=x(a,c),i=B(a,c);c.value+=3;var j=x(a,c),k=x(a,c);f.push({name:g,pixelType:h,pLinear:i,xSampling:j,ySampling:k})}return c.value+=1,f}(a,b,c,e);if("chromaticities"===d)return g=D(a,c),h=D(a,c),i=D(a,c),j=D(a,c),k=D(a,c),{redX:g,redY:h,greenX:i,greenY:j,blueX:k,blueY:D(a,c),whiteX:D(a,c),whiteY:D(a,c)};if("compression"===d)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][B(a,c)];if("box2i"===d)return l=z(a,c),{xMin:l,yMin:z(a,c),xMax:z(a,c),yMax:z(a,c)};else if("lineOrder"===d)return["INCREASING_Y"][B(a,c)];else if("float"===d)return D(a,c);else if("v2f"===d)return[D(a,c),D(a,c)];else if("v3f"===d)return[D(a,c),D(a,c),D(a,c)];else if("int"===d)return x(a,c);else if("rational"===d)return[x(a,c),z(a,c)];else if("timecode"===d)return[z(a,c),z(a,c)];else return"preview"===d?(c.value+=e,"skipped"):(c.value+=e,void 0)}(a,b,c,h,i);void 0===j?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${h}'.`):d[g]=j}}if((-5&e)!=0)throw console.error("EXRHeader:",d),"THREE.EXRLoader: provided file is currently unsupported.";return d}(I,a,K),M=function(a,b,c,d,e){let f={size:0,viewer:b,array:c,offset:d,width:a.dataWindow.xMax-a.dataWindow.xMin+1,height:a.dataWindow.yMax-a.dataWindow.yMin+1,channels:a.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:a.channels[0].pixelType,uncompress:null,getter:null,format:null,[bh?"colorSpace":"encoding"]:null};switch(a.compression){case"NO_COMPRESSION":f.lines=1,f.uncompress=q;break;case"RLE_COMPRESSION":f.lines=1,f.uncompress=r;break;case"ZIPS_COMPRESSION":f.lines=1,f.uncompress=s;break;case"ZIP_COMPRESSION":f.lines=16,f.uncompress=s;break;case"PIZ_COMPRESSION":f.lines=32,f.uncompress=t;break;case"PXR24_COMPRESSION":f.lines=16,f.uncompress=u;break;case"DWAA_COMPRESSION":f.lines=32,f.uncompress=v;break;case"DWAB_COMPRESSION":f.lines=256,f.uncompress=v;break;default:throw"EXRLoader.parse: "+a.compression+" is unsupported"}if(f.scanlineBlockSize=f.lines,1==f.type)switch(e){case y.FloatType:f.getter=H,f.inputSize=2;break;case y.HalfFloatType:f.getter=G,f.inputSize=2}else if(2==f.type)switch(e){case y.FloatType:f.getter=D,f.inputSize=4;break;case y.HalfFloatType:f.getter=E,f.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+f.type+" for "+a.compression+".";f.blockCount=(a.dataWindow.yMax+1)/f.scanlineBlockSize;for(var g=0;g<f.blockCount;g++)C(b,d);f.outputChannels=3==f.channels?4:f.channels;let h=f.width*f.height*f.outputChannels;switch(e){case y.FloatType:f.byteArray=new Float32Array(h),f.channels<f.outputChannels&&f.byteArray.fill(1,0,h);break;case y.HalfFloatType:f.byteArray=new Uint16Array(h),f.channels<f.outputChannels&&f.byteArray.fill(15360,0,h);break;default:console.error("THREE.EXRLoader: unsupported type: ",e)}return f.bytesPerLine=f.width*f.inputSize*f.channels,4==f.outputChannels?f.format=y.RGBAFormat:f.format=y.RedFormat,bh?f.colorSpace="srgb-linear":f.encoding=3e3,f}(L,I,J,K,this.type),N={value:0},O={R:0,G:1,B:2,A:3,Y:0};for(let a=0;a<M.height/M.scanlineBlockSize;a++){let b=z(I,K);M.size=z(I,K),M.lines=b+M.scanlineBlockSize>M.height?M.height-b:M.scanlineBlockSize;let c=M.size<M.lines*M.bytesPerLine?M.uncompress(M):q(M);K.value+=M.size;for(let b=0;b<M.scanlineBlockSize;b++){let d=b+a*M.scanlineBlockSize;if(d>=M.height)break;for(let a=0;a<M.channels;a++){let e=O[L.channels[a].name];for(let f=0;f<M.width;f++){N.value=(b*(M.channels*M.width)+a*M.width+f)*M.inputSize;let g=(M.height-1-d)*(M.width*M.outputChannels)+f*M.outputChannels+e;M.byteArray[g]=M.getter(c,N)}}}}return{header:L,width:M.width,height:M.height,data:M.byteArray,format:M.format,[bh?"colorSpace":"encoding"]:M[bh?"colorSpace":"encoding"],type:this.type}}setDataType(a){return this.type=a,this}load(a,b,c,d){return super.load(a,function(a,c){bh?a.colorSpace=c.colorSpace:a.encoding=c.encoding,a.minFilter=y.LinearFilter,a.magFilter=y.LinearFilter,a.generateMipmaps=!1,a.flipY=!1,b&&b(a,c)},c,d)}}var bj=a.i(66110);let bk=(a,b,c)=>{let d;switch(a){case r.UnsignedByteType:d=new Uint8ClampedArray(b*c*4);break;case r.HalfFloatType:d=new Uint16Array(b*c*4);break;case r.UnsignedIntType:d=new Uint32Array(b*c*4);break;case r.ByteType:d=new Int8Array(b*c*4);break;case r.ShortType:d=new Int16Array(b*c*4);break;case r.IntType:d=new Int32Array(b*c*4);break;case r.FloatType:d=new Float32Array(b*c*4);break;default:throw Error("Unsupported data type")}return d};class bl{constructor(a){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,s;this._rendererIsDisposable=!1,this._supportsReadPixels=!0,this.render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(a){throw this._renderer.setRenderTarget(null),a}this._renderer.setRenderTarget(null)},this._width=a.width,this._height=a.height,this._type=a.type,this._colorSpace=a.colorSpace;const t={format:r.RGBAFormat,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:(null==(c=a.renderTargetOptions)?void 0:c.anisotropy)!==void 0?null==(d=a.renderTargetOptions)?void 0:d.anisotropy:1,generateMipmaps:(null==(e=a.renderTargetOptions)?void 0:e.generateMipmaps)!==void 0&&(null==(f=a.renderTargetOptions)?void 0:f.generateMipmaps),magFilter:(null==(g=a.renderTargetOptions)?void 0:g.magFilter)!==void 0?null==(h=a.renderTargetOptions)?void 0:h.magFilter:r.LinearFilter,minFilter:(null==(i=a.renderTargetOptions)?void 0:i.minFilter)!==void 0?null==(j=a.renderTargetOptions)?void 0:j.minFilter:r.LinearFilter,samples:(null==(k=a.renderTargetOptions)?void 0:k.samples)!==void 0?null==(l=a.renderTargetOptions)?void 0:l.samples:void 0,wrapS:(null==(m=a.renderTargetOptions)?void 0:m.wrapS)!==void 0?null==(n=a.renderTargetOptions)?void 0:n.wrapS:r.ClampToEdgeWrapping,wrapT:(null==(o=a.renderTargetOptions)?void 0:o.wrapT)!==void 0?null==(p=a.renderTargetOptions)?void 0:p.wrapT:r.ClampToEdgeWrapping};if(this._material=a.material,a.renderer?this._renderer=a.renderer:(this._renderer=bl.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new r.Scene,this._camera=new r.OrthographicCamera,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((a,c,d,e)=>{if(void 0!==b)return b;let f=new r.WebGLRenderTarget(1,1,e);c.setRenderTarget(f);let g=new r.Mesh(new r.PlaneGeometry,new r.MeshBasicMaterial({color:0xffffff}));c.render(g,d),c.setRenderTarget(null);let h=bk(a,f.width,f.height);return c.readRenderTargetPixels(f,0,0,f.width,f.height,h),f.dispose(),g.geometry.dispose(),g.material.dispose(),b=0!==h[0]})(this._type,this._renderer,this._camera,t)){let a;this._type===r.HalfFloatType&&(a=this._renderer.extensions.has("EXT_color_buffer_float")?r.FloatType:void 0),void 0!==a?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${r.FloatType}`),this._type=a):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new r.Mesh(new r.PlaneGeometry,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new r.WebGLRenderTarget(this.width,this.height,t),this._renderTarget.texture.mapping=(null==(q=a.renderTargetOptions)?void 0:q.mapping)!==void 0?null==(s=a.renderTargetOptions)?void 0:s.mapping:r.UVMapping}static instantiateRenderer(){let a=new bj.WebGLRenderer;return a.setSize(128,128),a}toArray(){if(!this._supportsReadPixels)throw Error("Can't read pixels in this browser");let a=bk(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,a),a}toDataTexture(a){let b=new r.DataTexture(this.toArray(),this.width,this.height,r.RGBAFormat,this._type,(null==a?void 0:a.mapping)||r.UVMapping,(null==a?void 0:a.wrapS)||r.ClampToEdgeWrapping,(null==a?void 0:a.wrapT)||r.ClampToEdgeWrapping,(null==a?void 0:a.magFilter)||r.LinearFilter,(null==a?void 0:a.minFilter)||r.LinearFilter,(null==a?void 0:a.anisotropy)||1,r.LinearSRGBColorSpace);return b.generateMipmaps=(null==a?void 0:a.generateMipmaps)!==void 0&&(null==a?void 0:a.generateMipmaps),b}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(a){this.disposeOnDemandRenderer(),a&&this.renderTarget.dispose(),this.material instanceof r.ShaderMaterial&&Object.values(this.material.uniforms).forEach(a=>{a.value instanceof r.Texture&&a.value.dispose()}),Object.values(this.material).forEach(a=>{a instanceof r.Texture&&a.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(a){this._width=a,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(a){this._height=a,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(a){this._renderTarget=a,this._width=a.width,this._height=a.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}var bm=r;let bn=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,bo=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class bp extends bm.ShaderMaterial{constructor({gamma:a,offsetHdr:b,offsetSdr:c,gainMapMin:d,gainMapMax:e,maxDisplayBoost:f,hdrCapacityMin:g,hdrCapacityMax:h,sdr:i,gainMap:j}){super({name:"GainMapDecoderMaterial",vertexShader:bn,fragmentShader:bo,uniforms:{sdr:{value:i},gainMap:{value:j},gamma:{value:new bm.Vector3(1/a[0],1/a[1],1/a[2])},offsetHdr:{value:new bm.Vector3().fromArray(b)},offsetSdr:{value:new bm.Vector3().fromArray(c)},gainMapMin:{value:new bm.Vector3().fromArray(d)},gainMapMax:{value:new bm.Vector3().fromArray(e)},weightFactor:{value:(Math.log2(f)-g)/(h-g)}},blending:bm.NoBlending,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=f,this._hdrCapacityMin=g,this._hdrCapacityMax=h,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(a){this.uniforms.sdr.value=a}get gainMap(){return this.uniforms.gainMap.value}set gainMap(a){this.uniforms.gainMap.value=a}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(a){this.uniforms.offsetHdr.value.fromArray(a)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(a){this.uniforms.offsetSdr.value.fromArray(a)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(a){this.uniforms.gainMapMin.value.fromArray(a)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(a){this.uniforms.gainMapMax.value.fromArray(a)}get gamma(){let a=this.uniforms.gamma.value;return[1/a.x,1/a.y,1/a.z]}set gamma(a){let b=this.uniforms.gamma.value;b.x=1/a[0],b.y=1/a[1],b.z=1/a[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(a){this._hdrCapacityMin=a,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(a){this._hdrCapacityMax=a,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(a){this._maxDisplayBoost=Math.max(1,Math.min(65504,a)),this.calculateWeight()}calculateWeight(){let a=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,a))}}class bq extends Error{}class br extends Error{}let bs=(a,b,c)=>{let d=RegExp(`${b}="([^"]*)"`,"i").exec(a);if(d)return d[1];let e=RegExp(`<${b}[^>]*>([\\s\\S]*?)</${b}>`,"i").exec(a);if(e){let a=e[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return a&&3===a.length?a.map(a=>a.replace(/<\/?rdf:li>/g,"")):e[1].trim()}if(void 0!==c)return c;throw Error(`Can't find ${b} in gainmap metadata`)};class bt{constructor(a){this.options={debug:!!a&&void 0!==a.debug&&a.debug,extractFII:!a||void 0===a.extractFII||a.extractFII,extractNonFII:!a||void 0===a.extractNonFII||a.extractNonFII}}extract(a){return new Promise((b,c)=>{let d,e=this.options.debug,f=new DataView(a.buffer);if(65496!==f.getUint16(0))return void c(Error("Not a valid jpeg"));let g=f.byteLength,h=2,i=0;for(;h<g;){if(++i>250)return void c(Error(`Found no marker after ${i} loops `));if(255!==f.getUint8(h))return void c(Error(`Not a valid marker at offset 0x${h.toString(16)}, found: 0x${f.getUint8(h).toString(16)}`));if(d=f.getUint8(h+1),e&&console.log(`Marker: ${d.toString(16)}`),226===d){e&&console.log("Found APP2 marker (0xffe2)");let a=h+4;if(0x4d504600===f.getUint32(a)){let d,e=a+4;if(18761===f.getUint16(e))d=!1;else{if(19789!==f.getUint16(e))return void c(Error("No valid endianness marker found in TIFF header"));d=!0}if(42!==f.getUint16(e+2,!d))return void c(Error("Not valid TIFF data! (no 0x002A marker)"));let g=f.getUint32(e+4,!d);if(g<8)return void c(Error("Not valid TIFF data! (First offset less than 8)"));let h=e+g,i=f.getUint16(h,!d),j=h+2,k=0;for(let a=j;a<j+12*i;a+=12)45057===f.getUint16(a,!d)&&(k=f.getUint32(a+8,!d));let l=h+2+12*i+4,m=[];for(let a=l;a<l+16*k;a+=16){let b={MPType:f.getUint32(a,!d),size:f.getUint32(a+4,!d),dataOffset:f.getUint32(a+8,!d),dependantImages:f.getUint32(a+12,!d),start:-1,end:-1,isFII:!1};b.dataOffset?(b.start=e+b.dataOffset,b.isFII=!1):(b.start=0,b.isFII=!0),b.end=b.start+b.size,m.push(b)}if(this.options.extractNonFII&&m.length){let a=new Blob([f]),c=[];for(let b of m){if(b.isFII&&!this.options.extractFII)continue;let d=a.slice(b.start,b.end+1,"image/jpeg");c.push(d)}b(c)}}}h+=2+f.getUint16(h+2)}})}}let bu=async a=>{let b=(a=>{let b,c=(b="undefined"!=typeof TextDecoder?new TextDecoder().decode(a):a.toString()).indexOf("<x:xmpmeta");for(;-1!==c;){let a=b.indexOf("x:xmpmeta>",c),d=b.slice(c,a+10);try{let a=bs(d,"hdrgm:GainMapMin","0"),b=bs(d,"hdrgm:GainMapMax"),c=bs(d,"hdrgm:Gamma","1"),e=bs(d,"hdrgm:OffsetSDR","0.015625"),f=bs(d,"hdrgm:OffsetHDR","0.015625"),g=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(d),h=g?g[1]:"0",i=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(d);if(!i)throw Error("Incomplete gainmap metadata");let j=i[1];return{gainMapMin:Array.isArray(a)?a.map(a=>parseFloat(a)):[parseFloat(a),parseFloat(a),parseFloat(a)],gainMapMax:Array.isArray(b)?b.map(a=>parseFloat(a)):[parseFloat(b),parseFloat(b),parseFloat(b)],gamma:Array.isArray(c)?c.map(a=>parseFloat(a)):[parseFloat(c),parseFloat(c),parseFloat(c)],offsetSdr:Array.isArray(e)?e.map(a=>parseFloat(a)):[parseFloat(e),parseFloat(e),parseFloat(e)],offsetHdr:Array.isArray(f)?f.map(a=>parseFloat(a)):[parseFloat(f),parseFloat(f),parseFloat(f)],hdrCapacityMin:parseFloat(h),hdrCapacityMax:parseFloat(j)}}catch(a){}c=b.indexOf("<x:xmpmeta",a)}})(a);if(!b)throw new br("Gain map XMP metadata not found");let c=new bt({extractFII:!0,extractNonFII:!0}),d=await c.extract(a);if(2!==d.length)throw new bq("Gain map recovery image not found");return{sdr:new Uint8Array(await d[0].arrayBuffer()),gainMap:new Uint8Array(await d[1].arrayBuffer()),metadata:b}},bv=a=>new Promise((b,c)=>{let d=document.createElement("img");d.onload=()=>{b(d)},d.onerror=a=>{c(a)},d.src=URL.createObjectURL(a)});class bw extends bm.Loader{constructor(a,b){super(b),a&&(this._renderer=a),this._internalLoadingManager=new bm.LoadingManager}setRenderer(a){return this._renderer=a,this}setRenderTargetOptions(a){return this._renderTargetOptions=a,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: An existing WebGL Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");let a=new bp({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new bm.Texture,sdr:new bm.Texture});return new bl({width:16,height:16,type:bm.HalfFloatType,colorSpace:bm.LinearSRGBColorSpace,material:a,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async render(a,b,c,d){let e,f,g=d?new Blob([d],{type:"image/jpeg"}):void 0,h=new Blob([c],{type:"image/jpeg"}),i=!1;if("undefined"==typeof createImageBitmap){let a=await Promise.all([g?bv(g):Promise.resolve(void 0),bv(h)]);f=a[0],e=a[1],i=!0}else{let a=await Promise.all([g?createImageBitmap(g,{imageOrientation:"flipY"}):Promise.resolve(void 0),createImageBitmap(h,{imageOrientation:"flipY"})]);f=a[0],e=a[1]}let j=new bm.Texture(f||new ImageData(2,2),bm.UVMapping,bm.ClampToEdgeWrapping,bm.ClampToEdgeWrapping,bm.LinearFilter,bm.LinearMipMapLinearFilter,bm.RGBAFormat,bm.UnsignedByteType,1,bm.LinearSRGBColorSpace);j.flipY=i,j.needsUpdate=!0;let k=new bm.Texture(e,bm.UVMapping,bm.ClampToEdgeWrapping,bm.ClampToEdgeWrapping,bm.LinearFilter,bm.LinearMipMapLinearFilter,bm.RGBAFormat,bm.UnsignedByteType,1,bm.SRGBColorSpace);k.flipY=i,k.needsUpdate=!0,a.width=e.width,a.height=e.height,a.material.gainMap=j,a.material.sdr=k,a.material.gainMapMin=b.gainMapMin,a.material.gainMapMax=b.gainMapMax,a.material.offsetHdr=b.offsetHdr,a.material.offsetSdr=b.offsetSdr,a.material.gamma=b.gamma,a.material.hdrCapacityMin=b.hdrCapacityMin,a.material.hdrCapacityMax=b.hdrCapacityMax,a.material.maxDisplayBoost=Math.pow(2,b.hdrCapacityMax),a.material.needsUpdate=!0,a.render()}}class bx extends bw{load([a,b,c],d,e,f){let g,h,i,j=this.prepareQuadRenderer(),k=async()=>{if(g&&h&&i){try{await this.render(j,i,g,h)}catch(d){this.manager.itemError(a),this.manager.itemError(b),this.manager.itemError(c),"function"==typeof f&&f(d),j.disposeOnDemandRenderer();return}"function"==typeof d&&d(j),this.manager.itemEnd(a),this.manager.itemEnd(b),this.manager.itemEnd(c),j.disposeOnDemandRenderer()}},l=!0,m=0,n=0,o=!0,p=0,q=0,r=!0,s=0,t=0,u=()=>{"function"==typeof e&&e(new ProgressEvent("progress",{lengthComputable:l&&o&&r,loaded:n+q+t,total:m+p+s}))};this.manager.itemStart(a),this.manager.itemStart(b),this.manager.itemStart(c);let v=new bm.FileLoader(this._internalLoadingManager);v.setResponseType("arraybuffer"),v.setRequestHeader(this.requestHeader),v.setPath(this.path),v.setWithCredentials(this.withCredentials),v.load(a,async a=>{if("string"==typeof a)throw Error("Invalid sdr buffer");g=a,await k()},a=>{l=a.lengthComputable,n=a.loaded,m=a.total,u()},b=>{this.manager.itemError(a),"function"==typeof f&&f(b)});let w=new bm.FileLoader(this._internalLoadingManager);w.setResponseType("arraybuffer"),w.setRequestHeader(this.requestHeader),w.setPath(this.path),w.setWithCredentials(this.withCredentials),w.load(b,async a=>{if("string"==typeof a)throw Error("Invalid gainmap buffer");h=a,await k()},a=>{o=a.lengthComputable,q=a.loaded,p=a.total,u()},a=>{this.manager.itemError(b),"function"==typeof f&&f(a)});let x=new bm.FileLoader(this._internalLoadingManager);return x.setRequestHeader(this.requestHeader),x.setPath(this.path),x.setWithCredentials(this.withCredentials),x.load(c,async a=>{if("string"!=typeof a)throw Error("Invalid metadata string");i=JSON.parse(a),await k()},a=>{r=a.lengthComputable,t=a.loaded,s=a.total,u()},a=>{this.manager.itemError(c),"function"==typeof f&&f(a)}),j}}class by extends bw{load(a,b,c,d){let e=this.prepareQuadRenderer(),f=new bm.FileLoader(this._internalLoadingManager);return f.setResponseType("arraybuffer"),f.setRequestHeader(this.requestHeader),f.setPath(this.path),f.setWithCredentials(this.withCredentials),this.manager.itemStart(a),f.load(a,async c=>{let f,g,h;if("string"==typeof c)throw Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");let i=new Uint8Array(c);try{let a=await bu(i);f=a.sdr,g=a.gainMap,h=a.metadata}catch(b){if(b instanceof br||b instanceof bq)console.warn(`Failure to reconstruct an HDR image from ${a}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),h={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},f=i;else throw b}try{await this.render(e,h,f,g)}catch(b){this.manager.itemError(a),"function"==typeof d&&d(b),e.disposeOnDemandRenderer();return}"function"==typeof b&&b(e),this.manager.itemEnd(a),e.disposeOnDemandRenderer()},c,b=>{this.manager.itemError(a),"function"==typeof d&&d(b)}),e}}let bz={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},bA="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",bB=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function bC({files:a=bB,path:b="",preset:c,colorSpace:d,extensions:e}={}){c&&(bF(c),a=bz[c],b=bA);let f=Array.isArray(a),{extension:g,isCubemap:h}=bG(a),i=bH(g);if(!i)throw Error("useEnvironment: Unrecognized file extension: "+a);let j=(0,m.useThree)(a=>a.gl);(0,l.useLayoutEffect)(()=>{("webp"===g||"jpg"===g||"jpeg"===g)&&j.domElement.addEventListener("webglcontextlost",function(){v.useLoader.clear(i,f?[a]:a)},{once:!0})},[a,j.domElement]);let k=(0,v.useLoader)(i,f?[a]:a,a=>{("webp"===g||"jpg"===g||"jpeg"===g)&&a.setRenderer(j),null==a.setPath||a.setPath(b),e&&e(a)}),n=f?k[0]:k;if("jpg"===g||"jpeg"===g||"webp"===g){var o;n=null==(o=n.renderTarget)?void 0:o.texture}return n.mapping=h?r.CubeReflectionMapping:r.EquirectangularReflectionMapping,n.colorSpace=null!=d?d:h?"srgb":"srgb-linear",n}let bD={files:bB,path:"",preset:void 0,extensions:void 0};bC.preload=a=>{let b={...bD,...a},{files:c,path:d=""}=b,{preset:e,extensions:f}=b;e&&(bF(e),c=bz[e],d=bA);let{extension:g}=bG(c);if("webp"===g||"jpg"===g||"jpeg"===g)throw Error("useEnvironment: Preloading gainmaps is not supported");let h=bH(g);if(!h)throw Error("useEnvironment: Unrecognized file extension: "+c);v.useLoader.preload(h,Array.isArray(c)?[c]:c,a=>{null==a.setPath||a.setPath(d),f&&f(a)})};let bE={files:bB,preset:void 0};function bF(a){if(!(a in bz))throw Error("Preset must be one of: "+Object.keys(bz).join(", "))}function bG(a){var b;let c=Array.isArray(a)&&6===a.length,d=Array.isArray(a)&&3===a.length&&a.some(a=>a.endsWith("json")),e=Array.isArray(a)?a[0]:a;return{extension:c?"cube":d?"webp":e.startsWith("data:application/exr")?"exr":e.startsWith("data:application/hdr")?"hdr":e.startsWith("data:image/jpeg")?"jpg":null==(b=e.split(".").pop())||null==(b=b.split("?"))||null==(b=b.shift())?void 0:b.toLowerCase(),isCubemap:c,isGainmap:d}}function bH(a){return"cube"===a?r.CubeTextureLoader:"hdr"===a?x:"exr"===a?bi:"jpg"===a||"jpeg"===a?by:"webp"===a?bx:null}function bI(a,b,c,d,e={}){var f,g,h,i,j;let k;e={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...e};let l=(k=j=b||c).current&&k.current.isScene?j.current:j,m=l.background,n=l.environment,o={backgroundBlurriness:l.backgroundBlurriness,backgroundIntensity:l.backgroundIntensity,backgroundRotation:null!=(f=null==(g=l.backgroundRotation)||null==g.clone?void 0:g.clone())?f:[0,0,0],environmentIntensity:l.environmentIntensity,environmentRotation:null!=(h=null==(i=l.environmentRotation)||null==i.clone?void 0:i.clone())?h:[0,0,0]};return"only"!==a&&(l.environment=d),a&&(l.background=d),(0,p.applyProps)(l,e),()=>{"only"!==a&&(l.environment=n),a&&(l.background=m),(0,p.applyProps)(l,o)}}function bJ({scene:a,background:b=!1,map:c,...d}){let e=(0,m.useThree)(a=>a.scene);return l.useLayoutEffect(()=>{if(c)return bI(b,a,e,c,d)}),null}function bK({background:a=!1,scene:b,blur:c,backgroundBlurriness:d,backgroundIntensity:e,backgroundRotation:f,environmentIntensity:g,environmentRotation:h,...i}){let j=bC(i),k=(0,m.useThree)(a=>a.scene);return l.useLayoutEffect(()=>bI(a,b,k,j,{backgroundBlurriness:null!=c?c:d,backgroundIntensity:e,backgroundRotation:f,environmentIntensity:g,environmentRotation:h})),l.useEffect(()=>()=>{j.dispose()},[j]),null}function bL({children:a,near:b=.1,far:c=1e3,resolution:d=256,frames:e=1,map:f,background:g=!1,blur:h,backgroundBlurriness:i,backgroundIntensity:j,backgroundRotation:k,environmentIntensity:p,environmentRotation:q,scene:s,files:t,path:u,preset:v,extensions:w}){let x=(0,m.useThree)(a=>a.gl),y=(0,m.useThree)(a=>a.scene),z=l.useRef(null),[A]=l.useState(()=>new r.Scene),B=l.useMemo(()=>{let a=new r.WebGLCubeRenderTarget(d);return a.texture.type=r.HalfFloatType,a},[d]);l.useEffect(()=>()=>{B.dispose()},[B]),l.useLayoutEffect(()=>{if(1===e){let a=x.autoClear;x.autoClear=!0,z.current.update(x,A),x.autoClear=a}return bI(g,s,y,B.texture,{backgroundBlurriness:null!=h?h:i,backgroundIntensity:j,backgroundRotation:k,environmentIntensity:p,environmentRotation:q})},[a,A,B.texture,s,y,g,e,x]);let C=1;return(0,n.useFrame)(()=>{if(e===1/0||C<e){let a=x.autoClear;x.autoClear=!0,z.current.update(x,A),x.autoClear=a,C++}}),l.createElement(l.Fragment,null,(0,o.o)(l.createElement(l.Fragment,null,a,l.createElement("cubeCamera",{ref:z,args:[b,c,B]}),t||v?l.createElement(bK,{background:!0,files:t,preset:v,path:u,extensions:w}):f?l.createElement(bJ,{background:!0,map:f,extensions:w}):null),A))}function bM(a){var b,c,d,e;let f=bC(a),g=a.map||f;l.useMemo(()=>(0,q.e)({GroundProjectedEnvImpl:u}),[]),l.useEffect(()=>()=>{f.dispose()},[f]);let h=l.useMemo(()=>[g],[g]),i=null==(b=a.ground)?void 0:b.height,j=null==(c=a.ground)?void 0:c.radius,m=null!=(d=null==(e=a.ground)?void 0:e.scale)?d:1e3;return l.createElement(l.Fragment,null,l.createElement(bJ,(0,k.default)({},a,{map:g})),l.createElement("groundProjectedEnvImpl",{args:h,scale:m,height:i,radius:j}))}function bN(a){return a.ground?l.createElement(bM,a):a.map?l.createElement(bJ,a):a.children?l.createElement(bL,a):l.createElement(bK,a)}bC.clear=a=>{let b={...bE,...a},{files:c}=b,{preset:d}=b;d&&(bF(d),c=bz[d]);let{extension:e}=bG(c),f=bH(e);if(!f)throw Error("useEnvironment: Unrecognized file extension: "+c);v.useLoader.clear(f,Array.isArray(c)?[c]:c)};var bO=a.i(82140),bP=a.i(10129);let bQ=a=>{if(!a||"object"!=typeof a||Array.isArray(a))return{};let b={};try{for(let c in a)if(a.hasOwnProperty(c)){let d=a[c];null!=d&&("object"!=typeof d||Array.isArray(d)?"object"!=typeof d&&(b[c]=d):b[c]=bQ(d))}}catch(a){console.warn("[OptimizedCanvas] Error creating clean object:",a)}return b};function bR({children:a,frameloop:b,style:c,camera:d,orthographic:e}){let f=(0,l.useMemo)(()=>{try{return{antialias:!0,alpha:!1,powerPreference:"high-performance",stencil:!1,depth:!0,logarithmicDepthBuffer:!1,preserveDrawingBuffer:!1,failIfMajorPerformanceCaveat:!1}}catch(a){return console.error("[OptimizedCanvas] Error creating glConfig:",a),{antialias:!0,alpha:!1,powerPreference:"high-performance"}}},[]),g=(0,l.useMemo)(()=>{let a={dpr:[1,1.5],frameloop:b||"demand",gl:f&&"object"==typeof f&&!Array.isArray(f)?f:{antialias:!0,alpha:!1,powerPreference:"high-performance"}};void 0!==e&&(a.orthographic=e);try{null==c||"object"!=typeof c||Array.isArray(c)||(a.style=bQ(c)),null==d||"object"!=typeof d||Array.isArray(d)||(a.camera=bQ(d))}catch(a){console.error("[OptimizedCanvas] Error building canvasProps:",a)}return a},[b,c,d,f,e]);if(!g||"object"!=typeof g||Array.isArray(g))return console.error("[OptimizedCanvas] Invalid canvasProps, using defaults:",g),(0,j.jsx)(bP.Canvas,{dpr:[1,1.5],frameloop:"demand",children:a});if(!bP.Canvas)return console.error("[OptimizedCanvas] Canvas component not available"),null;let h=(0,l.useMemo)(()=>{let a=bQ(g);return a.dpr&&Array.isArray(a.dpr)||(a.dpr=[1,1.5]),a.frameloop&&"string"==typeof a.frameloop||(a.frameloop="demand"),(!a.gl||"object"!=typeof a.gl||Array.isArray(a.gl))&&(a.gl=f),a},[g,f]);try{return(0,j.jsx)(bP.Canvas,{...h,children:a})}catch(b){return console.error("[OptimizedCanvas] Error rendering Canvas:",b,"safeCanvasProps:",h),(0,j.jsx)(bP.Canvas,{dpr:[1,1.5],frameloop:"demand",children:a})}}var bS=r,bT=r;let bU=new bT.Box3,bV=new bT.Vector3;class bW extends bT.InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new bT.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new bT.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(a){let b=this.attributes.instanceStart,c=this.attributes.instanceEnd;return void 0!==b&&(b.applyMatrix4(a),c.applyMatrix4(a),b.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(a){let b;a instanceof Float32Array?b=a:Array.isArray(a)&&(b=new Float32Array(a));let c=new bT.InstancedInterleavedBuffer(b,6,1);return this.setAttribute("instanceStart",new bT.InterleavedBufferAttribute(c,3,0)),this.setAttribute("instanceEnd",new bT.InterleavedBufferAttribute(c,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(a,b=3){let c;a instanceof Float32Array?c=a:Array.isArray(a)&&(c=new Float32Array(a));let d=new bT.InstancedInterleavedBuffer(c,2*b,1);return this.setAttribute("instanceColorStart",new bT.InterleavedBufferAttribute(d,b,0)),this.setAttribute("instanceColorEnd",new bT.InterleavedBufferAttribute(d,b,b)),this}fromWireframeGeometry(a){return this.setPositions(a.attributes.position.array),this}fromEdgesGeometry(a){return this.setPositions(a.attributes.position.array),this}fromMesh(a){return this.fromWireframeGeometry(new bT.WireframeGeometry(a.geometry)),this}fromLineSegments(a){let b=a.geometry;return this.setPositions(b.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new bT.Box3);let a=this.attributes.instanceStart,b=this.attributes.instanceEnd;void 0!==a&&void 0!==b&&(this.boundingBox.setFromBufferAttribute(a),bU.setFromBufferAttribute(b),this.boundingBox.union(bU))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new bT.Sphere),null===this.boundingBox&&this.computeBoundingBox();let a=this.attributes.instanceStart,b=this.attributes.instanceEnd;if(void 0!==a&&void 0!==b){let c=this.boundingSphere.center;this.boundingBox.getCenter(c);let d=0;for(let e=0,f=a.count;e<f;e++)bV.fromBufferAttribute(a,e),d=Math.max(d,c.distanceToSquared(bV)),bV.fromBufferAttribute(b,e),d=Math.max(d,c.distanceToSquared(bV));this.boundingSphere.radius=Math.sqrt(d),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(a){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(a)}}var bX=r;class bY extends bX.ShaderMaterial{constructor(a){super({type:"LineMaterial",uniforms:bX.UniformsUtils.clone(bX.UniformsUtils.merge([bj.UniformsLib.common,bj.UniformsLib.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new bX.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${t.version>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(a){this.uniforms.diffuse.value=a}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(a){!0===a?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(a){this.uniforms.linewidth.value=a}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(a){!!a!="USE_DASH"in this.defines&&(this.needsUpdate=!0),!0===a?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(a){this.uniforms.dashScale.value=a}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(a){this.uniforms.dashSize.value=a}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(a){this.uniforms.dashOffset.value=a}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(a){this.uniforms.gapSize.value=a}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(a){this.uniforms.opacity.value=a}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(a){this.uniforms.resolution.value.copy(a)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(a){!!a!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),!0===a?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(a)}}let bZ=t.version>=125?"uv1":"uv2",b$=new bS.Vector4,b_=new bS.Vector3,b0=new bS.Vector3,b1=new bS.Vector4,b2=new bS.Vector4,b3=new bS.Vector4,b4=new bS.Vector3,b5=new bS.Matrix4,b6=new bS.Line3,b7=new bS.Vector3,b8=new bS.Box3,b9=new bS.Sphere,ca=new bS.Vector4;function cb(a,b,c){return ca.set(0,0,-b,1).applyMatrix4(a.projectionMatrix),ca.multiplyScalar(1/ca.w),ca.x=d/c.width,ca.y=d/c.height,ca.applyMatrix4(a.projectionMatrixInverse),ca.multiplyScalar(1/ca.w),Math.abs(Math.max(ca.x,ca.y))}class cc extends bS.Mesh{constructor(a=new bW,b=new bY({color:0xffffff*Math.random()})){super(a,b),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){let a=this.geometry,b=a.attributes.instanceStart,c=a.attributes.instanceEnd,d=new Float32Array(2*b.count);for(let a=0,e=0,f=b.count;a<f;a++,e+=2)b_.fromBufferAttribute(b,a),b0.fromBufferAttribute(c,a),d[e]=0===e?0:d[e-1],d[e+1]=d[e]+b_.distanceTo(b0);let e=new bS.InstancedInterleavedBuffer(d,2,1);return a.setAttribute("instanceDistanceStart",new bS.InterleavedBufferAttribute(e,1,0)),a.setAttribute("instanceDistanceEnd",new bS.InterleavedBufferAttribute(e,1,1)),this}raycast(a,b){let e,f,g=this.material.worldUnits,h=a.camera;null!==h||g||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');let i=void 0!==a.params.Line2&&a.params.Line2.threshold||0;c=a.ray;let j=this.matrixWorld,k=this.geometry,l=this.material;if(d=l.linewidth+i,null===k.boundingSphere&&k.computeBoundingSphere(),b9.copy(k.boundingSphere).applyMatrix4(j),g)e=.5*d;else{let a=Math.max(h.near,b9.distanceToPoint(c.origin));e=cb(h,a,l.resolution)}if(b9.radius+=e,!1!==c.intersectsSphere(b9)){if(null===k.boundingBox&&k.computeBoundingBox(),b8.copy(k.boundingBox).applyMatrix4(j),g)f=.5*d;else{let a=Math.max(h.near,b8.distanceToPoint(c.origin));f=cb(h,a,l.resolution)}b8.expandByScalar(f),!1!==c.intersectsBox(b8)&&(g?function(a,b){let e=a.matrixWorld,f=a.geometry,g=f.attributes.instanceStart,h=f.attributes.instanceEnd,i=Math.min(f.instanceCount,g.count);for(let f=0;f<i;f++){b6.start.fromBufferAttribute(g,f),b6.end.fromBufferAttribute(h,f),b6.applyMatrix4(e);let i=new bS.Vector3,j=new bS.Vector3;c.distanceSqToSegment(b6.start,b6.end,j,i),j.distanceTo(i)<.5*d&&b.push({point:j,pointOnLine:i,distance:c.origin.distanceTo(j),object:a,face:null,faceIndex:f,uv:null,[bZ]:null})}}(this,b):function(a,b,e){let f=b.projectionMatrix,g=a.material.resolution,h=a.matrixWorld,i=a.geometry,j=i.attributes.instanceStart,k=i.attributes.instanceEnd,l=Math.min(i.instanceCount,j.count),m=-b.near;c.at(1,b3),b3.w=1,b3.applyMatrix4(b.matrixWorldInverse),b3.applyMatrix4(f),b3.multiplyScalar(1/b3.w),b3.x*=g.x/2,b3.y*=g.y/2,b3.z=0,b4.copy(b3),b5.multiplyMatrices(b.matrixWorldInverse,h);for(let b=0;b<l;b++){if(b1.fromBufferAttribute(j,b),b2.fromBufferAttribute(k,b),b1.w=1,b2.w=1,b1.applyMatrix4(b5),b2.applyMatrix4(b5),b1.z>m&&b2.z>m)continue;if(b1.z>m){let a=b1.z-b2.z,b=(b1.z-m)/a;b1.lerp(b2,b)}else if(b2.z>m){let a=b2.z-b1.z,b=(b2.z-m)/a;b2.lerp(b1,b)}b1.applyMatrix4(f),b2.applyMatrix4(f),b1.multiplyScalar(1/b1.w),b2.multiplyScalar(1/b2.w),b1.x*=g.x/2,b1.y*=g.y/2,b2.x*=g.x/2,b2.y*=g.y/2,b6.start.copy(b1),b6.start.z=0,b6.end.copy(b2),b6.end.z=0;let i=b6.closestPointToPointParameter(b4,!0);b6.at(i,b7);let l=bS.MathUtils.lerp(b1.z,b2.z,i),n=l>=-1&&l<=1,o=b4.distanceTo(b7)<.5*d;if(n&&o){b6.start.fromBufferAttribute(j,b),b6.end.fromBufferAttribute(k,b),b6.start.applyMatrix4(h),b6.end.applyMatrix4(h);let d=new bS.Vector3,f=new bS.Vector3;c.distanceSqToSegment(b6.start,b6.end,f,d),e.push({point:f,pointOnLine:d,distance:c.origin.distanceTo(f),object:a,face:null,faceIndex:b,uv:null,[bZ]:null})}}}(this,h,b))}}onBeforeRender(a){let b=this.material.uniforms;b&&b.resolution&&(a.getViewport(b$),this.material.uniforms.resolution.value.set(b$.z,b$.w))}}class cd extends bW{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(a){let b=a.length-3,c=new Float32Array(2*b);for(let d=0;d<b;d+=3)c[2*d]=a[d],c[2*d+1]=a[d+1],c[2*d+2]=a[d+2],c[2*d+3]=a[d+3],c[2*d+4]=a[d+4],c[2*d+5]=a[d+5];return super.setPositions(c),this}setColors(a,b=3){let c=a.length-b,d=new Float32Array(2*c);if(3===b)for(let e=0;e<c;e+=b)d[2*e]=a[e],d[2*e+1]=a[e+1],d[2*e+2]=a[e+2],d[2*e+3]=a[e+3],d[2*e+4]=a[e+4],d[2*e+5]=a[e+5];else for(let e=0;e<c;e+=b)d[2*e]=a[e],d[2*e+1]=a[e+1],d[2*e+2]=a[e+2],d[2*e+3]=a[e+3],d[2*e+4]=a[e+4],d[2*e+5]=a[e+5],d[2*e+6]=a[e+6],d[2*e+7]=a[e+7];return super.setColors(d,b),this}fromLine(a){let b=a.geometry;return this.setPositions(b.attributes.position.array),this}}class ce extends cc{constructor(a=new cd,b=new bY({color:0xffffff*Math.random()})){super(a,b),this.isLine2=!0,this.type="Line2"}}let cf=l.forwardRef(function({points:a,color:b=0xffffff,vertexColors:c,linewidth:d,lineWidth:e,segments:f,dashed:g,...h},i){var j,n;let o=(0,m.useThree)(a=>a.size),p=l.useMemo(()=>f?new cc:new ce,[f]),[q]=l.useState(()=>new bY),s=(null==c||null==(j=c[0])?void 0:j.length)===4?4:3,t=l.useMemo(()=>{let d=f?new bW:new cd,e=a.map(a=>{let b=Array.isArray(a);return a instanceof r.Vector3||a instanceof r.Vector4?[a.x,a.y,a.z]:a instanceof r.Vector2?[a.x,a.y,0]:b&&3===a.length?[a[0],a[1],a[2]]:b&&2===a.length?[a[0],a[1],0]:a});if(d.setPositions(e.flat()),c){b=0xffffff;let a=c.map(a=>a instanceof r.Color?a.toArray():a);d.setColors(a.flat(),s)}return d},[a,f,c,s]);return l.useLayoutEffect(()=>{p.computeLineDistances()},[a,p]),l.useLayoutEffect(()=>{g?q.defines.USE_DASH="":delete q.defines.USE_DASH,q.needsUpdate=!0},[g,q]),l.useEffect(()=>()=>{t.dispose(),q.dispose()},[t]),l.createElement("primitive",(0,k.default)({object:p,ref:i},h),l.createElement("primitive",{object:t,attach:"geometry"}),l.createElement("primitive",(0,k.default)({object:q,attach:"material",color:b,vertexColors:!!c,resolution:[o.width,o.height],linewidth:null!=(n=null!=d?d:e)?n:1,dashed:g,transparent:4===s},h)))}),cg=l.forwardRef(function({start:a,end:b,midA:c,midB:d,segments:e=20,...f},g){let h=l.useMemo(()=>{let f=a instanceof r.Vector3?a:new r.Vector3(...a),g=b instanceof r.Vector3?b:new r.Vector3(...b),h=c instanceof r.Vector3?c:new r.Vector3(...c),i=d instanceof r.Vector3?d:new r.Vector3(...d);return new r.CubicBezierCurve3(f,h,i,g).getPoints(e)},[a,b,c,d,e]);return l.createElement(cf,(0,k.default)({ref:g,points:h},f))});var ch=a.i(9715);let ci={A1:["G10","G12","G13","G14","G16","G19","G20","G5"],A2:["G16","G19","G4"],A3:["G14","G16","G22","G5","G6"],A4:["G10","G14","G16","G5"],A5:["G13","G19","G2"],A6:["G19","G6","G8"],A7:[],A8:[],A9:["G24"],A10:["G2","G22"],A11:[],A12:["G16","G19","G7"],A13:["G14","G16","G22","G25","G27"],A14:["G13","G14","G16","G26","G6"],A15:["G14","G15","G20","G21"],A16:["G16","G17"],A17:["G14","G16","G25","G8"],A18:["G4"],A19:["G13","G16","G21","G25","G9"],A20:["G12","G13","G16","G25","G27","G8"],A21:["G11","G14","G16"],A22:["G16","G26"],A23:["G12","G16","G27","G29","G31","G5"],A24:["G11","G12","G13","G16","G19","G21","G22"],A25:["G14","G16","G17","G18","G22","G25","G27"],A26:["G12","G13","G14","G4","G8"]},cj={G2:["A10","A5"],G4:["A18","A2","A26"],G5:["A1","A23","A3","A4"],G6:["A14","A3","A6"],G7:["A12"],G8:["A17","A20","A26","A6"],G9:["A19"],G10:["A1","A4"],G11:["A21","A24"],G12:["A1","A20","A23","A24","A26"],G13:["A1","A14","A19","A20","A24","A26","A5"],G14:["A1","A13","A14","A15","A17","A21","A25","A26","A3","A4"],G15:["A15"],G16:["A1","A12","A13","A14","A16","A17","A19","A2","A20","A21","A22","A23","A24","A25","A3","A4"],G17:["A16","A25"],G18:["A25"],G19:["A1","A12","A2","A24","A5","A6"],G20:["A1","A15"],G21:["A15","A19","A24"],G22:["A10","A13","A24","A25","A3"],G24:["A9"],G25:["A13","A17","A19","A20","A25"],G26:["A14","A22"],G27:["A13","A20","A23","A25"],G29:["A23"],G31:["A23"]};function ck(a){return a?ci[a]?ci[a]:cj[a]?cj[a]:[]:[]}let cl=Math.PI*(3-Math.sqrt(5));function cm(a,b,c,d=!1){if(b<=1)return[0,0,0];if(d){let d=Math.max(-.9,Math.min(.9,1-a/(b-1)*2)),e=Math.sqrt(Math.max(0,1-d*d))*c,f=cl*a;return[Math.cos(f)*e,d*c,Math.sin(f)*e]}{let d=Math.max(-.85,Math.min(.85,1-a/(b-1)*2)),e=Math.sqrt(Math.max(0,1-d*d))*c,f=cl*a;return[Math.cos(f)*e,d*c*.8,Math.sin(f)*e]}}function cn(a,b,c){return b+(.5*Math.sin(.7*a)+.3*Math.cos(1.3*a))*c}function co(a,b,c=15,d=null,e=null){if(null!==d&&null!==e&&b===d+e){if(a<d){let b=cn(a,22,6);return cm(a,d,b,!1)}let b=a-d,c=cn(b,12,3);return cm(b,e,c,!0)}return cm(a,b,c)}let cp=new Map,cq=new Map,cr=new r.Vector3;function cs(a,b){b?cp.set(a,b):cp.delete(a),cq.delete(a)}function ct(a){cp.delete(a),cq.delete(a)}function cu(a){let b=cp.get(a);if(!b||!b.current)return null;try{b.current.getWorldPosition(cr);let c=[cr.x,cr.y,cr.z];return cq.set(a,c),c}catch(a){return null}}function cv(a){return cq.get(a)||null}function cw(a,b,c){if(!a||!a.startsWith("A"))return[];let d=c||cj,e=(b||ci)[a]||[];if(0===e.length)return[];let f=new Set;return e.forEach(b=>{(d[b]||[]).forEach(b=>{b!==a&&f.add(b)})}),Array.from(f)}a.i(66251);let cx=Array.from({length:29},(a,b)=>`A${b+1}`),cy=Array.from({length:54},(a,b)=>`G${b+1}`),cz=cx.length+cy.length;function cA({start:a,end:b,v0:c,v1:d,index:e,totalConnections:f,color:g="#e9ff00",shouldHide:h=!1}){let[i,k]=(0,l.useState)(0),[m,n]=(0,l.useState)(.5),o=(0,l.useRef)(null),p=(0,l.useRef)(!1),q=(0,l.useRef)(!1),r=(0,l.useRef)(!0),s=(0,l.useRef)(`${a[0]}-${a[1]}-${b[0]}-${b[1]}-${c?.[0]}-${d?.[0]}`);(0,l.useEffect)(()=>{let e=`${a[0].toFixed(1)}-${a[1].toFixed(1)}-${b[0].toFixed(1)}-${b[1].toFixed(1)}-${c?.[0]?.toFixed(1)}-${d?.[0]?.toFixed(1)}`;e!==s.current&&(s.current=e,r.current&&(k(0),o.current=Date.now(),q.current=!1,r.current=!1))},[a,b,c,d]),(0,l.useEffect)(()=>{if(h){k(0),q.current=!1;return}if(!q.current){o.current=Date.now();let a=setTimeout(()=>{let a=Date.now(),b=()=>{let c=Math.min((Date.now()-a)/300,1),d=1-Math.pow(1-c,3);k(d),n(.5+.5*d),c<1?requestAnimationFrame(b):(p.current=!0,q.current=!0)};b()},20*e);return()=>clearTimeout(a)}},[e,h]),(0,l.useEffect)(()=>{q.current&&!h&&i<.9&&(k(1),n(1))},[a,b,c,d,h,i]);let t=a=>a&&Array.isArray(a)&&3===a.length&&a.every(a=>"number"==typeof a&&!isNaN(a)&&isFinite(a)),u=a=>a&&Array.isArray(a)&&3===a.length&&a.every(a=>"number"==typeof a&&!isNaN(a)&&isFinite(a));return u(a)&&u(b)&&t(c)&&t(d)&&(0!==i||!h)?(0,j.jsx)("group",{renderOrder:4,frustumCulled:!1,children:(0,j.jsx)(cg,{start:a,end:b,midA:c,midB:d,color:g,lineWidth:m,opacity:i,transparent:!0,depthWrite:!1,depthTest:!0})}):null}let cB=function({processedData:a}){let{camera:b}=(0,m.useThree)(),[c]=(0,ch.useStore)("selectedNodeStore",null),[d]=(0,ch.useStore)("highlightedNodesStore",[]),[e]=(0,ch.useStore)("connectionLinesVisibilityStore",!0),f=(0,l.useMemo)(()=>(function(a){if(!a?.links?.length)return null;let b={},c={};return a.links.forEach(a=>{let d="string"==typeof a.source?a.source:a.source?.id,e="string"==typeof a.target?a.target:a.target?.id;d&&e&&(d.startsWith("A")&&(b[d]||(b[d]=[]),b[d].includes(e)||b[d].push(e)),e.startsWith("G")&&(c[e]||(c[e]=[]),c[e].includes(d)||c[e].push(d)))}),{articleConnections:b,keywordConnections:c,getConnectedNodes:a=>a?b[a]?b[a]:c[a]?c[a]:[]:[]}})(a),[a]),g=f?f.getConnectedNodes:ck,h=f?f.articleConnections:ci,i=f?f.keywordConnections:cj,k=()=>{let b;if(a&&a.nodeMap){let b={};return a.nodeMap.forEach((a,c)=>{b[c]=a.position||[0,0,0]}),b}return b={},cx.forEach((a,c)=>{b[a]=co(c,cz,15)}),cy.forEach((a,c)=>{b[a]=co(cx.length+c,cz,15)}),b};(0,l.useEffect)(()=>{let a=(0,ch.getStore)("highlightedNodesStore"),b=(0,ch.getStore)("secondaryHighlightedArticlesStore"),d=new Set,e=new Set;c?.id&&(d.add(c.id),g(c.id).forEach(a=>{a&&d.add(a)}),c.id.startsWith("A")&&cw(c.id,h,i).forEach(a=>{e.add(a)})),requestAnimationFrame(()=>{a.setState(Array.from(d)),b.setState(Array.from(e))}),H.current.clear(),cq.clear()},[c]);let o=(0,l.useRef)(0),p=(0,l.useRef)({}),q=(0,l.useRef)(null),[s,t]=(0,l.useState)(0);(0,n.useFrame)(b=>{let d=Date.now();if(d-o.current<16||(o.current=d,!a||!a.nodeMap||!c?.id))return;let e=b.camera.position,f=!q.current||Math.abs(e.x-q.current.x)>.01||Math.abs(e.y-q.current.y)>.01||Math.abs(e.z-q.current.z)>.01;f&&(q.current=e.clone());let h=k(),i=g(c.id),j=[c.id,...i],l=!1;j.forEach(a=>{let b=h[a];if(!b)return;let c=p.current[a];c?(Math.abs(b[0]-c[0])>.05||Math.abs(b[1]-c[1])>.05||Math.abs(b[2]-c[2])>.05)&&(l=!0,p.current[a]=[...b]):(l=!0,p.current[a]=[...b])}),(l||f)&&requestAnimationFrame(()=>{t(a=>a+1)})});let u=(0,l.useRef)(new r.Vector3),v=(0,l.useRef)(new r.Vector3),w=(0,l.useRef)(new r.Vector3),x=(0,l.useRef)(new r.Vector3),y=(0,l.useRef)(new r.Vector3(0,1,0)),z=(0,l.useRef)(new r.Vector3(1,0,0)),A=(0,l.useRef)(new r.Vector3(0,0,0)),B=(0,l.useRef)(new r.Vector3(0,1,0)),C=(0,l.useRef)(new r.Vector3),D=(0,l.useRef)(new r.Vector3),E=(0,l.useRef)(new r.Vector3),F=(0,l.useRef)(new r.Vector3),G=(0,l.useRef)(new r.Vector3),H=(0,l.useRef)(new Map),I=(a,b,c=null)=>{let d=cv(a);if(d)return d;let e=null,f=[];try{e=(0,ch.getStore)("selectedNodeStore",null);let a=(0,ch.getStore)("highlightedNodesStore",[]);f=Array.isArray(a)?a:[]}catch(a){}let g=e?.id===a||f.includes(a),h=[];try{let a=(0,ch.getStore)("secondaryHighlightedArticlesStore",[]);h=Array.isArray(a)?a:[]}catch(a){}let i=h.includes(a),j=e&&e.id!==a&&!f.includes(a)&&!i,k=c?`${c.position.x.toFixed(3)}-${c.position.y.toFixed(3)}-${c.position.z.toFixed(3)}`:"no-camera",l=`${a}-${b[0].toFixed(3)}-${b[1].toFixed(3)}-${b[2].toFixed(3)}-${g?"1.3":j?"0.6":"1.0"}-${i?"secondary":"normal"}-${k}`,m=H.current.get(l);if(m&&!g&&!i)return m;let n=A.current,o=C.current.set(b[0],b[1],b[2]),p=D.current;(g||i)&&c?p.subVectors(c.position,o).normalize():p.subVectors(n,o).normalize();let q=B.current,r=E.current.crossVectors(q,p);.001>r.length()&&r.set(1,0,0),r.normalize();let s=F.current.crossVectors(p,r).normalize();Math.abs(p.dot(q))>.99&&(s.set(1,0,0),r.set(0,0,1));let t=a&&a.startsWith("A"),u=G.current;if(t){let b=cv(a);if(b)return b;let d=null,e=[],f=[];try{d=(0,ch.getStore)("selectedNodeStore",null);let a=(0,ch.getStore)("highlightedNodesStore",[]);e=Array.isArray(a)?a:[];let b=(0,ch.getStore)("secondaryHighlightedArticlesStore",[]);f=Array.isArray(b)?b:[]}catch(a){}Array.isArray(e)||(e=[]),Array.isArray(f)||(f=[]);let g=d?.id===a||e.includes(a),h=f.includes(a),i=d&&d.id!==a&&!e.includes(a)&&!h,j=1;g?j=1.3:i&&(j=.6);let k=14.64*j;if((g||h)&&c){let b,d=D.current.subVectors(c.position,o).normalize(),e=B.current,f=E.current.crossVectors(e,d);.001>f.length()&&f.set(1,0,0),f.normalize();let i=F.current.crossVectors(d,f).normalize(),j=O.current.makeBasis(f,i,d),l=N.current.setFromRotationMatrix(j),m=x.current.set(0,0,1);m.applyQuaternion(l);let n=Math.acos(Math.max(-1,Math.min(1,m.dot(e))))*(180/Math.PI),p=Math.acos(Math.max(-1,Math.min(1,d.dot(e))))*(180/Math.PI);b=h?-(.5*(k/2+.1))/Math.max(.1,Math.cos(n*Math.PI/180)):-(.5*(k/1.2+.1));let q=L.current.set(0,b,0),r=M.current.copy(q).applyQuaternion(l),s=r.y-q.y,t=Math.sqrt(r.x*r.x+r.z*r.z);h&&console.log("%c[SECONDARY] Node: "+a,"color: orange; font-weight: bold; font-size: 14px;",{scaledTotalHeight:k.toFixed(3),bottomCenterOffset:b.toFixed(3),localBottom:`(${q.x.toFixed(3)}, ${q.y.toFixed(3)}, ${q.z.toFixed(3)})`,rotatedBottom:`(${r.x.toFixed(3)}, ${r.y.toFixed(3)}, ${r.z.toFixed(3)})`,offsetDiff:s.toFixed(3),horizontalOffset:t.toFixed(3),tiltAngle:n.toFixed(2)+"",tiltFromCamera:p.toFixed(2)+"",cameraPos:`(${c.position.x.toFixed(2)}, ${c.position.y.toFixed(2)}, ${c.position.z.toFixed(2)})`,nodePos:`(${o.x.toFixed(2)}, ${o.y.toFixed(2)}, ${o.z.toFixed(2)})`,directionToCamera:`(${d.x.toFixed(3)}, ${d.y.toFixed(3)}, ${d.z.toFixed(3)})`}),g&&console.log("%c[HIGHLIGHTED] Node: "+a,"color: green; font-weight: bold; font-size: 14px;",{scaledTotalHeight:k.toFixed(3),bottomCenterOffset:b.toFixed(3),localBottom:`(${q.x.toFixed(3)}, ${q.y.toFixed(3)}, ${q.z.toFixed(3)})`,rotatedBottom:`(${r.x.toFixed(3)}, ${r.y.toFixed(3)}, ${r.z.toFixed(3)})`,offsetDiff:s.toFixed(3),horizontalOffset:t.toFixed(3),tiltAngle:n.toFixed(2)+"",tiltFromCamera:p.toFixed(2)+"",cameraPos:`(${c.position.x.toFixed(2)}, ${c.position.y.toFixed(2)}, ${c.position.z.toFixed(2)})`,nodePos:`(${o.x.toFixed(2)}, ${o.y.toFixed(2)}, ${o.z.toFixed(2)})`,directionToCamera:`(${d.x.toFixed(3)}, ${d.y.toFixed(3)}, ${d.z.toFixed(3)})`}),u.copy(o),u.add(r)}else{let a;a=h?-(.5*(k/1.8+.15)):-(.5*(k/1.2+.1)),u.copy(o),u.addScaledVector(s,a)}}else u.copy(o).addScaledVector(s,-.2);let v=[u.x,u.y,u.z];return H.current.set(l,v),H.current.size>200&&H.current.clear(),v},J=(0,l.useRef)(new r.Vector3),K=(0,l.useRef)(new r.Vector3),L=(0,l.useRef)(new r.Vector3),M=(0,l.useRef)(new r.Vector3),N=(0,l.useRef)(new r.Quaternion),O=(0,l.useRef)(new r.Matrix4),P=(a,b,c,d,f,g,h,i)=>{let k=h&&h.startsWith("G");if(!a||!b||!Array.isArray(a)||!Array.isArray(b)||3!==a.length||3!==b.length||a.some(a=>"number"!=typeof a||isNaN(a)||!isFinite(a))||b.some(a=>"number"!=typeof a||isNaN(a)||!isFinite(a)))return null;let l=J.current.set(a[0],a[1],a[2]),m=K.current.set(b[0],b[1],b[2]),n=m.x-l.x,o=m.y-l.y,p=m.z-l.z,q=Math.sqrt(n*n+o*o+p*p);if(q<.01||!isFinite(q))return null;let r=((a,b,c,d,e=!1)=>{if(!a||!b||!Array.isArray(a)||!Array.isArray(b)||3!==a.length||3!==b.length||a.some(a=>"number"!=typeof a||isNaN(a)||!isFinite(a))||b.some(a=>"number"!=typeof a||isNaN(a)||!isFinite(a))){let c=[((a?.[0]||0)+(b?.[0]||0))/2,((a?.[1]||0)+(b?.[1]||0))/2,((a?.[2]||0)+(b?.[2]||0))/2];return{v0:c,v1:c}}let f=b[0]-a[0],g=b[1]-a[1],h=b[2]-a[2],i=Math.sqrt(f*f+g*g+h*h);if(i<.001||!isFinite(i)){let c=[(a[0]+b[0])/2,(a[1]+b[1])/2,(a[2]+b[2])/2];return{v0:c,v1:c}}let j=u.current.set(f,g,h);.001>j.length()||!isFinite(j.length())?j.set(1,0,0):j.normalize();let k=y.current,l=v.current.crossVectors(k,j);.001>l.length()&&l.crossVectors(z.current,j),l.normalize();let m=w.current.crossVectors(j,l).normalize(),n=30*c%360*Math.PI/180,o=.08*i*Math.cos(n),p=.08*i*Math.sin(n),q=e?12:8,r=x.current.set(a[0]-k.x*q+l.x*o*.1+m.x*p*.1,a[1]-k.y*q,a[2]-k.z*q+l.z*o*.1+m.z*p*.1),s=.7*i,t=u.current.set(a[0]+j.x*s+l.x*o*.2+m.x*p*.2,a[1]+j.y*s+(e?-(.15*i):-(.1*i))+l.y*o*.2+m.y*p*.2,a[2]+j.z*s+l.z*o*.2+m.z*p*.2),A=a=>"number"==typeof a&&isFinite(a)&&!isNaN(a)?a:0;return{v0:[A(r.x),A(r.y),A(r.z)],v1:[A(t.x),A(t.y),A(t.z)]}})(a,b,c,0,k);if(!r||!r.v0||!r.v1||!Array.isArray(r.v0)||!Array.isArray(r.v1)||3!==r.v0.length||3!==r.v1.length||r.v0.some(a=>"number"!=typeof a||isNaN(a)||!isFinite(a))||r.v1.some(a=>"number"!=typeof a||isNaN(a)||!isFinite(a)))return null;let s=`${h}-${i}-${c}`;return(0,j.jsx)(cA,{start:a,end:b,v0:r.v0,v1:r.v1,index:c,totalConnections:d,color:f,shouldHide:!e},s)},Q=(0,l.useMemo)(()=>{if(!c?.id||!e)return[];let a=k(),d=a[c.id];if(!d||!Array.isArray(d)||3!==d.length)return[];let f=I(c.id,d,b);if(!f||!Array.isArray(f)||3!==f.length||f.some(a=>"number"!=typeof a||isNaN(a)||!isFinite(a)))return[];let j=[],l=c.id.startsWith("A"),m=g(c.id)||[],n=m.length;if(n>0)for(let d=0;d<n;d++){let e=m[d],g=a[e];if(!g)continue;let h=P(f,I(e,g,b),d,n,"#e9ff00",l&&e.startsWith("G"),c.id,e);h&&j.push(h)}if(l){let d=cw(c.id,h,i),e=new Set(h[c.id]||[]),f=0,g=0;for(let a=0;a<d.length;a++)g+=(h[d[a]]||[]).filter(a=>e.has(a)).length;for(let c=0;c<d.length;c++){let i=d[c],k=a[i];if(!k)continue;let l=(h[i]||[]).filter(a=>e.has(a));for(let c=0;c<l.length;c++){let d=l[c],e=a[d];if(!e)continue;let h=P(I(i,k,b),I(d,e,b),n+f,n+g,"#444444",!0,i,d);h&&(j.push(h),f++)}}}return j},[c?.id,s,e,a,h,i]);return((0,l.useEffect)(()=>{c?.id&&e&&0===Q.length&&requestAnimationFrame(()=>{t(a=>a+1)})},[c,e,Q.length]),Q.length)?(0,j.jsx)("group",{frustumCulled:!1,children:Q}):null},cC=function(){let{camera:b,gl:c}=(0,m.useThree)(),[d]=(0,ch.useStore)("selectedNodeStore",null),[e]=(0,ch.useStore)("highlightedNodesStore",[]),[f]=(0,ch.useStore)("secondaryHighlightedArticlesStore",[]),g=(0,l.useRef)(!1),h=(0,l.useRef)(null),i=(0,l.useRef)(!1);return(0,l.useEffect)(()=>{if(h.current=(0,ch.getStore)("elementOpacityStore"),!h.current){let{createStore:b}=a.r(9715);h.current=b("elementOpacityStore",{})}},[]),(0,l.useEffect)(()=>{let a=()=>{g.current=!0,i.current=!1},b=()=>{},d=c.domElement.parentElement?.querySelector("canvas")?.__r3f?.controls;if(d)return d.addEventListener("start",a),d.addEventListener("change",b),()=>{d.removeEventListener("start",a),d.removeEventListener("change",b)};let e=c.domElement,f=()=>{g.current=!0,i.current=!1};return e.addEventListener("mousedown",f),e.addEventListener("touchstart",f,{passive:!0}),()=>{e.removeEventListener("mousedown",f),e.removeEventListener("touchstart",f)}},[c]),(0,l.useEffect)(()=>{if(!h.current)return;if(!d?.id||!Array.isArray(e)||0===e.length)return void h.current.setState({});let a=new Set(Array.isArray(f)?f:[]),b={},c=new Set(e),g=d?.id,i=Array.from({length:29},(a,b)=>`A${b+1}`),j=Array.from({length:54},(a,b)=>`G${b+1}`),k=g?new Set(ck(g)):new Set;k.add(g),[...i,...j].forEach(d=>{let e=d.startsWith("G");d===g?b[d]=1:c.has(d)?(k.has(d),b[d]=1):(a.has(d),b[d]=e?.3:.15)}),h.current.setState(b)},[d,e,f]),(0,l.useEffect)(()=>{i.current||(g.current=!1)},[d]),null};var cD=a.i(80692),cE=a.i(22373),cF=a.i(38246),cG=a.i(50944),cH=a.i(578);function cI({close:a}){let b=(0,cG.usePathname)(),[c,d]=l.useState(null),[e,f]=l.useState(!0);l.useEffect(()=>{(async()=>{try{let a=await fetch("/data/info.json");if(!a.ok)throw Error("Failed to load info data");let c=await a.json(),e=c["/"===b?"/":b]||c["/living-continuity"];d(e)}catch(a){console.error("Error loading info data:",a),d({title:"Welcome",content:"To navigate in the digital exhibition, depending on the device you are currently browsing this space on you can use both your fingers or mouse. Zoom in or out, drag or pan to interact with the scene."})}finally{f(!1)}})()},[b]);let g=a=>a?a.split(/(\*[^*]+\*)/g).map((a,b)=>a.startsWith("*")&&a.endsWith("*")?(0,j.jsx)("em",{children:a.slice(1,-1)},b):(0,j.jsx)(l.Fragment,{children:a},b)):null;return e?(0,j.jsx)("div",{className:cH.default.modal_wrapper,children:(0,j.jsx)("div",{className:cH.default.content,children:(0,j.jsx)("p",{children:"Loading..."})})}):c?(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("div",{className:cH.default.modal_wrapper,children:[a&&(0,j.jsx)("div",{className:cH.default.close_button,onClick:a,children:(0,j.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,j.jsx)("line",{x1:"3",y1:"3",x2:"21",y2:"21",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round"}),(0,j.jsx)("line",{x1:"21",y1:"3",x2:"3",y2:"21",stroke:"#000000",strokeWidth:"1.5",strokeLinecap:"round"})]})}),(0,j.jsx)("div",{className:cH.default.content,children:c.content&&("string"==typeof c.content?(0,j.jsx)("p",{children:g(c.content)}):Array.isArray(c.content)?c.content.map((a,b)=>(0,j.jsx)("div",{children:a.text&&(0,j.jsx)("p",{children:g(a.text)})},b)):null)})]})}):null}var cJ=a.i(93827);function cK(){return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)("div",{className:cJ.default.camera_wrapper,children:(0,j.jsxs)("div",{className:`${cJ.default.camera_modal} button`,children:[(0,j.jsx)("a",{href:"https://livingcontinuity.publicdisplay.site/",className:cJ.default.link,children:(0,j.jsx)("div",{className:cJ.default.item,children:"Digital Exhibition"})}),(0,j.jsx)("a",{href:"https://glossary.publicdisplay.site/",className:cJ.default.link,children:(0,j.jsx)("div",{className:cJ.default.item,children:"Glossary"})}),(0,j.jsx)("a",{href:"https://kitofparts.publicdisplay.site/",className:cJ.default.link,children:(0,j.jsx)("div",{className:cJ.default.item,children:"Kit of Parts - Blended Home"})}),(0,j.jsx)("a",{href:"#",className:cJ.default.link,children:(0,j.jsx)("div",{className:cJ.default.item,children:"Kit of Parts - Blended Park (soon)"})}),(0,j.jsx)("a",{href:"https://supplement.publicdisplay.site/",className:cJ.default.link,children:(0,j.jsx)("div",{className:cJ.default.item,children:"Supplement"})}),(0,j.jsx)("a",{href:"http://toolkit.publicdisplay.site/",className:cJ.default.link,children:(0,j.jsx)("div",{className:cJ.default.item,children:"Toolkit"})})]})})})}function cL({title:a}){let[b,c]=l.useState(!1);l.useEffect(()=>{"Title Of The Entry"==a||""==a?c(!1):c(!0)},[a]);let[d,e]=l.useState(!1);function f(){e(!d)}let[g,h]=l.useState(!1);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:"isDesktop",children:(0,j.jsxs)("div",{className:cE.default.topbar_wrapper,children:[(0,j.jsx)(cF.default,{href:"/living-continuity",children:(0,j.jsx)("div",{className:`${cE.default.button} button`,children:"living continuity"})}),(0,j.jsx)("div",{className:`${cE.default.title} button`,children:"Title Of The Entry"!=a&&""!=a&&(0,j.jsx)("span",{children:a})}),(0,j.jsx)("div",{className:`${cE.default.button} button`,children:"Living Continuity"})]})}),(0,j.jsx)("div",{className:"isMobile",children:(0,j.jsxs)("div",{className:`${cE.default.topbar_wrapper} ${cE.default.topbar_wrapper_mobile}`,children:[(0,j.jsxs)("div",{className:cE.default.wrapper,onClick:()=>h(!g),role:"button",tabIndex:0,"aria-label":"Toggle scene modal",onKeyDown:a=>{("Enter"===a.key||" "===a.key)&&h(!g)},children:[(0,j.jsx)("div",{className:`${cE.default.full} ${cE.default.button} button full_button`,children:"living continuity"}),(0,j.jsx)("div",{className:`${g?"closed":"open"}`,children:(0,j.jsx)(cK,{})}),(0,j.jsx)("div",{className:`${cE.default.full} ${cE.default.button} button full_button`,children:"Living Continuity"}),(0,j.jsx)("button",{className:`${cE.default.half} ${cE.default.button} button`,onClick:()=>{f()},"aria-label":"Open info modal",children:"info"})]}),(0,j.jsx)("div",{className:`${cE.default.title} button`,children:"Title Of The Entry"!=a&&""!=a&&(0,j.jsx)("span",{children:a})})]})}),(0,j.jsx)(cD.default,{isOpen:d,contentLabel:"Example Modal",closeTimeoutMS:150,shouldCloseOnOverlayClick:!0,children:(0,j.jsx)(cI,{close:f})})]})}let cM=l.memo(({onClick:a})=>(0,j.jsxs)("div",{className:"living_continuity_button",onClick:a,children:[(0,j.jsx)("div",{className:"black_box",children:(0,j.jsx)("h1",{className:"main_text",children:"LIVING CONTINUITY"})}),(0,j.jsx)("span",{className:"enter_text",children:"enter"})]}));cM.displayName="LivingContinuityButton";var cN={value:()=>{}};function cO(){for(var a,b=0,c=arguments.length,d={};b<c;++b){if(!(a=arguments[b]+"")||a in d||/[\s.]/.test(a))throw Error("illegal type: "+a);d[a]=[]}return new cP(d)}function cP(a){this._=a}function cQ(a,b,c){for(var d=0,e=a.length;d<e;++d)if(a[d].name===b){a[d]=cN,a=a.slice(0,d).concat(a.slice(d+1));break}return null!=c&&a.push({name:b,value:c}),a}function cR(){}function cS(a){return null==a?cR:function(){return this.querySelector(a)}}function cT(){return[]}function cU(a){return null==a?cT:function(){return this.querySelectorAll(a)}}function cV(a){return function(){return this.matches(a)}}function cW(a){return function(b){return b.matches(a)}}cP.prototype=cO.prototype={constructor:cP,on:function(a,b){var c,d=this._,e=(a+"").trim().split(/^|\s+/).map(function(a){var b="",c=a.indexOf(".");if(c>=0&&(b=a.slice(c+1),a=a.slice(0,c)),a&&!d.hasOwnProperty(a))throw Error("unknown type: "+a);return{type:a,name:b}}),f=-1,g=e.length;if(arguments.length<2){for(;++f<g;)if((c=(a=e[f]).type)&&(c=function(a,b){for(var c,d=0,e=a.length;d<e;++d)if((c=a[d]).name===b)return c.value}(d[c],a.name)))return c;return}if(null!=b&&"function"!=typeof b)throw Error("invalid callback: "+b);for(;++f<g;)if(c=(a=e[f]).type)d[c]=cQ(d[c],a.name,b);else if(null==b)for(c in d)d[c]=cQ(d[c],a.name,null);return this},copy:function(){var a={},b=this._;for(var c in b)a[c]=b[c].slice();return new cP(a)},call:function(a,b){if((c=arguments.length-2)>0)for(var c,d,e=Array(c),f=0;f<c;++f)e[f]=arguments[f+2];if(!this._.hasOwnProperty(a))throw Error("unknown type: "+a);for(d=this._[a],f=0,c=d.length;f<c;++f)d[f].value.apply(b,e)},apply:function(a,b,c){if(!this._.hasOwnProperty(a))throw Error("unknown type: "+a);for(var d=this._[a],e=0,f=d.length;e<f;++e)d[e].value.apply(b,c)}};var cX=Array.prototype.find;function cY(){return this.firstElementChild}var cZ=Array.prototype.filter;function c$(){return Array.from(this.children)}function c_(a){return Array(a.length)}function c0(a,b){this.ownerDocument=a.ownerDocument,this.namespaceURI=a.namespaceURI,this._next=null,this._parent=a,this.__data__=b}function c1(a,b,c,d,e,f){for(var g,h=0,i=b.length,j=f.length;h<j;++h)(g=b[h])?(g.__data__=f[h],d[h]=g):c[h]=new c0(a,f[h]);for(;h<i;++h)(g=b[h])&&(e[h]=g)}function c2(a,b,c,d,e,f,g){var h,i,j,k=new Map,l=b.length,m=f.length,n=Array(l);for(h=0;h<l;++h)(i=b[h])&&(n[h]=j=g.call(i,i.__data__,h,b)+"",k.has(j)?e[h]=i:k.set(j,i));for(h=0;h<m;++h)j=g.call(a,f[h],h,f)+"",(i=k.get(j))?(d[h]=i,i.__data__=f[h],k.delete(j)):c[h]=new c0(a,f[h]);for(h=0;h<l;++h)(i=b[h])&&k.get(n[h])===i&&(e[h]=i)}function c3(a){return a.__data__}function c4(a,b){return a<b?-1:a>b?1:a>=b?0:NaN}c0.prototype={constructor:c0,appendChild:function(a){return this._parent.insertBefore(a,this._next)},insertBefore:function(a,b){return this._parent.insertBefore(a,b)},querySelector:function(a){return this._parent.querySelector(a)},querySelectorAll:function(a){return this._parent.querySelectorAll(a)}};var c5="http://www.w3.org/1999/xhtml";let c6={svg:"http://www.w3.org/2000/svg",xhtml:c5,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function c7(a){var b=a+="",c=b.indexOf(":");return c>=0&&"xmlns"!==(b=a.slice(0,c))&&(a=a.slice(c+1)),c6.hasOwnProperty(b)?{space:c6[b],local:a}:a}function c8(a){return a.ownerDocument&&a.ownerDocument.defaultView||a.document&&a||a.defaultView}function c9(a,b){return a.style.getPropertyValue(b)||c8(a).getComputedStyle(a,null).getPropertyValue(b)}function da(a){return a.trim().split(/^|\s+/)}function db(a){return a.classList||new dc(a)}function dc(a){this._node=a,this._names=da(a.getAttribute("class")||"")}function dd(a,b){for(var c=db(a),d=-1,e=b.length;++d<e;)c.add(b[d])}function de(a,b){for(var c=db(a),d=-1,e=b.length;++d<e;)c.remove(b[d])}function df(){this.textContent=""}function dg(){this.innerHTML=""}function dh(){this.nextSibling&&this.parentNode.appendChild(this)}function di(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function dj(a){var b=c7(a);return(b.local?function(a){return function(){return this.ownerDocument.createElementNS(a.space,a.local)}}:function(a){return function(){var b=this.ownerDocument,c=this.namespaceURI;return c===c5&&b.documentElement.namespaceURI===c5?b.createElement(a):b.createElementNS(c,a)}})(b)}function dk(){return null}function dl(){var a=this.parentNode;a&&a.removeChild(this)}function dm(){var a=this.cloneNode(!1),b=this.parentNode;return b?b.insertBefore(a,this.nextSibling):a}function dn(){var a=this.cloneNode(!0),b=this.parentNode;return b?b.insertBefore(a,this.nextSibling):a}function dp(a){return function(){var b=this.__on;if(b){for(var c,d=0,e=-1,f=b.length;d<f;++d)(c=b[d],a.type&&c.type!==a.type||c.name!==a.name)?b[++e]=c:this.removeEventListener(c.type,c.listener,c.options);++e?b.length=e:delete this.__on}}}function dq(a,b,c){return function(){var d,e=this.__on,f=function(a){b.call(this,a,this.__data__)};if(e){for(var g=0,h=e.length;g<h;++g)if((d=e[g]).type===a.type&&d.name===a.name){this.removeEventListener(d.type,d.listener,d.options),this.addEventListener(d.type,d.listener=f,d.options=c),d.value=b;return}}this.addEventListener(a.type,f,c),d={type:a.type,name:a.name,value:b,listener:f,options:c},e?e.push(d):this.__on=[d]}}function dr(a,b,c){var d=c8(a),e=d.CustomEvent;"function"==typeof e?e=new e(b,c):(e=d.document.createEvent("Event"),c?(e.initEvent(b,c.bubbles,c.cancelable),e.detail=c.detail):e.initEvent(b,!1,!1)),a.dispatchEvent(e)}dc.prototype={add:function(a){0>this._names.indexOf(a)&&(this._names.push(a),this._node.setAttribute("class",this._names.join(" ")))},remove:function(a){var b=this._names.indexOf(a);b>=0&&(this._names.splice(b,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(a){return this._names.indexOf(a)>=0}};var ds=[null];function dt(a,b){this._groups=a,this._parents=b}function du(){return new dt([[document.documentElement]],ds)}function dv(a,b,c){a.prototype=b.prototype=c,c.constructor=a}function dw(a,b){var c=Object.create(a.prototype);for(var d in b)c[d]=b[d];return c}function dx(){}dt.prototype=du.prototype={constructor:dt,select:function(a){"function"!=typeof a&&(a=cS(a));for(var b=this._groups,c=b.length,d=Array(c),e=0;e<c;++e)for(var f,g,h=b[e],i=h.length,j=d[e]=Array(i),k=0;k<i;++k)(f=h[k])&&(g=a.call(f,f.__data__,k,h))&&("__data__"in f&&(g.__data__=f.__data__),j[k]=g);return new dt(d,this._parents)},selectAll:function(a){if("function"==typeof a){var b;b=a,a=function(){var a;return a=b.apply(this,arguments),null==a?[]:Array.isArray(a)?a:Array.from(a)}}else a=cU(a);for(var c=this._groups,d=c.length,e=[],f=[],g=0;g<d;++g)for(var h,i=c[g],j=i.length,k=0;k<j;++k)(h=i[k])&&(e.push(a.call(h,h.__data__,k,i)),f.push(h));return new dt(e,f)},selectChild:function(a){var b;return this.select(null==a?cY:(b="function"==typeof a?a:cW(a),function(){return cX.call(this.children,b)}))},selectChildren:function(a){var b;return this.selectAll(null==a?c$:(b="function"==typeof a?a:cW(a),function(){return cZ.call(this.children,b)}))},filter:function(a){"function"!=typeof a&&(a=cV(a));for(var b=this._groups,c=b.length,d=Array(c),e=0;e<c;++e)for(var f,g=b[e],h=g.length,i=d[e]=[],j=0;j<h;++j)(f=g[j])&&a.call(f,f.__data__,j,g)&&i.push(f);return new dt(d,this._parents)},data:function(a,b){if(!arguments.length)return Array.from(this,c3);var c=b?c2:c1,d=this._parents,e=this._groups;"function"!=typeof a&&(s=a,a=function(){return s});for(var f=e.length,g=Array(f),h=Array(f),i=Array(f),j=0;j<f;++j){var k=d[j],l=e[j],m=l.length,n="object"==typeof(r=a.call(k,k&&k.__data__,j,d))&&"length"in r?r:Array.from(r),o=n.length,p=h[j]=Array(o),q=g[j]=Array(o);c(k,l,p,q,i[j]=Array(m),n,b);for(var r,s,t,u,v=0,w=0;v<o;++v)if(t=p[v]){for(v>=w&&(w=v+1);!(u=q[w])&&++w<o;);t._next=u||null}}return(g=new dt(g,d))._enter=h,g._exit=i,g},enter:function(){return new dt(this._enter||this._groups.map(c_),this._parents)},exit:function(){return new dt(this._exit||this._groups.map(c_),this._parents)},join:function(a,b,c){var d=this.enter(),e=this,f=this.exit();return"function"==typeof a?(d=a(d))&&(d=d.selection()):d=d.append(a+""),null!=b&&(e=b(e))&&(e=e.selection()),null==c?f.remove():c(f),d&&e?d.merge(e).order():e},merge:function(a){for(var b=a.selection?a.selection():a,c=this._groups,d=b._groups,e=c.length,f=d.length,g=Math.min(e,f),h=Array(e),i=0;i<g;++i)for(var j,k=c[i],l=d[i],m=k.length,n=h[i]=Array(m),o=0;o<m;++o)(j=k[o]||l[o])&&(n[o]=j);for(;i<e;++i)h[i]=c[i];return new dt(h,this._parents)},selection:function(){return this},order:function(){for(var a=this._groups,b=-1,c=a.length;++b<c;)for(var d,e=a[b],f=e.length-1,g=e[f];--f>=0;)(d=e[f])&&(g&&4^d.compareDocumentPosition(g)&&g.parentNode.insertBefore(d,g),g=d);return this},sort:function(a){function b(b,c){return b&&c?a(b.__data__,c.__data__):!b-!c}a||(a=c4);for(var c=this._groups,d=c.length,e=Array(d),f=0;f<d;++f){for(var g,h=c[f],i=h.length,j=e[f]=Array(i),k=0;k<i;++k)(g=h[k])&&(j[k]=g);j.sort(b)}return new dt(e,this._parents).order()},call:function(){var a=arguments[0];return arguments[0]=this,a.apply(null,arguments),this},nodes:function(){return Array.from(this)},node:function(){for(var a=this._groups,b=0,c=a.length;b<c;++b)for(var d=a[b],e=0,f=d.length;e<f;++e){var g=d[e];if(g)return g}return null},size:function(){let a=0;for(let b of this)++a;return a},empty:function(){return!this.node()},each:function(a){for(var b=this._groups,c=0,d=b.length;c<d;++c)for(var e,f=b[c],g=0,h=f.length;g<h;++g)(e=f[g])&&a.call(e,e.__data__,g,f);return this},attr:function(a,b){var c=c7(a);if(arguments.length<2){var d=this.node();return c.local?d.getAttributeNS(c.space,c.local):d.getAttribute(c)}return this.each((null==b?c.local?function(a){return function(){this.removeAttributeNS(a.space,a.local)}}:function(a){return function(){this.removeAttribute(a)}}:"function"==typeof b?c.local?function(a,b){return function(){var c=b.apply(this,arguments);null==c?this.removeAttributeNS(a.space,a.local):this.setAttributeNS(a.space,a.local,c)}}:function(a,b){return function(){var c=b.apply(this,arguments);null==c?this.removeAttribute(a):this.setAttribute(a,c)}}:c.local?function(a,b){return function(){this.setAttributeNS(a.space,a.local,b)}}:function(a,b){return function(){this.setAttribute(a,b)}})(c,b))},style:function(a,b,c){return arguments.length>1?this.each((null==b?function(a){return function(){this.style.removeProperty(a)}}:"function"==typeof b?function(a,b,c){return function(){var d=b.apply(this,arguments);null==d?this.style.removeProperty(a):this.style.setProperty(a,d,c)}}:function(a,b,c){return function(){this.style.setProperty(a,b,c)}})(a,b,null==c?"":c)):c9(this.node(),a)},property:function(a,b){return arguments.length>1?this.each((null==b?function(a){return function(){delete this[a]}}:"function"==typeof b?function(a,b){return function(){var c=b.apply(this,arguments);null==c?delete this[a]:this[a]=c}}:function(a,b){return function(){this[a]=b}})(a,b)):this.node()[a]},classed:function(a,b){var c=da(a+"");if(arguments.length<2){for(var d=db(this.node()),e=-1,f=c.length;++e<f;)if(!d.contains(c[e]))return!1;return!0}return this.each(("function"==typeof b?function(a,b){return function(){(b.apply(this,arguments)?dd:de)(this,a)}}:b?function(a){return function(){dd(this,a)}}:function(a){return function(){de(this,a)}})(c,b))},text:function(a){return arguments.length?this.each(null==a?df:("function"==typeof a?function(a){return function(){var b=a.apply(this,arguments);this.textContent=null==b?"":b}}:function(a){return function(){this.textContent=a}})(a)):this.node().textContent},html:function(a){return arguments.length?this.each(null==a?dg:("function"==typeof a?function(a){return function(){var b=a.apply(this,arguments);this.innerHTML=null==b?"":b}}:function(a){return function(){this.innerHTML=a}})(a)):this.node().innerHTML},raise:function(){return this.each(dh)},lower:function(){return this.each(di)},append:function(a){var b="function"==typeof a?a:dj(a);return this.select(function(){return this.appendChild(b.apply(this,arguments))})},insert:function(a,b){var c="function"==typeof a?a:dj(a),d=null==b?dk:"function"==typeof b?b:cS(b);return this.select(function(){return this.insertBefore(c.apply(this,arguments),d.apply(this,arguments)||null)})},remove:function(){return this.each(dl)},clone:function(a){return this.select(a?dn:dm)},datum:function(a){return arguments.length?this.property("__data__",a):this.node().__data__},on:function(a,b,c){var d,e,f=(a+"").trim().split(/^|\s+/).map(function(a){var b="",c=a.indexOf(".");return c>=0&&(b=a.slice(c+1),a=a.slice(0,c)),{type:a,name:b}}),g=f.length;if(arguments.length<2){var h=this.node().__on;if(h){for(var i,j=0,k=h.length;j<k;++j)for(d=0,i=h[j];d<g;++d)if((e=f[d]).type===i.type&&e.name===i.name)return i.value}return}for(d=0,h=b?dq:dp;d<g;++d)this.each(h(f[d],b,c));return this},dispatch:function(a,b){return this.each(("function"==typeof b?function(a,b){return function(){return dr(this,a,b.apply(this,arguments))}}:function(a,b){return function(){return dr(this,a,b)}})(a,b))},[Symbol.iterator]:function*(){for(var a=this._groups,b=0,c=a.length;b<c;++b)for(var d,e=a[b],f=0,g=e.length;f<g;++f)(d=e[f])&&(yield d)}};var dy="\\s*([+-]?\\d+)\\s*",dz="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",dA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",dB=/^#([0-9a-f]{3,8})$/,dC=RegExp(`^rgb\\(${dy},${dy},${dy}\\)$`),dD=RegExp(`^rgb\\(${dA},${dA},${dA}\\)$`),dE=RegExp(`^rgba\\(${dy},${dy},${dy},${dz}\\)$`),dF=RegExp(`^rgba\\(${dA},${dA},${dA},${dz}\\)$`),dG=RegExp(`^hsl\\(${dz},${dA},${dA}\\)$`),dH=RegExp(`^hsla\\(${dz},${dA},${dA},${dz}\\)$`),dI={aliceblue:0xf0f8ff,antiquewhite:0xfaebd7,aqua:65535,aquamarine:8388564,azure:0xf0ffff,beige:0xf5f5dc,bisque:0xffe4c4,black:0,blanchedalmond:0xffebcd,blue:255,blueviolet:9055202,brown:0xa52a2a,burlywood:0xdeb887,cadetblue:6266528,chartreuse:8388352,chocolate:0xd2691e,coral:0xff7f50,cornflowerblue:6591981,cornsilk:0xfff8dc,crimson:0xdc143c,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:0xb8860b,darkgray:0xa9a9a9,darkgreen:25600,darkgrey:0xa9a9a9,darkkhaki:0xbdb76b,darkmagenta:9109643,darkolivegreen:5597999,darkorange:0xff8c00,darkorchid:0x9932cc,darkred:9109504,darksalmon:0xe9967a,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:0xff1493,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:0xb22222,floralwhite:0xfffaf0,forestgreen:2263842,fuchsia:0xff00ff,gainsboro:0xdcdcdc,ghostwhite:0xf8f8ff,gold:0xffd700,goldenrod:0xdaa520,gray:8421504,green:32768,greenyellow:0xadff2f,grey:8421504,honeydew:0xf0fff0,hotpink:0xff69b4,indianred:0xcd5c5c,indigo:4915330,ivory:0xfffff0,khaki:0xf0e68c,lavender:0xe6e6fa,lavenderblush:0xfff0f5,lawngreen:8190976,lemonchiffon:0xfffacd,lightblue:0xadd8e6,lightcoral:0xf08080,lightcyan:0xe0ffff,lightgoldenrodyellow:0xfafad2,lightgray:0xd3d3d3,lightgreen:9498256,lightgrey:0xd3d3d3,lightpink:0xffb6c1,lightsalmon:0xffa07a,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:0xb0c4de,lightyellow:0xffffe0,lime:65280,limegreen:3329330,linen:0xfaf0e6,magenta:0xff00ff,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:0xba55d3,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:0xc71585,midnightblue:1644912,mintcream:0xf5fffa,mistyrose:0xffe4e1,moccasin:0xffe4b5,navajowhite:0xffdead,navy:128,oldlace:0xfdf5e6,olive:8421376,olivedrab:7048739,orange:0xffa500,orangered:0xff4500,orchid:0xda70d6,palegoldenrod:0xeee8aa,palegreen:0x98fb98,paleturquoise:0xafeeee,palevioletred:0xdb7093,papayawhip:0xffefd5,peachpuff:0xffdab9,peru:0xcd853f,pink:0xffc0cb,plum:0xdda0dd,powderblue:0xb0e0e6,purple:8388736,rebeccapurple:6697881,red:0xff0000,rosybrown:0xbc8f8f,royalblue:4286945,saddlebrown:9127187,salmon:0xfa8072,sandybrown:0xf4a460,seagreen:3050327,seashell:0xfff5ee,sienna:0xa0522d,silver:0xc0c0c0,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:0xfffafa,springgreen:65407,steelblue:4620980,tan:0xd2b48c,teal:32896,thistle:0xd8bfd8,tomato:0xff6347,turquoise:4251856,violet:0xee82ee,wheat:0xf5deb3,white:0xffffff,whitesmoke:0xf5f5f5,yellow:0xffff00,yellowgreen:0x9acd32};function dJ(){return this.rgb().formatHex()}function dK(){return this.rgb().formatRgb()}function dL(a){var b,c;return a=(a+"").trim().toLowerCase(),(b=dB.exec(a))?(c=b[1].length,b=parseInt(b[1],16),6===c?dM(b):3===c?new dP(b>>8&15|b>>4&240,b>>4&15|240&b,(15&b)<<4|15&b,1):8===c?dN(b>>24&255,b>>16&255,b>>8&255,(255&b)/255):4===c?dN(b>>12&15|b>>8&240,b>>8&15|b>>4&240,b>>4&15|240&b,((15&b)<<4|15&b)/255):null):(b=dC.exec(a))?new dP(b[1],b[2],b[3],1):(b=dD.exec(a))?new dP(255*b[1]/100,255*b[2]/100,255*b[3]/100,1):(b=dE.exec(a))?dN(b[1],b[2],b[3],b[4]):(b=dF.exec(a))?dN(255*b[1]/100,255*b[2]/100,255*b[3]/100,b[4]):(b=dG.exec(a))?dV(b[1],b[2]/100,b[3]/100,1):(b=dH.exec(a))?dV(b[1],b[2]/100,b[3]/100,b[4]):dI.hasOwnProperty(a)?dM(dI[a]):"transparent"===a?new dP(NaN,NaN,NaN,0):null}function dM(a){return new dP(a>>16&255,a>>8&255,255&a,1)}function dN(a,b,c,d){return d<=0&&(a=b=c=NaN),new dP(a,b,c,d)}function dO(a,b,c,d){var e;return 1==arguments.length?((e=a)instanceof dx||(e=dL(e)),e)?new dP((e=e.rgb()).r,e.g,e.b,e.opacity):new dP:new dP(a,b,c,null==d?1:d)}function dP(a,b,c,d){this.r=+a,this.g=+b,this.b=+c,this.opacity=+d}function dQ(){return`#${dU(this.r)}${dU(this.g)}${dU(this.b)}`}function dR(){let a=dS(this.opacity);return`${1===a?"rgb(":"rgba("}${dT(this.r)}, ${dT(this.g)}, ${dT(this.b)}${1===a?")":`, ${a})`}`}function dS(a){return isNaN(a)?1:Math.max(0,Math.min(1,a))}function dT(a){return Math.max(0,Math.min(255,Math.round(a)||0))}function dU(a){return((a=dT(a))<16?"0":"")+a.toString(16)}function dV(a,b,c,d){return d<=0?a=b=c=NaN:c<=0||c>=1?a=b=NaN:b<=0&&(a=NaN),new dX(a,b,c,d)}function dW(a){if(a instanceof dX)return new dX(a.h,a.s,a.l,a.opacity);if(a instanceof dx||(a=dL(a)),!a)return new dX;if(a instanceof dX)return a;var b=(a=a.rgb()).r/255,c=a.g/255,d=a.b/255,e=Math.min(b,c,d),f=Math.max(b,c,d),g=NaN,h=f-e,i=(f+e)/2;return h?(g=b===f?(c-d)/h+(c<d)*6:c===f?(d-b)/h+2:(b-c)/h+4,h/=i<.5?f+e:2-f-e,g*=60):h=i>0&&i<1?0:g,new dX(g,h,i,a.opacity)}function dX(a,b,c,d){this.h=+a,this.s=+b,this.l=+c,this.opacity=+d}function dY(a){return(a=(a||0)%360)<0?a+360:a}function dZ(a){return Math.max(0,Math.min(1,a||0))}function d$(a,b,c){return(a<60?b+(c-b)*a/60:a<180?c:a<240?b+(c-b)*(240-a)/60:b)*255}function d_(a,b,c,d,e){var f=a*a,g=f*a;return((1-3*a+3*f-g)*b+(4-6*f+3*g)*c+(1+3*a+3*f-3*g)*d+g*e)/6}dv(dx,dL,{copy(a){return Object.assign(new this.constructor,this,a)},displayable(){return this.rgb().displayable()},hex:dJ,formatHex:dJ,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return dW(this).formatHsl()},formatRgb:dK,toString:dK}),dv(dP,dO,dw(dx,{brighter(a){return a=null==a?1.4285714285714286:Math.pow(1.4285714285714286,a),new dP(this.r*a,this.g*a,this.b*a,this.opacity)},darker(a){return a=null==a?.7:Math.pow(.7,a),new dP(this.r*a,this.g*a,this.b*a,this.opacity)},rgb(){return this},clamp(){return new dP(dT(this.r),dT(this.g),dT(this.b),dS(this.opacity))},displayable(){return -.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:dQ,formatHex:dQ,formatHex8:function(){return`#${dU(this.r)}${dU(this.g)}${dU(this.b)}${dU((isNaN(this.opacity)?1:this.opacity)*255)}`},formatRgb:dR,toString:dR})),dv(dX,function(a,b,c,d){return 1==arguments.length?dW(a):new dX(a,b,c,null==d?1:d)},dw(dx,{brighter(a){return a=null==a?1.4285714285714286:Math.pow(1.4285714285714286,a),new dX(this.h,this.s,this.l*a,this.opacity)},darker(a){return a=null==a?.7:Math.pow(.7,a),new dX(this.h,this.s,this.l*a,this.opacity)},rgb(){var a=this.h%360+(this.h<0)*360,b=isNaN(a)||isNaN(this.s)?0:this.s,c=this.l,d=c+(c<.5?c:1-c)*b,e=2*c-d;return new dP(d$(a>=240?a-240:a+120,e,d),d$(a,e,d),d$(a<120?a+240:a-120,e,d),this.opacity)},clamp(){return new dX(dY(this.h),dZ(this.s),dZ(this.l),dS(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let a=dS(this.opacity);return`${1===a?"hsl(":"hsla("}${dY(this.h)}, ${100*dZ(this.s)}%, ${100*dZ(this.l)}%${1===a?")":`, ${a})`}`}}));let d0=a=>()=>a;function d1(a,b){var c=b-a;return c?function(b){return a+b*c}:d0(isNaN(a)?b:a)}let d2=function a(b){var c,d=1==(c=+b)?d1:function(a,b){var d,e,f;return b-a?(d=a,e=b,d=Math.pow(d,f=c),e=Math.pow(e,f)-d,f=1/f,function(a){return Math.pow(d+a*e,f)}):d0(isNaN(a)?b:a)};function e(a,b){var c=d((a=dO(a)).r,(b=dO(b)).r),e=d(a.g,b.g),f=d(a.b,b.b),g=d1(a.opacity,b.opacity);return function(b){return a.r=c(b),a.g=e(b),a.b=f(b),a.opacity=g(b),a+""}}return e.gamma=a,e}(1);function d3(a){return function(b){var c,d,e=b.length,f=Array(e),g=Array(e),h=Array(e);for(c=0;c<e;++c)d=dO(b[c]),f[c]=d.r||0,g[c]=d.g||0,h[c]=d.b||0;return f=a(f),g=a(g),h=a(h),d.opacity=1,function(a){return d.r=f(a),d.g=g(a),d.b=h(a),d+""}}}function d4(a,b){return a*=1,b*=1,function(c){return a*(1-c)+b*c}}d3(function(a){var b=a.length-1;return function(c){var d=c<=0?c=0:c>=1?(c=1,b-1):Math.floor(c*b),e=a[d],f=a[d+1],g=d>0?a[d-1]:2*e-f,h=d<b-1?a[d+2]:2*f-e;return d_((c-d/b)*b,g,e,f,h)}}),d3(function(a){var b=a.length;return function(c){var d=Math.floor(((c%=1)<0?++c:c)*b),e=a[(d+b-1)%b],f=a[d%b],g=a[(d+1)%b],h=a[(d+2)%b];return d_((c-d/b)*b,e,f,g,h)}});var d5,d6,d7,d8=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,d9=RegExp(d8.source,"g"),ea=0,eb=0,ec=0,ed=0,ee=0,ef=0,eg="object"==typeof performance&&performance.now?performance:Date,eh=function(a){setTimeout(a,17)};function ei(){return ee||(eh(ej),ee=eg.now()+ef)}function ej(){ee=0}function ek(){this._call=this._time=this._next=null}function el(a,b,c){var d=new ek;return d.restart(a,b,c),d}function em(){ee=(ed=eg.now())+ef,ea=eb=0;try{ei(),++ea;for(var a,b=d6;b;)(a=ee-b._time)>=0&&b._call.call(void 0,a),b=b._next;--ea}finally{ea=0,function(){for(var a,b,c=d6,d=1/0;c;)c._call?(d>c._time&&(d=c._time),a=c,c=c._next):(b=c._next,c._next=null,c=a?a._next=b:d6=b);d7=a,eo(d)}(),ee=0}}function en(){var a=eg.now(),b=a-ed;b>1e3&&(ef-=b,ed=a)}function eo(a){!ea&&(eb&&(eb=clearTimeout(eb)),a-ee>24?(a<1/0&&(eb=setTimeout(em,a-eg.now()-ef)),ec&&(ec=clearInterval(ec))):(ec||(ed=eg.now(),ec=setInterval(en,1e3)),ea=1,eh(em)))}function ep(a,b,c){var d=new ek;return b=null==b?0:+b,d.restart(c=>{d.stop(),a(c+b)},b,c),d}ek.prototype=el.prototype={constructor:ek,restart:function(a,b,c){if("function"!=typeof a)throw TypeError("callback is not a function");c=(null==c?ei():+c)+(null==b?0:+b),this._next||d7===this||(d7?d7._next=this:d6=this,d7=this),this._call=a,this._time=c,eo()},stop:function(){this._call&&(this._call=null,this._time=1/0,eo())}};var eq=cO("start","end","cancel","interrupt"),er=[];function es(a,b,c,d,e,f){var g=a.__transition;if(g){if(c in g)return}else a.__transition={};!function(a,b,c){var d,e=a.__transition;function f(i){var j,k,l,m;if(1!==c.state)return h();for(j in e)if((m=e[j]).name===c.name){if(3===m.state)return ep(f);4===m.state?(m.state=6,m.timer.stop(),m.on.call("interrupt",a,a.__data__,m.index,m.group),delete e[j]):+j<b&&(m.state=6,m.timer.stop(),m.on.call("cancel",a,a.__data__,m.index,m.group),delete e[j])}if(ep(function(){3===c.state&&(c.state=4,c.timer.restart(g,c.delay,c.time),g(i))}),c.state=2,c.on.call("start",a,a.__data__,c.index,c.group),2===c.state){for(j=0,c.state=3,d=Array(l=c.tween.length),k=-1;j<l;++j)(m=c.tween[j].value.call(a,a.__data__,c.index,c.group))&&(d[++k]=m);d.length=k+1}}function g(b){for(var e=b<c.duration?c.ease.call(null,b/c.duration):(c.timer.restart(h),c.state=5,1),f=-1,g=d.length;++f<g;)d[f].call(a,e);5===c.state&&(c.on.call("end",a,a.__data__,c.index,c.group),h())}function h(){for(var d in c.state=6,c.timer.stop(),delete e[b],e)return;delete a.__transition}e[b]=c,c.timer=el(function(a){c.state=1,c.timer.restart(f,c.delay,c.time),c.delay<=a&&f(a-c.delay)},0,c.time)}(a,c,{name:b,index:d,group:e,on:eq,tween:er,time:f.time,delay:f.delay,duration:f.duration,ease:f.ease,timer:null,state:0})}function et(a,b){var c=ev(a,b);if(c.state>0)throw Error("too late; already scheduled");return c}function eu(a,b){var c=ev(a,b);if(c.state>3)throw Error("too late; already running");return c}function ev(a,b){var c=a.__transition;if(!c||!(c=c[b]))throw Error("transition not found");return c}var ew=180/Math.PI,ex={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function ey(a,b,c,d,e,f){var g,h,i;return(g=Math.sqrt(a*a+b*b))&&(a/=g,b/=g),(i=a*c+b*d)&&(c-=a*i,d-=b*i),(h=Math.sqrt(c*c+d*d))&&(c/=h,d/=h,i/=h),a*d<b*c&&(a=-a,b=-b,i=-i,g=-g),{translateX:e,translateY:f,rotate:Math.atan2(b,a)*ew,skewX:Math.atan(i)*ew,scaleX:g,scaleY:h}}function ez(a,b,c,d){function e(a){return a.length?a.pop()+" ":""}return function(f,g){var h,i,j,k,l=[],m=[];return f=a(f),g=a(g),!function(a,d,e,f,g,h){if(a!==e||d!==f){var i=g.push("translate(",null,b,null,c);h.push({i:i-4,x:d4(a,e)},{i:i-2,x:d4(d,f)})}else(e||f)&&g.push("translate("+e+b+f+c)}(f.translateX,f.translateY,g.translateX,g.translateY,l,m),h=f.rotate,i=g.rotate,h!==i?(h-i>180?i+=360:i-h>180&&(h+=360),m.push({i:l.push(e(l)+"rotate(",null,d)-2,x:d4(h,i)})):i&&l.push(e(l)+"rotate("+i+d),j=f.skewX,k=g.skewX,j!==k?m.push({i:l.push(e(l)+"skewX(",null,d)-2,x:d4(j,k)}):k&&l.push(e(l)+"skewX("+k+d),!function(a,b,c,d,f,g){if(a!==c||b!==d){var h=f.push(e(f)+"scale(",null,",",null,")");g.push({i:h-4,x:d4(a,c)},{i:h-2,x:d4(b,d)})}else(1!==c||1!==d)&&f.push(e(f)+"scale("+c+","+d+")")}(f.scaleX,f.scaleY,g.scaleX,g.scaleY,l,m),f=g=null,function(a){for(var b,c=-1,d=m.length;++c<d;)l[(b=m[c]).i]=b.x(a);return l.join("")}}}var eA=ez(function(a){let b=new("function"==typeof DOMMatrix?DOMMatrix:WebKitCSSMatrix)(a+"");return b.isIdentity?ex:ey(b.a,b.b,b.c,b.d,b.e,b.f)},"px, ","px)","deg)"),eB=ez(function(a){return null==a?ex:(i||(i=document.createElementNS("http://www.w3.org/2000/svg","g")),i.setAttribute("transform",a),a=i.transform.baseVal.consolidate())?ey((a=a.matrix).a,a.b,a.c,a.d,a.e,a.f):ex},", ",")",")");function eC(a,b,c){var d=a._id;return a.each(function(){var a=eu(this,d);(a.value||(a.value={}))[b]=c.apply(this,arguments)}),function(a){return ev(a,d).value[b]}}function eD(a,b){var c;return("number"==typeof b?d4:b instanceof dL?d2:(c=dL(b))?(b=c,d2):function(a,b){var c,d,e,f,g,h=d8.lastIndex=d9.lastIndex=0,i=-1,j=[],k=[];for(a+="",b+="";(e=d8.exec(a))&&(f=d9.exec(b));)(g=f.index)>h&&(g=b.slice(h,g),j[i]?j[i]+=g:j[++i]=g),(e=e[0])===(f=f[0])?j[i]?j[i]+=f:j[++i]=f:(j[++i]=null,k.push({i:i,x:d4(e,f)})),h=d9.lastIndex;return h<b.length&&(g=b.slice(h),j[i]?j[i]+=g:j[++i]=g),j.length<2?k[0]?(c=k[0].x,function(a){return c(a)+""}):(d=b,function(){return d}):(b=k.length,function(a){for(var c,d=0;d<b;++d)j[(c=k[d]).i]=c.x(a);return j.join("")})})(a,b)}var eE=du.prototype.constructor;function eF(a){return function(){this.style.removeProperty(a)}}var eG=0;function eH(a,b,c,d){this._groups=a,this._parents=b,this._name=c,this._id=d}var eI=du.prototype;eH.prototype=(function(a){return du().transition(a)}).prototype={constructor:eH,select:function(a){var b=this._name,c=this._id;"function"!=typeof a&&(a=cS(a));for(var d=this._groups,e=d.length,f=Array(e),g=0;g<e;++g)for(var h,i,j=d[g],k=j.length,l=f[g]=Array(k),m=0;m<k;++m)(h=j[m])&&(i=a.call(h,h.__data__,m,j))&&("__data__"in h&&(i.__data__=h.__data__),l[m]=i,es(l[m],b,c,m,l,ev(h,c)));return new eH(f,this._parents,b,c)},selectAll:function(a){var b=this._name,c=this._id;"function"!=typeof a&&(a=cU(a));for(var d=this._groups,e=d.length,f=[],g=[],h=0;h<e;++h)for(var i,j=d[h],k=j.length,l=0;l<k;++l)if(i=j[l]){for(var m,n=a.call(i,i.__data__,l,j),o=ev(i,c),p=0,q=n.length;p<q;++p)(m=n[p])&&es(m,b,c,p,n,o);f.push(n),g.push(i)}return new eH(f,g,b,c)},selectChild:eI.selectChild,selectChildren:eI.selectChildren,filter:function(a){"function"!=typeof a&&(a=cV(a));for(var b=this._groups,c=b.length,d=Array(c),e=0;e<c;++e)for(var f,g=b[e],h=g.length,i=d[e]=[],j=0;j<h;++j)(f=g[j])&&a.call(f,f.__data__,j,g)&&i.push(f);return new eH(d,this._parents,this._name,this._id)},merge:function(a){if(a._id!==this._id)throw Error();for(var b=this._groups,c=a._groups,d=b.length,e=c.length,f=Math.min(d,e),g=Array(d),h=0;h<f;++h)for(var i,j=b[h],k=c[h],l=j.length,m=g[h]=Array(l),n=0;n<l;++n)(i=j[n]||k[n])&&(m[n]=i);for(;h<d;++h)g[h]=b[h];return new eH(g,this._parents,this._name,this._id)},selection:function(){return new eE(this._groups,this._parents)},transition:function(){for(var a=this._name,b=this._id,c=++eG,d=this._groups,e=d.length,f=0;f<e;++f)for(var g,h=d[f],i=h.length,j=0;j<i;++j)if(g=h[j]){var k=ev(g,b);es(g,a,c,j,h,{time:k.time+k.delay+k.duration,delay:0,duration:k.duration,ease:k.ease})}return new eH(d,this._parents,a,c)},call:eI.call,nodes:eI.nodes,node:eI.node,size:eI.size,empty:eI.empty,each:eI.each,on:function(a,b){var c,d,e,f,g,h,i=this._id;return arguments.length<2?ev(this.node(),i).on.on(a):this.each((c=i,d=a,e=b,h=(d+"").trim().split(/^|\s+/).every(function(a){var b=a.indexOf(".");return b>=0&&(a=a.slice(0,b)),!a||"start"===a})?et:eu,function(){var a=h(this,c),b=a.on;b!==f&&(g=(f=b).copy()).on(d,e),a.on=g}))},attr:function(a,b){var c=c7(a),d="transform"===c?eB:eD;return this.attrTween(a,"function"==typeof b?(c.local?function(a,b,c){var d,e,f;return function(){var g,h,i=c(this);return null==i?void this.removeAttributeNS(a.space,a.local):(g=this.getAttributeNS(a.space,a.local))===(h=i+"")?null:g===d&&h===e?f:(e=h,f=b(d=g,i))}}:function(a,b,c){var d,e,f;return function(){var g,h,i=c(this);return null==i?void this.removeAttribute(a):(g=this.getAttribute(a))===(h=i+"")?null:g===d&&h===e?f:(e=h,f=b(d=g,i))}})(c,d,eC(this,"attr."+a,b)):null==b?(c.local?function(a){return function(){this.removeAttributeNS(a.space,a.local)}}:function(a){return function(){this.removeAttribute(a)}})(c):(c.local?function(a,b,c){var d,e,f=c+"";return function(){var g=this.getAttributeNS(a.space,a.local);return g===f?null:g===d?e:e=b(d=g,c)}}:function(a,b,c){var d,e,f=c+"";return function(){var g=this.getAttribute(a);return g===f?null:g===d?e:e=b(d=g,c)}})(c,d,b))},attrTween:function(a,b){var c="attr."+a;if(arguments.length<2)return(c=this.tween(c))&&c._value;if(null==b)return this.tween(c,null);if("function"!=typeof b)throw Error();var d=c7(a);return this.tween(c,(d.local?function(a,b){var c,d;function e(){var e=b.apply(this,arguments);return e!==d&&(c=(d=e)&&function(b){this.setAttributeNS(a.space,a.local,e.call(this,b))}),c}return e._value=b,e}:function(a,b){var c,d;function e(){var e=b.apply(this,arguments);return e!==d&&(c=(d=e)&&function(b){this.setAttribute(a,e.call(this,b))}),c}return e._value=b,e})(d,b))},style:function(a,b,c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y="transform"==(a+="")?eA:eD;return null==b?this.styleTween(a,(d=a,function(){var a=c9(this,d),b=(this.style.removeProperty(d),c9(this,d));return a===b?null:a===e&&b===f?g:g=y(e=a,f=b)})).on("end.style."+a,eF(a)):"function"==typeof b?this.styleTween(a,(h=a,i=eC(this,"style."+a,b),function(){var a=c9(this,h),b=i(this),c=b+"";return null==b&&(this.style.removeProperty(h),c=b=c9(this,h)),a===c?null:a===j&&c===k?l:(k=c,l=y(j=a,b))})).each((m=this._id,t="end."+(s="style."+(n=a)),function(){var a=eu(this,m),b=a.on,c=null==a.value[s]?r||(r=eF(n)):void 0;(b!==o||q!==c)&&(p=(o=b).copy()).on(t,q=c),a.on=p})):this.styleTween(a,(u=a,x=b+"",function(){var a=c9(this,u);return a===x?null:a===v?w:w=y(v=a,b)}),c).on("end.style."+a,null)},styleTween:function(a,b,c){var d="style."+(a+="");if(arguments.length<2)return(d=this.tween(d))&&d._value;if(null==b)return this.tween(d,null);if("function"!=typeof b)throw Error();return this.tween(d,function(a,b,c){var d,e;function f(){var f=b.apply(this,arguments);return f!==e&&(d=(e=f)&&function(b){this.style.setProperty(a,f.call(this,b),c)}),d}return f._value=b,f}(a,b,null==c?"":c))},text:function(a){var b,c;return this.tween("text","function"==typeof a?(b=eC(this,"text",a),function(){var a=b(this);this.textContent=null==a?"":a}):(c=null==a?"":a+"",function(){this.textContent=c}))},textTween:function(a){var b="text";if(arguments.length<1)return(b=this.tween(b))&&b._value;if(null==a)return this.tween(b,null);if("function"!=typeof a)throw Error();return this.tween(b,function(a){var b,c;function d(){var d=a.apply(this,arguments);return d!==c&&(b=(c=d)&&function(a){this.textContent=d.call(this,a)}),b}return d._value=a,d}(a))},remove:function(){var a;return this.on("end.remove",(a=this._id,function(){var b=this.parentNode;for(var c in this.__transition)if(+c!==a)return;b&&b.removeChild(this)}))},tween:function(a,b){var c=this._id;if(a+="",arguments.length<2){for(var d,e=ev(this.node(),c).tween,f=0,g=e.length;f<g;++f)if((d=e[f]).name===a)return d.value;return null}return this.each((null==b?function(a,b){var c,d;return function(){var e=eu(this,a),f=e.tween;if(f!==c){d=c=f;for(var g=0,h=d.length;g<h;++g)if(d[g].name===b){(d=d.slice()).splice(g,1);break}}e.tween=d}}:function(a,b,c){var d,e;if("function"!=typeof c)throw Error();return function(){var f=eu(this,a),g=f.tween;if(g!==d){e=(d=g).slice();for(var h={name:b,value:c},i=0,j=e.length;i<j;++i)if(e[i].name===b){e[i]=h;break}i===j&&e.push(h)}f.tween=e}})(c,a,b))},delay:function(a){var b=this._id;return arguments.length?this.each(("function"==typeof a?function(a,b){return function(){et(this,a).delay=+b.apply(this,arguments)}}:function(a,b){return b*=1,function(){et(this,a).delay=b}})(b,a)):ev(this.node(),b).delay},duration:function(a){var b=this._id;return arguments.length?this.each(("function"==typeof a?function(a,b){return function(){eu(this,a).duration=+b.apply(this,arguments)}}:function(a,b){return b*=1,function(){eu(this,a).duration=b}})(b,a)):ev(this.node(),b).duration},ease:function(a){var b=this._id;return arguments.length?this.each(function(a,b){if("function"!=typeof b)throw Error();return function(){eu(this,a).ease=b}}(b,a)):ev(this.node(),b).ease},easeVarying:function(a){var b;if("function"!=typeof a)throw Error();return this.each((b=this._id,function(){var c=a.apply(this,arguments);if("function"!=typeof c)throw Error();eu(this,b).ease=c}))},end:function(){var a,b,c=this,d=c._id,e=c.size();return new Promise(function(f,g){var h={value:g},i={value:function(){0==--e&&f()}};c.each(function(){var c=eu(this,d),e=c.on;e!==a&&((b=(a=e).copy())._.cancel.push(h),b._.interrupt.push(h),b._.end.push(i)),c.on=b}),0===e&&f()})},[Symbol.iterator]:eI[Symbol.iterator]};var eJ={time:null,delay:0,duration:250,ease:function(a){return((a*=2)<=1?a*a*a:(a-=2)*a*a+2)/2}};du.prototype.interrupt=function(a){return this.each(function(){!function(a,b){var c,d,e,f=a.__transition,g=!0;if(f){for(e in b=null==b?null:b+"",f){if((c=f[e]).name!==b){g=!1;continue}d=c.state>2&&c.state<5,c.state=6,c.timer.stop(),c.on.call(d?"interrupt":"cancel",a,a.__data__,c.index,c.group),delete f[e]}g&&delete a.__transition}}(this,a)})},du.prototype.transition=function(a){var b,c;a instanceof eH?(b=a._id,a=a._name):(b=++eG,(c=eJ).time=ei(),a=null==a?null:a+"");for(var d=this._groups,e=d.length,f=0;f<e;++f)for(var g,h=d[f],i=h.length,j=0;j<i;++j)(g=h[j])&&es(g,a,b,j,h,c||function(a,b){for(var c;!(c=a.__transition)||!(c=c[b]);)if(!(a=a.parentNode))throw Error(`transition ${b} not found`);return c}(g,b));return new eH(d,this._parents,a,b)},a.s([],78149);let{abs:eK,max:eL,min:eM}=Math;function eN(a){return{type:a}}function eO(a){return((a=Math.exp(a))+1/a)/2}function eP(a,b,c){this.k=a,this.x=b,this.y=c}["w","e"].map(eN),["n","s"].map(eN),["n","w","e","s","nw","ne","sw","se"].map(eN),!function a(b,c,d){function e(a,e){var f,g,h=a[0],i=a[1],j=a[2],k=e[0],l=e[1],m=e[2],n=k-h,o=l-i,p=n*n+o*o;if(p<1e-12)g=Math.log(m/j)/b,f=function(a){return[h+a*n,i+a*o,j*Math.exp(b*a*g)]};else{var q=Math.sqrt(p),r=(m*m-j*j+d*p)/(2*j*c*q),s=(m*m-j*j-d*p)/(2*m*c*q),t=Math.log(Math.sqrt(r*r+1)-r);g=(Math.log(Math.sqrt(s*s+1)-s)-t)/b,f=function(a){var d,e,f=a*g,k=eO(t),l=j/(c*q)*(k*(((d=Math.exp(2*(d=b*f+t)))-1)/(d+1))-((e=Math.exp(e=t))-1/e)/2);return[h+l*n,i+l*o,j*k/eO(b*f+t)]}}return f.duration=1e3*g*b/Math.SQRT2,f}return e.rho=function(b){var c=Math.max(.001,+b),d=c*c;return a(c,d,d*d)},e}(Math.SQRT2,2,4),eP.prototype={constructor:eP,scale:function(a){return 1===a?this:new eP(this.k*a,this.x,this.y)},translate:function(a,b){return 0===a&0===b?this:new eP(this.k,this.x+this.k*a,this.y+this.k*b)},apply:function(a){return[a[0]*this.k+this.x,a[1]*this.k+this.y]},applyX:function(a){return a*this.k+this.x},applyY:function(a){return a*this.k+this.y},invert:function(a){return[(a[0]-this.x)/this.k,(a[1]-this.y)/this.k]},invertX:function(a){return(a-this.x)/this.k},invertY:function(a){return(a-this.y)/this.k},rescaleX:function(a){return a.copy().domain(a.range().map(this.invertX,this).map(a.invert,a))},rescaleY:function(a){return a.copy().domain(a.range().map(this.invertY,this).map(a.invert,a))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};new eP(1,0,0);function eQ(a,b,c,d){if(isNaN(b)||isNaN(c))return a;var e,f,g,h,i,j,k,l,m,n=a._root,o={data:d},p=a._x0,q=a._y0,r=a._x1,s=a._y1;if(!n)return a._root=o,a;for(;n.length;)if((j=b>=(f=(p+r)/2))?p=f:r=f,(k=c>=(g=(q+s)/2))?q=g:s=g,e=n,!(n=n[l=k<<1|j]))return e[l]=o,a;if(h=+a._x.call(null,n.data),i=+a._y.call(null,n.data),b===h&&c===i)return o.next=n,e?e[l]=o:a._root=o,a;do e=e?e[l]=[,,,,]:a._root=[,,,,],(j=b>=(f=(p+r)/2))?p=f:r=f,(k=c>=(g=(q+s)/2))?q=g:s=g;while((l=k<<1|j)==(m=(i>=g)<<1|h>=f))return e[m]=n,e[l]=o,a}function eR(a,b,c,d,e){this.node=a,this.x0=b,this.y0=c,this.x1=d,this.y1=e}function eS(a){return a[0]}function eT(a){return a[1]}function eU(a,b,c,d,e,f){this._x=a,this._y=b,this._x0=c,this._y0=d,this._x1=e,this._y1=f,this._root=void 0}function eV(a){for(var b={data:a.data},c=b;a=a.next;)c=c.next={data:a.data};return b}eP.prototype;var eW=(function(a,b,c){var d=new eU(null==b?eS:b,null==c?eT:c,NaN,NaN,NaN,NaN);return null==a?d:d.addAll(a)}).prototype=eU.prototype;eW.copy=function(){var a,b,c=new eU(this._x,this._y,this._x0,this._y0,this._x1,this._y1),d=this._root;if(!d)return c;if(!d.length)return c._root=eV(d),c;for(a=[{source:d,target:c._root=[,,,,]}];d=a.pop();)for(var e=0;e<4;++e)(b=d.source[e])&&(b.length?a.push({source:b,target:d.target[e]=[,,,,]}):d.target[e]=eV(b));return c},eW.add=function(a){let b=+this._x.call(null,a),c=+this._y.call(null,a);return eQ(this.cover(b,c),b,c,a)},eW.addAll=function(a){var b,c,d,e,f=a.length,g=Array(f),h=Array(f),i=1/0,j=1/0,k=-1/0,l=-1/0;for(c=0;c<f;++c)!(isNaN(d=+this._x.call(null,b=a[c]))||isNaN(e=+this._y.call(null,b)))&&(g[c]=d,h[c]=e,d<i&&(i=d),d>k&&(k=d),e<j&&(j=e),e>l&&(l=e));if(i>k||j>l)return this;for(this.cover(i,j).cover(k,l),c=0;c<f;++c)eQ(this,g[c],h[c],a[c]);return this},eW.cover=function(a,b){if(isNaN(a*=1)||isNaN(b*=1))return this;var c=this._x0,d=this._y0,e=this._x1,f=this._y1;if(isNaN(c))e=(c=Math.floor(a))+1,f=(d=Math.floor(b))+1;else{for(var g,h,i=e-c||1,j=this._root;c>a||a>=e||d>b||b>=f;)switch(h=(b<d)<<1|a<c,(g=[,,,,])[h]=j,j=g,i*=2,h){case 0:e=c+i,f=d+i;break;case 1:c=e-i,f=d+i;break;case 2:e=c+i,d=f-i;break;case 3:c=e-i,d=f-i}this._root&&this._root.length&&(this._root=j)}return this._x0=c,this._y0=d,this._x1=e,this._y1=f,this},eW.data=function(){var a=[];return this.visit(function(b){if(!b.length)do a.push(b.data);while(b=b.next)}),a},eW.extent=function(a){return arguments.length?this.cover(+a[0][0],+a[0][1]).cover(+a[1][0],+a[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]},eW.find=function(a,b,c){var d,e,f,g,h,i,j,k=this._x0,l=this._y0,m=this._x1,n=this._y1,o=[],p=this._root;for(p&&o.push(new eR(p,k,l,m,n)),null==c?c=1/0:(k=a-c,l=b-c,m=a+c,n=b+c,c*=c);i=o.pop();)if((p=i.node)&&!((e=i.x0)>m)&&!((f=i.y0)>n)&&!((g=i.x1)<k)&&!((h=i.y1)<l))if(p.length){var q=(e+g)/2,r=(f+h)/2;o.push(new eR(p[3],q,r,g,h),new eR(p[2],e,r,q,h),new eR(p[1],q,f,g,r),new eR(p[0],e,f,q,r)),(j=(b>=r)<<1|a>=q)&&(i=o[o.length-1],o[o.length-1]=o[o.length-1-j],o[o.length-1-j]=i)}else{var s=a-this._x.call(null,p.data),t=b-this._y.call(null,p.data),u=s*s+t*t;if(u<c){var v=Math.sqrt(c=u);k=a-v,l=b-v,m=a+v,n=b+v,d=p.data}}return d},eW.remove=function(a){if(isNaN(f=+this._x.call(null,a))||isNaN(g=+this._y.call(null,a)))return this;var b,c,d,e,f,g,h,i,j,k,l,m,n=this._root,o=this._x0,p=this._y0,q=this._x1,r=this._y1;if(!n)return this;if(n.length)for(;;){if((j=f>=(h=(o+q)/2))?o=h:q=h,(k=g>=(i=(p+r)/2))?p=i:r=i,b=n,!(n=n[l=k<<1|j]))return this;if(!n.length)break;(b[l+1&3]||b[l+2&3]||b[l+3&3])&&(c=b,m=l)}for(;n.data!==a;)if(d=n,!(n=n.next))return this;return((e=n.next)&&delete n.next,d)?e?d.next=e:delete d.next:b?(e?b[l]=e:delete b[l],(n=b[0]||b[1]||b[2]||b[3])&&n===(b[3]||b[2]||b[1]||b[0])&&!n.length&&(c?c[m]=n:this._root=n)):this._root=e,this},eW.removeAll=function(a){for(var b=0,c=a.length;b<c;++b)this.remove(a[b]);return this},eW.root=function(){return this._root},eW.size=function(){var a=0;return this.visit(function(b){if(!b.length)do++a;while(b=b.next)}),a},eW.visit=function(a){var b,c,d,e,f,g,h=[],i=this._root;for(i&&h.push(new eR(i,this._x0,this._y0,this._x1,this._y1));b=h.pop();)if(!a(i=b.node,d=b.x0,e=b.y0,f=b.x1,g=b.y1)&&i.length){var j=(d+f)/2,k=(e+g)/2;(c=i[3])&&h.push(new eR(c,j,k,f,g)),(c=i[2])&&h.push(new eR(c,d,k,j,g)),(c=i[1])&&h.push(new eR(c,j,e,f,k)),(c=i[0])&&h.push(new eR(c,d,e,j,k))}return this},eW.visitAfter=function(a){var b,c=[],d=[];for(this._root&&c.push(new eR(this._root,this._x0,this._y0,this._x1,this._y1));b=c.pop();){var e=b.node;if(e.length){var f,g=b.x0,h=b.y0,i=b.x1,j=b.y1,k=(g+i)/2,l=(h+j)/2;(f=e[0])&&c.push(new eR(f,g,h,k,l)),(f=e[1])&&c.push(new eR(f,k,h,i,l)),(f=e[2])&&c.push(new eR(f,g,l,k,j)),(f=e[3])&&c.push(new eR(f,k,l,i,j))}d.push(b)}for(;b=d.pop();)a(b.node,b.x0,b.y0,b.x1,b.y1);return this},eW.x=function(a){return arguments.length?(this._x=a,this):this._x},eW.y=function(a){return arguments.length?(this._y=a,this):this._y},a.i(78149);var eX=a.i(19163),eY=a.i(70033),eZ=a.i(978);function e$(){return new r.MeshStandardMaterial({color:0xffffff,transparent:!0,opacity:.9,metalness:.1,roughness:.8})}function e_(a,b){let[,c]=(0,ch.useStore)("selectedNodeStore",null);ck(a).length;let d=(0,l.useRef)(!1),e=(0,l.useRef)(a);(0,l.useEffect)(()=>{e.current=a},[a]),(0,l.useEffect)(()=>{if(a)return b&&!d.current&&requestAnimationFrame(()=>{c({id:a,ts:Date.now()})}),!b&&d.current&&requestAnimationFrame(()=>{c(a=>a?.id===e.current?null:a)}),d.current=b,()=>{d.current&&e.current===a&&requestAnimationFrame(()=>{c(a=>a?.id===e.current?null:a)})}},[b,a,c])}function e0(a){let[b]=(0,ch.useStore)("highlightedNodesStore",[]);return(0,l.useMemo)(()=>!!a&&!!Array.isArray(b)&&b.includes(a),[a,b])}var q=o,e1=r;let e2=a=>a===Object(a)&&!Array.isArray(a)&&"function"!=typeof a;function e3(a,b){let c=(0,m.useThree)(a=>a.gl),d=(0,v.useLoader)(r.TextureLoader,e2(a)?Object.values(a):a);return(0,l.useLayoutEffect)(()=>{null==b||b(d)},[b]),(0,l.useEffect)(()=>{if("initTexture"in c){let a=[];Array.isArray(d)?a=d:d instanceof r.Texture?a=[d]:e2(d)&&(a=Object.values(d)),a.forEach(a=>{a instanceof r.Texture&&c.initTexture(a)})}},[c,d]),(0,l.useMemo)(()=>{if(!e2(a))return d;{let b={},c=0;for(let e in a)b[e]=d[c++];return b}},[a,d])}e3.preload=a=>v.useLoader.preload(r.TextureLoader,a),e3.clear=a=>v.useLoader.clear(r.TextureLoader,a);let e4=parseInt(r.REVISION.replace(/\D+/g,"")),e5=(e={color:new r.Color("white"),scale:new r.Vector2(1,1),imageBounds:new r.Vector2(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},f=`
  varying vec2 vUv;
  varying vec2 vPos;
  void main() {
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
    vUv = uv;
    vPos = position.xy;
  }
`,g=`
  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44
  varying vec2 vUv;
  varying vec2 vPos;
  uniform vec2 scale;
  uniform vec2 imageBounds;
  uniform float resolution;
  uniform vec3 color;
  uniform sampler2D map;
  uniform float radius;
  uniform float zoom;
  uniform float grayscale;
  uniform float opacity;
  const vec3 luma = vec3(.299, 0.587, 0.114);
  vec4 toGrayscale(vec4 color, float intensity) {
    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);
  }
  vec2 aspect(vec2 size) {
    return size / min(size.x, size.y);
  }
  
  const float PI = 3.14159265;
    
  // from https://iquilezles.org/articles/distfunctions
  float udRoundBox( vec2 p, vec2 b, float r ) {
    return length(max(abs(p)-b+r,0.0))-r;
  }

  void main() {
    vec2 s = aspect(scale);
    vec2 i = aspect(imageBounds);
    float rs = s.x / s.y;
    float ri = i.x / i.y;
    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
    vec2 uv = vUv * s / new + offset;
    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);

    vec2 res = vec2(scale * resolution);
    vec2 halfRes = 0.5 * res;
    float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    
	  vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));
    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);
    
    #include <tonemapping_fragment>
    #include <${e4>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`,(h=class extends e1.ShaderMaterial{constructor(a){for(const b in super({vertexShader:f,fragmentShader:g,...a}),e)this.uniforms[b]=new e1.Uniform(e[b]),Object.defineProperty(this,b,{get(){return this.uniforms[b].value},set(a){this.uniforms[b].value=a}});this.uniforms=e1.UniformsUtils.clone(this.uniforms)}}).key=e1.MathUtils.generateUUID(),h),e6=l.forwardRef(({children:a,color:b,segments:c=1,scale:d=1,zoom:e=1,grayscale:f=0,opacity:g=1,radius:h=0,texture:i,toneMapped:j,transparent:n,side:o,...p},r)=>{(0,q.e)({ImageMaterial:e5});let s=l.useRef(null),t=(0,m.useThree)(a=>a.size),u=Array.isArray(d)?[d[0],d[1]]:[d,d],v=[i.image.width,i.image.height],w=Math.max(t.width,t.height);return l.useImperativeHandle(r,()=>s.current,[]),l.useLayoutEffect(()=>{s.current.geometry.parameters&&s.current.material.scale.set(u[0]*s.current.geometry.parameters.width,u[1]*s.current.geometry.parameters.height)},[u[0],u[1]]),l.createElement("mesh",(0,k.default)({ref:s,scale:Array.isArray(d)?[...d,1]:d},p),l.createElement("planeGeometry",{args:[1,1,c,c]}),l.createElement("imageMaterial",{color:b,map:i,zoom:e,grayscale:f,opacity:g,scale:u,imageBounds:v,resolution:w,radius:h,toneMapped:j,transparent:n,side:o,key:e5.key}),a)}),e7=l.forwardRef(({url:a,...b},c)=>{let d=e3(a);return l.createElement(e6,(0,k.default)({},b,{texture:d,ref:c}))}),e8=l.forwardRef(({url:a,...b},c)=>l.createElement(e6,(0,k.default)({},b,{ref:c}))),e9=l.forwardRef((a,b)=>{if(a.url)return l.createElement(e7,(0,k.default)({},a,{ref:b}));if(a.texture)return l.createElement(e8,(0,k.default)({},a,{ref:b}));throw Error("<Image /> requires a url or texture")});var fa=a.i(82120);function fb({imageUrl:a,position:b,scale:c=[10.8,10.8,1],tiltAmount:d=.15,opacity:e=1,faceCamera:f=!1,showCross:g=!1,title:h="",showTitle:i=!1,showReadButton:k=!1,onReadClick:m=null,onCloseCross:o=null,onClick:p=null,highlightState:q={isSelected:!1,isHighlighted:!1,isSecondaryHighlighted:!1,hasSelection:!1},nodeId:s=null}){let t=(0,l.useRef)(),u=(0,l.useRef)(),v=(0,l.useRef)(),w=(0,l.useRef)(),x=(0,l.useRef)(),y=(0,l.useRef)(),z=(0,l.useRef)(null),A=(0,l.useRef)(null),[B,C]=(0,l.useState)(!1),[D,E]=(0,l.useState)(a),[F,G]=(0,l.useState)(!0),[H,I]=(0,l.useState)(!1),[J,K]=(0,l.useState)(!0),[L,M]=(0,l.useState)(0),[N,O]=(0,l.useState)(0),[P,Q]=(0,l.useState)(!1),[R,S]=(0,l.useState)(!1),[T]=(0,ch.useStore)("selectedNodeStore",null),[U]=(0,ch.useStore)("highlightedNodesStore",[]),[V]=(0,ch.useStore)("secondaryHighlightedArticlesStore",[]),W=q?.isSelected||s&&T?.id===s,X=q?.isHighlighted||s&&U.includes(s),Y=q?.isSecondaryHighlighted||s&&V.includes(s),Z=q?.hasSelection||null!==T,$=!Z||W||X||Y?e:.2*e,_=W||X?fa.COLOR_ACCENT:"#ffffff",aa=Y?2:W||X?13:7,ab=(0,l.useMemo)(()=>new r.Vector3(0,0,0),[]);(0,l.useEffect)(()=>{if(!a)return void C(!0);let b=a.includes(" ")?a.split("/").map(a=>encodeURIComponent(a)).join("/"):a,c=new window.Image;c.onload=()=>{C(!1),E(b)},c.onerror=b=>{if(console.warn(`Failed to load image: ${a}`,b),a&&(a.startsWith("http://")||a.startsWith("https://"))){let b="/entriesImages/placeholder.svg",c=new window.Image;c.onload=()=>{C(!1),E(b),console.warn(`Using placeholder for external image: ${a}`)},c.onerror=()=>{C(!0),E(null)},c.src=b;return}if(a.endsWith(".jpg")){let b=a.replace(".jpg",".png"),c=b.includes(" ")?b.split("/").map(a=>encodeURIComponent(a)).join("/"):b,d=new window.Image;d.onload=()=>{C(!1),E(c)},d.onerror=()=>{let c="/entriesImages/placeholder.svg",d=new window.Image;d.onload=()=>{C(!1),E(c),console.warn(`Using placeholder for missing image: ${a}`)},d.onerror=()=>{console.warn(`Could not load image: ${a} or ${b} or placeholder`),C(!0)},d.src=c},d.src=c}else if(a.endsWith(".png")){let b=a.replace(".png",".jpg"),c=b.includes(" ")?b.split("/").map(a=>encodeURIComponent(a)).join("/"):b,d=new window.Image;d.onload=()=>{C(!1),E(c)},d.onerror=()=>{let c="/entriesImages/placeholder.svg",d=new window.Image;d.onload=()=>{C(!1),E(c),console.warn(`Using placeholder for missing image: ${a}`)},d.onerror=()=>{console.warn(`Could not load image: ${a} or ${b} or placeholder`),C(!0)},d.src=c},d.src=c}else{let b="/entriesImages/placeholder.svg",c=new window.Image;c.onload=()=>{C(!1),E(b),console.warn(`Using placeholder for missing image: ${a}`)},c.onerror=()=>{console.warn(`Could not load image: ${a} or placeholder`),C(!0)},c.src=b}},c.src=b},[a]);let ac=(0,l.useRef)(new r.Vector3),ad=(0,l.useRef)(new r.Vector3),ae=(0,l.useRef)(new r.Vector3),af=(0,l.useRef)(new r.Vector3),ag=(0,l.useRef)(new r.Vector3),ah=(0,l.useRef)(new r.Quaternion),ai=(0,l.useRef)(new r.Quaternion),aj=(0,l.useRef)(new r.Matrix4),ak=(0,l.useRef)(new r.Vector3(0,1,0));(0,n.useFrame)((a,b)=>{if(!w.current||!v.current)return;let c=ah.current;if(f){let b,d,e=a.camera,f=ac.current;w.current.getWorldPosition(f);let g=ad.current.subVectors(e.position,f).normalize();Math.abs(e.position.y-f.y)>8?(ag.current.set(1,0,0),ag.current.applyQuaternion(e.quaternion),b=.001>ae.current.set(ag.current.x,0,ag.current.z).length()?ae.current.set(1,0,0):ae.current.normalize()):(.001>(b=ae.current.crossVectors(ak.current,g)).length()&&b.set(1,0,0),b.normalize()),d=af.current.crossVectors(g,b).normalize();let h=aj.current.makeBasis(b,d,g);c.setFromRotationMatrix(h)}else{let a=ac.current;w.current.getWorldPosition(a);let b=ad.current.subVectors(ab,a);if(.001>b.length())return;b.normalize();let e=ae.current.crossVectors(ak.current,b);.001>e.length()&&e.set(1,0,0),e.normalize();let f=af.current.crossVectors(b,e).normalize(),g=aj.current.makeBasis(e,f,b);if(c.setFromRotationMatrix(g),0!==d){let a=ai.current.setFromAxisAngle(e,d);c.multiply(a)}}let e=v.current.quaternion,g=Math.min(1,8*b);e.slerp(c,g);let h=a.camera,i=ac.current;w.current.getWorldPosition(i);let j=ad.current.set(0,0,1);j.applyQuaternion(e);let k=ae.current.subVectors(h.position,i).normalize(),l=j.dot(k);G(l>0),I(l<=0),K(l>0)});let al=(0,l.useMemo)(()=>[c[0]+.4,c[1]+.4,c[2]],[c]),am=!a||B&&!D,an=c[0],ao=c[1],ap=an+.4,aq=ao+.4;(0,l.useMemo)(()=>new r.Vector3(-ap/2,aq/2,0),[ap,aq]),(0,l.useMemo)(()=>new r.Vector3(ap/2,aq/2,0),[ap,aq]),(0,l.useMemo)(()=>new r.Vector3(-ap/2,-aq/2,0),[ap,aq]),(0,l.useMemo)(()=>new r.Vector3(ap/2,-aq/2,0),[ap,aq]),(0,l.useMemo)(()=>new r.Vector3(0,aq/2,0),[aq]),(0,l.useMemo)(()=>new r.Vector3(0,-aq/2,0),[aq]),(0,l.useMemo)(()=>new r.Vector3(-ap/2,0,0),[ap]),(0,l.useMemo)(()=>new r.Vector3(ap/2,0,0),[ap]);let ar=-aq/2-.1,as=(0,l.useMemo)(()=>2.14*c[0],[c]),at=(0,l.useMemo)(()=>2.07*c[1],[c]),au=(0,l.useMemo)(()=>Math.round(20*as),[as]),av=(0,l.useMemo)(()=>Math.round(20*at),[at]),aw=(0,l.useMemo)(()=>Math.round(.95*au),[au]),ax=(0,l.useMemo)(()=>{if(!h||h.length<=96)return h;let a=h.substring(0,96),b=a.lastIndexOf(" ");return b>0?a.substring(0,b)+"...":a+"..."},[h]),ay=(0,l.useMemo)(()=>Math.round(41*c[1]),[c]),az=a=>{if(!a)return null;let b=a.querySelector(".titleContainer")||a,c=window.getComputedStyle(b),d=b.offsetHeight||b.scrollHeight||b.clientHeight;if(0===d&&(d=b.getBoundingClientRect().height),0===d)return null;let e=parseFloat(c.marginTop)||0,f=parseFloat(c.marginBottom)||0,g=window.getComputedStyle(a),h=d+e+f+(parseFloat(g.marginTop)||0)+(parseFloat(g.marginBottom)||0);return h>0?Math.round(h):null};(0,l.useEffect)(()=>{if(!i||!h){M(0),O(0),k?(Q(!0),S(!0)):(Q(!1),S(!1));return}Q(!1),S(!1);let a=()=>{let a=!1,b=!1;if(z.current){let b=az(z.current);null!==b&&b>0&&(M(b),a=!0,setTimeout(()=>{Q(!0)},150))}if(A.current){let a=az(A.current);null!==a&&a>0&&(O(a),b=!0,setTimeout(()=>{S(!0)},150))}return a&&b},b=new ResizeObserver(()=>{requestAnimationFrame(()=>{a()})}),c=()=>{let a=[];return z.current&&a.push(z.current),A.current&&a.push(A.current),a.length>0&&(a.forEach(a=>{b.observe(a)}),!0)};if(c()){let c=0,d=()=>{let b=a();c++,!b&&c<30?setTimeout(d,100):c>=30&&k&&(Q(!0),S(!0))};setTimeout(()=>{d()},200);let e=setInterval(()=>{a()},300),f=setTimeout(()=>{clearInterval(e),k&&(Q(!0),S(!0))},2e3);return()=>{clearTimeout(f),clearInterval(e),b.disconnect()}}{let d=0,e=setInterval(()=>{if(c()){clearInterval(e),setTimeout(()=>{a()},100);let c=setInterval(()=>{a()},200),d=setTimeout(()=>{clearInterval(c),k&&(Q(!0),S(!0))},1500);return()=>{clearTimeout(d),clearInterval(c),b.disconnect()}}++d>40&&(clearInterval(e),k&&(Q(!0),S(!0)))},50),f=setTimeout(()=>{clearInterval(e),k&&(Q(!0),S(!0))},2e3);return()=>{clearTimeout(f),clearInterval(e),b.disconnect()}}},[i,h,ax,aw,k]);let aA=(0,l.useMemo)(()=>{let a=L||0;return i&&h&&0===a&&(a=Math.min(.3*ay,120)),Math.max(0,ay-a)},[ay,L,i,h]),aB=(0,l.useMemo)(()=>{let a=N||0;return i&&h&&0===a&&(a=Math.min(.3*ay,120)),Math.max(0,ay-a)},[ay,N,i,h]);return(0,l.useEffect)(()=>{if(s)return g&&J&&x.current?cs(s,x):Y&&!g&&y.current?cs(s,y):ct(s),()=>{ct(s)}},[s,g,J,Y]),(0,n.useFrame)(()=>{s&&g&&J&&x.current?cu(s):s&&Y&&!g&&y.current&&cu(s)}),(0,j.jsx)("group",{ref:w,position:b,children:(0,j.jsxs)("group",{ref:v,children:[(0,j.jsxs)("mesh",{position:[0,0,-.15],renderOrder:Y?aa:W||X||Y?11:1,frustumCulled:!1,children:[(0,j.jsx)("planeGeometry",{args:[al[0],al[1]]}),(0,j.jsx)("meshBasicMaterial",{color:"#000000",transparent:!0,opacity:+$,side:r.DoubleSide,depthWrite:Y||!(W||X||Y),depthTest:Y||!(W||X||Y)})]}),(0,j.jsxs)("mesh",{position:[0,0,-.1],renderOrder:Y?aa:W||X||Y?12:2,frustumCulled:!1,children:[(0,j.jsx)("planeGeometry",{args:[al[0],al[1]]}),(0,j.jsx)("meshBasicMaterial",{color:_,transparent:!0,opacity:+$,side:r.DoubleSide,depthWrite:Y||!(W||X||Y),depthTest:Y||!(W||X||Y)})]}),W&&(0,j.jsxs)("mesh",{position:[0,0,-.05],renderOrder:Y?aa:W||X||Y?12.5:2.5,frustumCulled:!1,children:[(0,j.jsx)("planeGeometry",{args:[al[0],al[1]]}),(0,j.jsx)("meshBasicMaterial",{color:fa.COLOR_ACCENT,transparent:!0,opacity:.18*$,side:r.DoubleSide,depthWrite:Y||!(W||X||Y),depthTest:Y||!(W||X||Y)})]}),am?(0,j.jsxs)("mesh",{ref:t,position:[0,0,0],renderOrder:Y?aa:W||X||Y?10:3,frustumCulled:!1,...p?{onClick:p}:{},children:[(0,j.jsx)("planeGeometry",{args:[c[0],c[1]]}),(0,j.jsx)("meshBasicMaterial",{color:fa.COLOR_ACCENT,transparent:!0,opacity:W||X||Y?+$:.98*$,side:r.DoubleSide,depthWrite:Y||!(W||X||Y),depthTest:Y||!(W||X||Y)})]}):D&&!B&&(0,j.jsxs)("group",{ref:u,position:[0,0,0],renderOrder:Y?aa:W||X||Y?10:3,children:[(0,j.jsxs)("mesh",{position:[0,0,0],...p?{onClick:p}:{},children:[(0,j.jsx)("planeGeometry",{args:[c[0],c[1]]}),(0,j.jsx)("meshBasicMaterial",{transparent:!0,opacity:0,side:r.DoubleSide,depthWrite:!1,depthTest:!1})]}),D&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(e9,{url:D,scale:c,transparent:!0,opacity:W||X||Y?+$:.98*$,depthWrite:Y||!(W||X||Y),depthTest:Y||!(W||X||Y),frustumCulled:!1,onError:a=>{console.warn(`Image component failed to load: ${D}`,a),C(!0),E(null)}}),(0,j.jsx)(e9,{url:D,scale:c,transparent:!0,opacity:W||X||Y?+$:.98*$,depthWrite:Y||!(W||X||Y),depthTest:Y||!(W||X||Y),frustumCulled:!1,rotation:[0,Math.PI,0],onError:a=>{console.warn(`Image component failed to load (back): ${D}`,a),C(!0),E(null)}})]})]}),(i&&h||k)&&F&&(0,j.jsxs)("group",{position:[0,0,-.08],renderOrder:aa,children:[(0,j.jsxs)("mesh",{renderOrder:aa,frustumCulled:!1,...p?{onClick:p}:{},children:[(0,j.jsx)("planeGeometry",{args:[as,at]}),(0,j.jsx)("meshBasicMaterial",{color:"#000000",transparent:!0,opacity:0,side:r.FrontSide,depthWrite:Y,depthTest:Y})]}),(0,j.jsx)(eY.Html,{center:!1,className:"titleAndReadWrapper",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -30%)",width:`${au}px`,height:`${av}px`,minWidth:`${au}px`,minHeight:`${av}px`,maxWidth:"none",maxHeight:"none",margin:0,padding:0,pointerEvents:"none"},transform:!0,occlude:!!Y||!!Z&&!W&&!X,children:(0,j.jsxs)("div",{className:"titleAndReadContainer",style:{width:`${au}px`,height:`${ay}px`,minWidth:`${au}px`,minHeight:`${ay}px`,maxWidth:"none",maxHeight:"none",opacity:$,margin:0,padding:0,position:"relative",pointerEvents:"none",transform:"translateY(-20%)"},children:[k&&(0,j.jsx)("div",{className:"readWrapper",style:{position:"absolute",top:"0",left:"50%",transform:"translateX(-50%)",width:"100%",height:`${aA}px`,opacity:+!!P,transition:"opacity 0.3s ease-in-out",pointerEvents:P?"auto":"none"},children:(0,j.jsx)("div",{className:"readButton",onClick:m,style:{pointerEvents:"auto"},children:(0,j.jsx)("span",{className:"readButtonText",children:"READ"})})}),i&&h&&(0,j.jsx)("div",{ref:z,className:"titleWrapper",style:{position:"absolute",bottom:"0",left:"50%",transform:"translateX(-50%)",width:"100%"},children:(0,j.jsx)("div",{className:"titleContainer",style:{width:`${aw}px`},children:ax})})]})})]}),(i&&h||k)&&H&&(0,j.jsxs)("group",{position:[0,0,-.08],rotation:[0,Math.PI,0],renderOrder:aa,children:[(0,j.jsxs)("mesh",{renderOrder:aa,frustumCulled:!1,...p?{onClick:p}:{},children:[(0,j.jsx)("planeGeometry",{args:[as,at]}),(0,j.jsx)("meshBasicMaterial",{color:"#000000",transparent:!0,opacity:0,side:r.FrontSide,depthWrite:Y,depthTest:Y})]}),(0,j.jsx)(eY.Html,{center:!1,className:"titleAndReadWrapper",style:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -30%)",width:`${au}px`,height:`${av}px`,minWidth:`${au}px`,minHeight:`${av}px`,maxWidth:"none",maxHeight:"none",margin:0,padding:0,pointerEvents:"none"},transform:!0,occlude:!!Y||!!Z&&!W&&!X,children:(0,j.jsxs)("div",{className:"titleAndReadContainer",style:{width:`${au}px`,height:`${ay}px`,minWidth:`${au}px`,minHeight:`${ay}px`,maxWidth:"none",maxHeight:"none",opacity:$,margin:0,padding:0,position:"relative",pointerEvents:"none",transform:"translateY(-20%)"},children:[k&&(0,j.jsx)("div",{className:"readWrapper",style:{position:"absolute",top:"0",left:"50%",transform:"translateX(-50%)",width:"100%",height:`${aB}px`,opacity:+!!R,transition:"opacity 0.3s ease-in-out",pointerEvents:R?"auto":"none"},children:(0,j.jsx)("div",{className:"readButton",onClick:m,style:{pointerEvents:"auto"},children:(0,j.jsx)("span",{className:"readButtonText",children:"READ"})})}),i&&h&&(0,j.jsx)("div",{ref:A,className:"titleWrapper",style:{position:"absolute",bottom:"0",left:"50%",transform:"translateX(-50%)",width:"100%"},children:(0,j.jsx)("div",{className:"titleContainer",style:{width:`${aw}px`},children:ax})})]})})]}),g&&J&&(0,j.jsx)("group",{ref:x,position:[0,ar,.001],renderOrder:1e3,children:(0,j.jsx)(eY.Html,{center:!0,className:"crossHtml",transform:!0,occlude:!1,children:(0,j.jsxs)("div",{className:"crossContainer",style:{opacity:Y?0:$},onClick:o||void 0,children:[(0,j.jsx)("div",{className:"crossBackground"}),(0,j.jsx)("div",{className:"crossBorder"}),(0,j.jsxs)("div",{className:"crossLines",children:[(0,j.jsx)("div",{className:"crossLine line1"}),(0,j.jsx)("div",{className:"crossLine line2"})]})]})})}),Y&&!g&&(0,j.jsx)("group",{ref:y,position:[0,ar,.001],renderOrder:1e3,children:J&&(0,j.jsxs)("mesh",{children:[(0,j.jsx)("planeGeometry",{args:[.01,.01]}),(0,j.jsx)("meshBasicMaterial",{color:"#ff0000",transparent:!0,opacity:1,side:r.DoubleSide,depthWrite:!1,depthTest:!0})]})})]})})}function fc(a,b,c){let[d,e]=(0,l.useState)(!1),[f,g]=(0,l.useState)(0),[h]=(0,ch.useStore)("loadingState",{nodesLoaded:0,totalNodes:0,isLoading:!0,nodesVisible:[]});return(0,l.useEffect)(()=>{let a=50*b;if(!h.isLoading&&h.totalNodes>0){let b=setTimeout(()=>{e(!0);let a=Date.now(),b=()=>{let c=Math.min((Date.now()-a)/800,1);g(1-Math.pow(1-c,3)),c<1&&requestAnimationFrame(b)};b()},a);return()=>clearTimeout(b)}},[h.isLoading,h.totalNodes,b,c]),{isVisible:d,opacity:Math.max(f,.1)}}function fd(){let a=(0,ch.getStore)("loadingState");a&&a.setState(a=>({...a,isLoading:!1}))}function fe({nodeData:a,...b}){let{nodes:c,materials:d}=(0,eX.useGLTF)(a.modelPath);return(0,j.jsx)(fg,{nodeData:a,nodes:c,materials:d,...b})}function ff({nodeData:a,...b}){return(0,j.jsx)(fg,{nodeData:a,nodes:{},materials:{},...b})}function fg({nodeData:b,nodes:c,materials:d,showAllLines:e,props:f,setTitle:g,setDefault:h,selectedComponent:i}){let k=(0,l.useRef)(),[m,n]=(0,l.useState)(!1),[o,p]=(0,l.useState)(!1),[q,r]=(0,l.useState)(0),[s,t]=(0,l.useState)(!1),[u,v]=(0,ch.useStore)(`${b.id}Store`,!1),w=(0,l.useRef)(!1),x=b.position||[0,0,0];(0,l.useMemo)(()=>e$(),[]),e_(b.id,m),e0(b.id);let[y]=(0,ch.useStore)("elementOpacityStore",{}),z=void 0!==y[b.id]?y[b.id]:1,[A]=(0,ch.useStore)("highlightedNodesStore",[]),[B]=(0,ch.useStore)("secondaryHighlightedArticlesStore",[]),C=void 0!==b.index?b.index:0,{isVisible:D,opacity:E}=fc(b.id,C,83),F=B?.includes(b.id),G=(0,l.useMemo)(()=>D?z*E:0,[D,z,E]),[H,I]=(0,ch.useStore)("selectedNodeStore",null),[,J]=(0,ch.useStore)("walkThroughActive",!1),K=(0,l.useMemo)(()=>H&&H.id!==b.id&&!A?.includes(b.id)&&!F,[H,b.id,A,F]),L=(0,l.useMemo)(()=>H?.id===b.id||A?.includes(b.id)&&H?.id?.startsWith("G"),[H,b.id,A]),M=(0,l.useMemo)(()=>K?[6.48,8.64,1]:L?[10.8*1.3,14.4*1.3,1]:[10.8,14.4,1],[K,L]),[,N]=(0,ch.useStore)("highlightedNodesStore",[]),[O]=(0,ch.useStore)("cameraInteractionStore",!1);(0,l.useEffect)(()=>{!w.current&&H&&H.id!==b.id&&m&&requestAnimationFrame(()=>{w.current||(r(0),p(!1),n(!1),v(!1))})},[H,m,b.id,v]);let[P,Q]=(0,l.useState)(!1);(0,l.useEffect)(()=>{if(!b.connections||0===b.connections.length)return void Q(!1);let c=()=>{let{getStore:c}=a.r(9715);Q(b.connections.some(a=>{try{let b=c(`${a}Store`,!1);return!0===b}catch(a){return!1}}))};c();let d=setInterval(c,500);return()=>clearInterval(d)},[b.connections]);let R=(0,l.useCallback)(a=>{a&&a.stopPropagation(),r(a=>{let b=+(0===a);return 1===b?(w.current=!0,requestAnimationFrame(()=>{p(!0),n(!0),v(!0),g&&g(),setTimeout(()=>{w.current=!1},100)})):(p(!1),n(!1),h(),v(!1)),b})},[v,g,h]),S=(0,l.useCallback)(a=>{a.stopPropagation(),r(0),p(!1),n(!1),v(!1),I(null),N([]),J(!1),h&&h()},[v,I,N,J,h]);return(0,l.useEffect)(()=>{1===q&&(n(!0),g&&g(),v(!0))},[o,g,v]),(0,l.useEffect)(()=>{},[b.id,s,h,v]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)("group",{...f,dispose:null,frustumCulled:!1,children:(0,j.jsxs)("group",{position:x,scale:[.5,.5,.5],onClick:R,opacity:G,ref:k,className:"articleNodeGroup",frustumCulled:!1,children:[!P&&(0,j.jsx)(fb,{imageUrl:b.imageUrl,position:[0,0,0],scale:M,tiltAmount:.15,opacity:G,faceCamera:L||F,showCross:H?.id===b.id&&!F,title:b.title,showTitle:H?.id===b.id||A?.includes(b.id)&&H?.id?.startsWith("G"),showReadButton:H?.id===b.id||A?.includes(b.id)&&H?.id?.startsWith("G"),onReadClick:function(a){a.stopPropagation(),t(!0),b.id&&window.history.pushState(null,"",`#${b.id}`)},onCloseCross:S,onClick:R,nodeId:b.id,highlightState:{isSelected:H?.id===b.id,isHighlighted:A?.includes(b.id),isSecondaryHighlighted:F,hasSelection:!!H}}),(0,j.jsx)(eY.Html,{center:!0,children:(0,j.jsx)(cD.default,{isOpen:s,contentLabel:"Article Modal",className:"archive-modal-content",overlayClassName:"archive-modal-overlay",bodyOpenClassName:"archive-modal-open",htmlOpenClassName:"archive-modal-open",children:(0,j.jsx)(eZ.default,{closeModal:()=>void(t(!1),h(),r(0),p(!1),n(!1),v(!1),window.location.hash===`#${b.id}`&&window.history.pushState(null,"",window.location.pathname)),connect1:b.connectionKeywords?.[0]||"",connect2:b.connectionKeywords?.[1]||"",connect3:b.connectionKeywords?.[2]||"",connect4:b.connectionKeywords?.[3]||"",img:b.imageUrl,title:b.title,author:b.author,content:b.content,authorBio:b.authorBio,keywords:b.keywords,photoCredit:b.photoCredit})})})]})})})}let fh=l.default.memo(function({nodeData:a,...b}){return a.modelPath&&""!==a.modelPath.trim()?(0,j.jsx)(l.Suspense,{fallback:null,children:(0,j.jsx)(fe,{nodeData:a,...b})}):(0,j.jsx)(ff,{nodeData:a,...b})},(a,b)=>{let c=a.nodeData.position||[0,0,0],d=b.nodeData.position||[0,0,0];return c[0]===d[0]&&c[1]===d[1]&&c[2]===d[2]&&a.nodeData.id===b.nodeData.id&&a.showAllLines===b.showAllLines});function fi({nodeData:a,...b}){let{nodes:c,materials:d}=(0,eX.useGLTF)(a.modelPath);return(0,j.jsx)(fk,{nodeData:a,nodes:c,materials:d,...b})}function fj({nodeData:a,...b}){return(0,j.jsx)(fk,{nodeData:a,nodes:{},materials:{},...b})}function fk({nodeData:a,nodes:b,materials:c,showAllLines:d,title:e,active:f,props:g,setTitle:h,setDefault:i,glossaryShellComponent:k}){let m=(0,l.useRef)(),[n,o]=(0,l.useState)(!1),[p,q]=(0,l.useState)(!1),[s,t]=(0,l.useState)(0),[u,v]=(0,l.useState)(!1),w=(0,l.useRef)(!1),x=a.position||[0,0,0],[y]=(0,ch.useStore)("elementOpacityStore",{}),z=void 0!==y[a.id]?y[a.id]:1;(0,l.useMemo)(()=>1.93,[]);let A=void 0!==a.index?a.index:0,{isVisible:B,opacity:C}=fc(a.id,A,83),D=(0,l.useMemo)(()=>B?z*C:0,[B,z,C]),E=(0,l.useMemo)(()=>a.id&&a.id.startsWith("G")&&.01>Math.abs(D-.3),[D,a.id]);(0,l.useMemo)(()=>{let a=e$();return a.opacity=D,a.transparent=D<1,a},[D]),e_(a.id,n),e0(a.id);let[F]=(0,ch.useStore)("highlightedNodesStore",[]),G=(0,l.useMemo)(()=>Array.isArray(F)&&F.includes(a.id),[F,a.id]),[H,I]=(0,ch.useStore)("selectedNodeStore",null),[,J]=(0,ch.useStore)("walkThroughActive",!1),K=(0,l.useMemo)(()=>H?.id===a.id,[H,a.id]),[,L]=(0,ch.useStore)("highlightedNodesStore",[]),M=(0,l.useMemo)(()=>G&&!K&&!n,[G,K,n]),[N,O]=(0,ch.useStore)(`${a.id}Store`,!1);(0,l.useEffect)(()=>{!w.current&&H&&H.id!==a.id&&n&&requestAnimationFrame(()=>{w.current||(t(0),q(!1),o(!1))})},[H,n,a.id]),(0,l.useEffect)(()=>{c&&Object.keys(c).length>0&&Object.values(c).forEach(a=>{a&&(a.opacity=D,a.transparent=D<1)})},[D,c]);let P=(0,l.useCallback)(a=>{a&&a.stopPropagation(),w.current=!0,requestAnimationFrame(()=>{q(a=>!a),t(a=>a+1),O(!1),setTimeout(()=>{w.current=!1},100)})},[O]),Q=(0,l.useCallback)(a=>{a.stopPropagation(),t(0),q(!1),o(!1),O(!1),I(null),L([]),J(!1),i&&i()},[O,I,L,J,i]);return(0,l.useEffect)(()=>{1===s?(o(!0),h&&h(),O(!0)):2===s&&(o(!1),t(0),i&&i())},[p,h,i,O]),(0,l.useEffect)(()=>{d?t(1):d||t(0)},[d]),(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("group",{...g,dispose:null,position:x,scale:[1,1,1],onClick:P,ref:m,opacity:D,className:"glossaryNodeGroup",frustumCulled:!1,children:[(0,j.jsxs)("mesh",{position:[0,0,0],visible:!1,children:[(0,j.jsx)("planeGeometry",{args:[5,2]}),(0,j.jsx)("meshBasicMaterial",{transparent:!0,opacity:0,side:r.DoubleSide})]}),(0,j.jsx)(eY.Html,{center:!0,children:(0,j.jsxs)("div",{className:"glossaryContainer",children:[(0,j.jsxs)("div",{className:`glossaryPill ${K||G||n?"selected":""} ${M?"secondaryHighlighted":""} ${G||n?"highlighted":""} ${E?"dimmed":""}`,onClick:a=>{a.stopPropagation(),P()},style:{opacity:D},children:[(0,j.jsx)("span",{className:"glossaryPillTitle",children:(e||a.title||"").toUpperCase()}),(K||G||n)&&a.hasOpenButton&&(0,j.jsx)("span",{className:"glossaryPillOpenButton",onClick:b=>{b.stopPropagation();let c=(a.title||"").toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"");window.location.href=`/glossary#${c}`},children:"OPEN"})]}),(K||n)&&!M&&(0,j.jsxs)("div",{className:`glossaryCross ${K||n?"selected":""}`,style:{opacity:D},onClick:Q,children:[(0,j.jsx)("div",{className:"glossaryCrossBackground"}),(0,j.jsx)("div",{className:"glossaryCrossBorder"}),(0,j.jsxs)("div",{className:"glossaryCrossLines",children:[(0,j.jsx)("div",{className:"glossaryCrossLine line1"}),(0,j.jsx)("div",{className:"glossaryCrossLine line2"})]})]})]})})]}),!0==n&&(0,j.jsx)("group",{children:(0,j.jsx)(cf,{points:[...x,...x],color:"#ffffff",lineWidth:1})}),!0==d&&(0,j.jsx)("group",{children:(0,j.jsx)(cf,{points:[...x,...x],color:"#ffffff",lineWidth:1})})]})}let fl=l.default.memo(function({nodeData:a,...b}){return a.modelPath&&""!==a.modelPath.trim()?(0,j.jsx)(l.Suspense,{fallback:null,children:(0,j.jsx)(fi,{nodeData:a,...b})}):(0,j.jsx)(fj,{nodeData:a,...b})},(a,b)=>{let c=a.nodeData.position||[0,0,0],d=b.nodeData.position||[0,0,0];return c[0]===d[0]&&c[1]===d[1]&&c[2]===d[2]&&a.nodeData.id===b.nodeData.id&&a.showAllLines===b.showAllLines});function fm(){let[,a]=(0,ch.useStore)("cameraInteractionStore",!1),[b]=(0,ch.useStore)("selectedNodeStore",null),c=(0,l.useRef)(null),d=(0,l.useRef)(!1);return(0,l.useEffect)(()=>{b?.id&&(a(!1),c.current&&(clearTimeout(c.current),c.current=null),d.current=!1)},[b,a]),(0,l.useEffect)(()=>{let b=document.querySelector("canvas");if(!b)return;let e=null,f=!1,g=a=>{e={x:a.clientX,y:a.clientY},f=!1},h=b=>{if(e&&!f){let g=Math.abs(b.clientX-e.x),h=Math.abs(b.clientY-e.y);(g>5||h>5)&&(f=!0,d.current=!0,a(!0),c.current&&(clearTimeout(c.current),c.current=null))}else f&&(d.current=!0,a(!0))},i=()=>{f&&(d.current=!1,c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{d.current||a(!1)},1500)),e=null,f=!1},j=()=>{d.current=!0,a(!0),c.current&&clearTimeout(c.current),c.current=setTimeout(()=>{d.current||a(!1)},2e3)};return b.addEventListener("pointerdown",g,{passive:!0}),b.addEventListener("pointermove",h,{passive:!0}),b.addEventListener("pointerup",i,{passive:!0}),b.addEventListener("wheel",j,{passive:!0}),()=>{b.removeEventListener("pointerdown",g),b.removeEventListener("pointermove",h),b.removeEventListener("pointerup",i),b.removeEventListener("wheel",j),c.current&&clearTimeout(c.current)}},[a]),null}function fn(){let[a]=(0,ch.useStore)("selectedNodeStore",null),[b]=(0,ch.useStore)("cameraInteractionStore",!1),c=(0,l.useRef)(null),d=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=(0,ch.getStore)("connectionLinesVisibilityStore");if(d.current&&clearTimeout(d.current),a?.id!==c.current?.id){let b=a?.id&&!c.current?.id,f=!a?.id&&c.current?.id;b?(e.setState(!1),d.current=setTimeout(()=>{e.setState(!0)},1500)):f&&(e.setState(!1),d.current=setTimeout(()=>{e.setState(!0)},1e3)),c.current=a}return b&&a?.id&&(e.setState(!1),d.current=setTimeout(()=>{e.setState(!0)},1200)),()=>{d.current&&clearTimeout(d.current)}},[a,b]),null}let fo=new Set,fp=new Set;function fq(a){if(!(!a||fo.has(a)||fp.has(a))){fo.add(a);try{eX.useGLTF.preload(a)}catch(b){fp.add(a),fo.delete(a)}}}function fr({nodeData:a,processedData:b,isActive:c}){let[,d]=(0,ch.useStore)("selectedNodeStore",null),e=(0,l.useRef)(null),f=(0,l.useRef)(null),g=(0,l.useRef)(new Set),h=(0,l.useRef)(!1),i=(0,l.useRef)(!1),j=(0,l.useRef)(c),k=(0,l.useRef)(a),m=(0,l.useRef)(b);return(0,l.useEffect)(()=>{j.current=c,k.current=a,m.current=b},[c,a,b]),(0,l.useEffect)(()=>{if(!c||!a||!b){e.current&&(clearInterval(e.current),e.current=null),c||(d(null),f.current=null,g.current.clear(),h.current=!1,i.current=!1);return}let l=[...a.articles||[],...a.glossary||[]];if(0===l.length)return;let n=a=>{d({id:a.id,ts:Date.now()})},o=()=>{if(!j.current||!k.current||!m.current)return;e.current&&clearInterval(e.current);let a=[...k.current.articles||[],...k.current.glossary||[]];0!==a.length&&(f.current||(f.current=a[Math.floor(Math.random()*a.length)],g.current.add(f.current.id),n(f.current)),e.current=setInterval(()=>{let a,b;if(!j.current||!k.current||!m.current){e.current&&(clearInterval(e.current),e.current=null);return}(b=0===(a=l.filter(a=>g.current.size>=l.length||!g.current.has(a.id))).length?(g.current.clear(),l[Math.floor(Math.random()*l.length)]):a[Math.floor(Math.random()*a.length)])&&(f.current=b,g.current.add(b.id),n(b))},8e3))};i.current||(i.current=!0,o());let p=()=>{"hidden"===document.visibilityState?(h.current=null!==e.current,e.current&&(clearInterval(e.current),e.current=null)):"visible"===document.visibilityState&&h.current&&j.current&&k.current&&m.current&&o()};return document.addEventListener("visibilitychange",p),()=>{e.current&&(clearInterval(e.current),e.current=null),document.removeEventListener("visibilitychange",p)}},[c,a,b,d]),null}function fs(){let{camera:a}=(0,m.useThree)(),[b]=(0,ch.useStore)("selectedNodeStore",null),[c]=(0,ch.useStore)("highlightedNodesStore",[]),[d]=(0,ch.useStore)("walkThroughActive",!1),e=(0,l.useMemo)(()=>!!b||Array.isArray(c)&&c.length>0,[b,c]),f=(0,l.useMemo)(()=>d?e?47.5:50:e?45:50,[e,d]);return(0,n.useFrame)(()=>{if(a&&a.isPerspectiveCamera){let b=f-a.fov;Math.abs(b)>.1?(a.fov+=.1*b,a.updateProjectionMatrix()):Math.abs(b)>.01&&(a.fov=f,a.updateProjectionMatrix())}}),null}let ft={},fu={},fv=!1,fw=async b=>{if(!ft[b])try{let c=b.toLowerCase(),d=await a.f({"../models/entries_selected/a1":{id:()=>88425,module:()=>a.A(88425)},"../models/entries_selected/a1.jsx":{id:()=>88425,module:()=>a.A(88425)},"../models/entries_selected/a10":{id:()=>2621,module:()=>a.A(2621)},"../models/entries_selected/a10.jsx":{id:()=>2621,module:()=>a.A(2621)},"../models/entries_selected/a11":{id:()=>26451,module:()=>a.A(26451)},"../models/entries_selected/a11.jsx":{id:()=>26451,module:()=>a.A(26451)},"../models/entries_selected/a12":{id:()=>35236,module:()=>a.A(35236)},"../models/entries_selected/a12.jsx":{id:()=>35236,module:()=>a.A(35236)},"../models/entries_selected/a13":{id:()=>22645,module:()=>a.A(22645)},"../models/entries_selected/a13.jsx":{id:()=>22645,module:()=>a.A(22645)},"../models/entries_selected/a14":{id:()=>59069,module:()=>a.A(59069)},"../models/entries_selected/a14.jsx":{id:()=>59069,module:()=>a.A(59069)},"../models/entries_selected/a15":{id:()=>56452,module:()=>a.A(56452)},"../models/entries_selected/a15.jsx":{id:()=>56452,module:()=>a.A(56452)},"../models/entries_selected/a16":{id:()=>60626,module:()=>a.A(60626)},"../models/entries_selected/a16.jsx":{id:()=>60626,module:()=>a.A(60626)},"../models/entries_selected/a17":{id:()=>1426,module:()=>a.A(1426)},"../models/entries_selected/a17.jsx":{id:()=>1426,module:()=>a.A(1426)},"../models/entries_selected/a18":{id:()=>99777,module:()=>a.A(99777)},"../models/entries_selected/a18.jsx":{id:()=>99777,module:()=>a.A(99777)},"../models/entries_selected/a19":{id:()=>19589,module:()=>a.A(19589)},"../models/entries_selected/a19.jsx":{id:()=>19589,module:()=>a.A(19589)},"../models/entries_selected/a2":{id:()=>39808,module:()=>a.A(39808)},"../models/entries_selected/a2.jsx":{id:()=>39808,module:()=>a.A(39808)},"../models/entries_selected/a20":{id:()=>94603,module:()=>a.A(94603)},"../models/entries_selected/a20.jsx":{id:()=>94603,module:()=>a.A(94603)},"../models/entries_selected/a21":{id:()=>58794,module:()=>a.A(58794)},"../models/entries_selected/a21.jsx":{id:()=>58794,module:()=>a.A(58794)},"../models/entries_selected/a22":{id:()=>30479,module:()=>a.A(30479)},"../models/entries_selected/a22.jsx":{id:()=>30479,module:()=>a.A(30479)},"../models/entries_selected/a23":{id:()=>22890,module:()=>a.A(22890)},"../models/entries_selected/a23.jsx":{id:()=>22890,module:()=>a.A(22890)},"../models/entries_selected/a24":{id:()=>17589,module:()=>a.A(17589)},"../models/entries_selected/a24.jsx":{id:()=>17589,module:()=>a.A(17589)},"../models/entries_selected/a25":{id:()=>55258,module:()=>a.A(55258)},"../models/entries_selected/a25.jsx":{id:()=>55258,module:()=>a.A(55258)},"../models/entries_selected/a26":{id:()=>36864,module:()=>a.A(36864)},"../models/entries_selected/a26.jsx":{id:()=>36864,module:()=>a.A(36864)},"../models/entries_selected/a27":{id:()=>27544,module:()=>a.A(27544)},"../models/entries_selected/a27.jsx":{id:()=>27544,module:()=>a.A(27544)},"../models/entries_selected/a28":{id:()=>53633,module:()=>a.A(53633)},"../models/entries_selected/a28.jsx":{id:()=>53633,module:()=>a.A(53633)},"../models/entries_selected/a29":{id:()=>63474,module:()=>a.A(63474)},"../models/entries_selected/a29.jsx":{id:()=>63474,module:()=>a.A(63474)},"../models/entries_selected/a3":{id:()=>17313,module:()=>a.A(17313)},"../models/entries_selected/a3.jsx":{id:()=>17313,module:()=>a.A(17313)},"../models/entries_selected/a4":{id:()=>80649,module:()=>a.A(80649)},"../models/entries_selected/a4.jsx":{id:()=>80649,module:()=>a.A(80649)},"../models/entries_selected/a5":{id:()=>22562,module:()=>a.A(22562)},"../models/entries_selected/a5.jsx":{id:()=>22562,module:()=>a.A(22562)},"../models/entries_selected/a6":{id:()=>6222,module:()=>a.A(6222)},"../models/entries_selected/a6.jsx":{id:()=>6222,module:()=>a.A(6222)},"../models/entries_selected/a7":{id:()=>88971,module:()=>a.A(88971)},"../models/entries_selected/a7.jsx":{id:()=>88971,module:()=>a.A(88971)},"../models/entries_selected/a8":{id:()=>36580,module:()=>a.A(36580)},"../models/entries_selected/a8.jsx":{id:()=>36580,module:()=>a.A(36580)},"../models/entries_selected/a9":{id:()=>15616,module:()=>a.A(15616)},"../models/entries_selected/a9.jsx":{id:()=>15616,module:()=>a.A(15616)}}).import(`../models/entries_selected/${c}`),e=`${b}Selected2`;ft[b]=d[e]||d.default||d[`${b}Selected`]}catch(a){return console.warn(`Could not load selected component for ${b}:`,a),null}return ft[b]},fx=async b=>{if(!b)return null;let c=b.replace("../glossaryShell/","");if(!fu[c])try{let b;try{b=await a.f({"../models/glossaryShell/accessibility":{id:()=>46911,module:()=>a.A(46911)},"../models/glossaryShell/accessibility.jsx":{id:()=>46911,module:()=>a.A(46911)},"../models/glossaryShell/appropriations":{id:()=>83641,module:()=>a.A(83641)},"../models/glossaryShell/appropriations.jsx":{id:()=>83641,module:()=>a.A(83641)},"../models/glossaryShell/archive":{id:()=>61897,module:()=>a.A(61897)},"../models/glossaryShell/archive.jsx":{id:()=>61897,module:()=>a.A(61897)},"../models/glossaryShell/belonging":{id:()=>89400,module:()=>a.A(89400)},"../models/glossaryShell/belonging.jsx":{id:()=>89400,module:()=>a.A(89400)},"../models/glossaryShell/built-environment":{id:()=>8919,module:()=>a.A(8919)},"../models/glossaryShell/built-environment.jsx":{id:()=>8919,module:()=>a.A(8919)},"../models/glossaryShell/citizen":{id:()=>28118,module:()=>a.A(28118)},"../models/glossaryShell/citizen.jsx":{id:()=>28118,module:()=>a.A(28118)},"../models/glossaryShell/climate":{id:()=>48109,module:()=>a.A(48109)},"../models/glossaryShell/climate.jsx":{id:()=>48109,module:()=>a.A(48109)},"../models/glossaryShell/cohesion":{id:()=>37657,module:()=>a.A(37657)},"../models/glossaryShell/cohesion.jsx":{id:()=>37657,module:()=>a.A(37657)},"../models/glossaryShell/collective":{id:()=>52246,module:()=>a.A(52246)},"../models/glossaryShell/collective.jsx":{id:()=>52246,module:()=>a.A(52246)},"../models/glossaryShell/colonialism":{id:()=>38051,module:()=>a.A(38051)},"../models/glossaryShell/colonialism.jsx":{id:()=>38051,module:()=>a.A(38051)},"../models/glossaryShell/commons":{id:()=>99643,module:()=>a.A(99643)},"../models/glossaryShell/commons.jsx":{id:()=>99643,module:()=>a.A(99643)},"../models/glossaryShell/demolition":{id:()=>18306,module:()=>a.A(18306)},"../models/glossaryShell/demolition.jsx":{id:()=>18306,module:()=>a.A(18306)},"../models/glossaryShell/density":{id:()=>31091,module:()=>a.A(31091)},"../models/glossaryShell/density.jsx":{id:()=>31091,module:()=>a.A(31091)},"../models/glossaryShell/desert":{id:()=>61582,module:()=>a.A(61582)},"../models/glossaryShell/desert.jsx":{id:()=>61582,module:()=>a.A(61582)},"../models/glossaryShell/displacement":{id:()=>30528,module:()=>a.A(30528)},"../models/glossaryShell/displacement.jsx":{id:()=>30528,module:()=>a.A(30528)},"../models/glossaryShell/dispossession":{id:()=>97665,module:()=>a.A(97665)},"../models/glossaryShell/dispossession.jsx":{id:()=>97665,module:()=>a.A(97665)},"../models/glossaryShell/ecology":{id:()=>16533,module:()=>a.A(16533)},"../models/glossaryShell/ecology.jsx":{id:()=>16533,module:()=>a.A(16533)},"../models/glossaryShell/everyday-urbanism":{id:()=>55463,module:()=>a.A(55463)},"../models/glossaryShell/everyday-urbanism.jsx":{id:()=>55463,module:()=>a.A(55463)},"../models/glossaryShell/eviction":{id:()=>62627,module:()=>a.A(62627)},"../models/glossaryShell/eviction.jsx":{id:()=>62627,module:()=>a.A(62627)},"../models/glossaryShell/fragmentation":{id:()=>74505,module:()=>a.A(74505)},"../models/glossaryShell/fragmentation.jsx":{id:()=>74505,module:()=>a.A(74505)},"../models/glossaryShell/gender":{id:()=>91861,module:()=>a.A(91861)},"../models/glossaryShell/gender.jsx":{id:()=>91861,module:()=>a.A(91861)},"../models/glossaryShell/gentrification":{id:()=>71132,module:()=>a.A(71132)},"../models/glossaryShell/gentrification.jsx":{id:()=>71132,module:()=>a.A(71132)},"../models/glossaryShell/green-space":{id:()=>6312,module:()=>a.A(6312)},"../models/glossaryShell/green-space.jsx":{id:()=>6312,module:()=>a.A(6312)},"../models/glossaryShell/heritage":{id:()=>60007,module:()=>a.A(60007)},"../models/glossaryShell/heritage.jsx":{id:()=>60007,module:()=>a.A(60007)},"../models/glossaryShell/housing":{id:()=>1728,module:()=>a.A(1728)},"../models/glossaryShell/housing.jsx":{id:()=>1728,module:()=>a.A(1728)},"../models/glossaryShell/identity":{id:()=>19384,module:()=>a.A(19384)},"../models/glossaryShell/identity.jsx":{id:()=>19384,module:()=>a.A(19384)},"../models/glossaryShell/indigenous":{id:()=>17094,module:()=>a.A(17094)},"../models/glossaryShell/indigenous.jsx":{id:()=>17094,module:()=>a.A(17094)},"../models/glossaryShell/infrastructure":{id:()=>30836,module:()=>a.A(30836)},"../models/glossaryShell/infrastructure.jsx":{id:()=>30836,module:()=>a.A(30836)},"../models/glossaryShell/kafala-visa":{id:()=>76015,module:()=>a.A(76015)},"../models/glossaryShell/kafala-visa.jsx":{id:()=>76015,module:()=>a.A(76015)},"../models/glossaryShell/knowledge":{id:()=>31849,module:()=>a.A(31849)},"../models/glossaryShell/knowledge.jsx":{id:()=>31849,module:()=>a.A(31849)},"../models/glossaryShell/labour":{id:()=>6434,module:()=>a.A(6434)},"../models/glossaryShell/labour.jsx":{id:()=>6434,module:()=>a.A(6434)},"../models/glossaryShell/land-use":{id:()=>864,module:()=>a.A(864)},"../models/glossaryShell/land-use.jsx":{id:()=>864,module:()=>a.A(864)},"../models/glossaryShell/marginalisation":{id:()=>31782,module:()=>a.A(31782)},"../models/glossaryShell/marginalisation.jsx":{id:()=>31782,module:()=>a.A(31782)},"../models/glossaryShell/memory":{id:()=>59041,module:()=>a.A(59041)},"../models/glossaryShell/memory.jsx":{id:()=>59041,module:()=>a.A(59041)},"../models/glossaryShell/migrant":{id:()=>11960,module:()=>a.A(11960)},"../models/glossaryShell/migrant.jsx":{id:()=>11960,module:()=>a.A(11960)},"../models/glossaryShell/multispecies":{id:()=>74708,module:()=>a.A(74708)},"../models/glossaryShell/multispecies.jsx":{id:()=>74708,module:()=>a.A(74708)},"../models/glossaryShell/narrative":{id:()=>27582,module:()=>a.A(27582)},"../models/glossaryShell/narrative.jsx":{id:()=>27582,module:()=>a.A(27582)},"../models/glossaryShell/neoliberalism":{id:()=>15950,module:()=>a.A(15950)},"../models/glossaryShell/neoliberalism.jsx":{id:()=>15950,module:()=>a.A(15950)},"../models/glossaryShell/park":{id:()=>66259,module:()=>a.A(66259)},"../models/glossaryShell/park.jsx":{id:()=>66259,module:()=>a.A(66259)},"../models/glossaryShell/periphery":{id:()=>28869,module:()=>a.A(28869)},"../models/glossaryShell/periphery.jsx":{id:()=>28869,module:()=>a.A(28869)},"../models/glossaryShell/placemaking":{id:()=>92267,module:()=>a.A(92267)},"../models/glossaryShell/placemaking.jsx":{id:()=>92267,module:()=>a.A(92267)},"../models/glossaryShell/power":{id:()=>4938,module:()=>a.A(4938)},"../models/glossaryShell/power.jsx":{id:()=>4938,module:()=>a.A(4938)},"../models/glossaryShell/precarity":{id:()=>63789,module:()=>a.A(63789)},"../models/glossaryShell/precarity.jsx":{id:()=>63789,module:()=>a.A(63789)},"../models/glossaryShell/privacy":{id:()=>11638,module:()=>a.A(11638)},"../models/glossaryShell/privacy.jsx":{id:()=>11638,module:()=>a.A(11638)},"../models/glossaryShell/public-space":{id:()=>34308,module:()=>a.A(34308)},"../models/glossaryShell/public-space.jsx":{id:()=>34308,module:()=>a.A(34308)},"../models/glossaryShell/redevelopment":{id:()=>47087,module:()=>a.A(47087)},"../models/glossaryShell/redevelopment.jsx":{id:()=>47087,module:()=>a.A(47087)},"../models/glossaryShell/rent":{id:()=>95467,module:()=>a.A(95467)},"../models/glossaryShell/rent.jsx":{id:()=>95467,module:()=>a.A(95467)},"../models/glossaryShell/residents":{id:()=>83948,module:()=>a.A(83948)},"../models/glossaryShell/residents.jsx":{id:()=>83948,module:()=>a.A(83948)},"../models/glossaryShell/segregation":{id:()=>13600,module:()=>a.A(13600)},"../models/glossaryShell/segregation.jsx":{id:()=>13600,module:()=>a.A(13600)},"../models/glossaryShell/sustainability":{id:()=>19035,module:()=>a.A(19035)},"../models/glossaryShell/sustainability.jsx":{id:()=>19035,module:()=>a.A(19035)},"../models/glossaryShell/typology":{id:()=>88313,module:()=>a.A(88313)},"../models/glossaryShell/typology.jsx":{id:()=>88313,module:()=>a.A(88313)},"../models/glossaryShell/urban-informality":{id:()=>20105,module:()=>a.A(20105)},"../models/glossaryShell/urban-informality.jsx":{id:()=>20105,module:()=>a.A(20105)},"../models/glossaryShell/urban-planning":{id:()=>13793,module:()=>a.A(13793)},"../models/glossaryShell/urban-planning.jsx":{id:()=>13793,module:()=>a.A(13793)},"../models/glossaryShell/urban-renewal":{id:()=>1550,module:()=>a.A(1550)},"../models/glossaryShell/urban-renewal.jsx":{id:()=>1550,module:()=>a.A(1550)},"../models/glossaryShell/waste":{id:()=>20442,module:()=>a.A(20442)},"../models/glossaryShell/waste.jsx":{id:()=>20442,module:()=>a.A(20442)},"../models/glossaryShell/zones-zoning":{id:()=>14596,module:()=>a.A(14596)},"../models/glossaryShell/zones-zoning.jsx":{id:()=>14596,module:()=>a.A(14596)}}).import(`../models/glossaryShell/${c}`)}catch(e){let d=c.replace(/-/g,"");try{b=await a.f({"../models/glossaryShell/accessibility":{id:()=>46911,module:()=>a.A(46911)},"../models/glossaryShell/accessibility.jsx":{id:()=>46911,module:()=>a.A(46911)},"../models/glossaryShell/appropriations":{id:()=>83641,module:()=>a.A(83641)},"../models/glossaryShell/appropriations.jsx":{id:()=>83641,module:()=>a.A(83641)},"../models/glossaryShell/archive":{id:()=>61897,module:()=>a.A(61897)},"../models/glossaryShell/archive.jsx":{id:()=>61897,module:()=>a.A(61897)},"../models/glossaryShell/belonging":{id:()=>89400,module:()=>a.A(89400)},"../models/glossaryShell/belonging.jsx":{id:()=>89400,module:()=>a.A(89400)},"../models/glossaryShell/built-environment":{id:()=>8919,module:()=>a.A(8919)},"../models/glossaryShell/built-environment.jsx":{id:()=>8919,module:()=>a.A(8919)},"../models/glossaryShell/citizen":{id:()=>28118,module:()=>a.A(28118)},"../models/glossaryShell/citizen.jsx":{id:()=>28118,module:()=>a.A(28118)},"../models/glossaryShell/climate":{id:()=>48109,module:()=>a.A(48109)},"../models/glossaryShell/climate.jsx":{id:()=>48109,module:()=>a.A(48109)},"../models/glossaryShell/cohesion":{id:()=>37657,module:()=>a.A(37657)},"../models/glossaryShell/cohesion.jsx":{id:()=>37657,module:()=>a.A(37657)},"../models/glossaryShell/collective":{id:()=>52246,module:()=>a.A(52246)},"../models/glossaryShell/collective.jsx":{id:()=>52246,module:()=>a.A(52246)},"../models/glossaryShell/colonialism":{id:()=>38051,module:()=>a.A(38051)},"../models/glossaryShell/colonialism.jsx":{id:()=>38051,module:()=>a.A(38051)},"../models/glossaryShell/commons":{id:()=>99643,module:()=>a.A(99643)},"../models/glossaryShell/commons.jsx":{id:()=>99643,module:()=>a.A(99643)},"../models/glossaryShell/demolition":{id:()=>18306,module:()=>a.A(18306)},"../models/glossaryShell/demolition.jsx":{id:()=>18306,module:()=>a.A(18306)},"../models/glossaryShell/density":{id:()=>31091,module:()=>a.A(31091)},"../models/glossaryShell/density.jsx":{id:()=>31091,module:()=>a.A(31091)},"../models/glossaryShell/desert":{id:()=>61582,module:()=>a.A(61582)},"../models/glossaryShell/desert.jsx":{id:()=>61582,module:()=>a.A(61582)},"../models/glossaryShell/displacement":{id:()=>30528,module:()=>a.A(30528)},"../models/glossaryShell/displacement.jsx":{id:()=>30528,module:()=>a.A(30528)},"../models/glossaryShell/dispossession":{id:()=>97665,module:()=>a.A(97665)},"../models/glossaryShell/dispossession.jsx":{id:()=>97665,module:()=>a.A(97665)},"../models/glossaryShell/ecology":{id:()=>16533,module:()=>a.A(16533)},"../models/glossaryShell/ecology.jsx":{id:()=>16533,module:()=>a.A(16533)},"../models/glossaryShell/everyday-urbanism":{id:()=>55463,module:()=>a.A(55463)},"../models/glossaryShell/everyday-urbanism.jsx":{id:()=>55463,module:()=>a.A(55463)},"../models/glossaryShell/eviction":{id:()=>62627,module:()=>a.A(62627)},"../models/glossaryShell/eviction.jsx":{id:()=>62627,module:()=>a.A(62627)},"../models/glossaryShell/fragmentation":{id:()=>74505,module:()=>a.A(74505)},"../models/glossaryShell/fragmentation.jsx":{id:()=>74505,module:()=>a.A(74505)},"../models/glossaryShell/gender":{id:()=>91861,module:()=>a.A(91861)},"../models/glossaryShell/gender.jsx":{id:()=>91861,module:()=>a.A(91861)},"../models/glossaryShell/gentrification":{id:()=>71132,module:()=>a.A(71132)},"../models/glossaryShell/gentrification.jsx":{id:()=>71132,module:()=>a.A(71132)},"../models/glossaryShell/green-space":{id:()=>6312,module:()=>a.A(6312)},"../models/glossaryShell/green-space.jsx":{id:()=>6312,module:()=>a.A(6312)},"../models/glossaryShell/heritage":{id:()=>60007,module:()=>a.A(60007)},"../models/glossaryShell/heritage.jsx":{id:()=>60007,module:()=>a.A(60007)},"../models/glossaryShell/housing":{id:()=>1728,module:()=>a.A(1728)},"../models/glossaryShell/housing.jsx":{id:()=>1728,module:()=>a.A(1728)},"../models/glossaryShell/identity":{id:()=>19384,module:()=>a.A(19384)},"../models/glossaryShell/identity.jsx":{id:()=>19384,module:()=>a.A(19384)},"../models/glossaryShell/indigenous":{id:()=>17094,module:()=>a.A(17094)},"../models/glossaryShell/indigenous.jsx":{id:()=>17094,module:()=>a.A(17094)},"../models/glossaryShell/infrastructure":{id:()=>30836,module:()=>a.A(30836)},"../models/glossaryShell/infrastructure.jsx":{id:()=>30836,module:()=>a.A(30836)},"../models/glossaryShell/kafala-visa":{id:()=>76015,module:()=>a.A(76015)},"../models/glossaryShell/kafala-visa.jsx":{id:()=>76015,module:()=>a.A(76015)},"../models/glossaryShell/knowledge":{id:()=>31849,module:()=>a.A(31849)},"../models/glossaryShell/knowledge.jsx":{id:()=>31849,module:()=>a.A(31849)},"../models/glossaryShell/labour":{id:()=>6434,module:()=>a.A(6434)},"../models/glossaryShell/labour.jsx":{id:()=>6434,module:()=>a.A(6434)},"../models/glossaryShell/land-use":{id:()=>864,module:()=>a.A(864)},"../models/glossaryShell/land-use.jsx":{id:()=>864,module:()=>a.A(864)},"../models/glossaryShell/marginalisation":{id:()=>31782,module:()=>a.A(31782)},"../models/glossaryShell/marginalisation.jsx":{id:()=>31782,module:()=>a.A(31782)},"../models/glossaryShell/memory":{id:()=>59041,module:()=>a.A(59041)},"../models/glossaryShell/memory.jsx":{id:()=>59041,module:()=>a.A(59041)},"../models/glossaryShell/migrant":{id:()=>11960,module:()=>a.A(11960)},"../models/glossaryShell/migrant.jsx":{id:()=>11960,module:()=>a.A(11960)},"../models/glossaryShell/multispecies":{id:()=>74708,module:()=>a.A(74708)},"../models/glossaryShell/multispecies.jsx":{id:()=>74708,module:()=>a.A(74708)},"../models/glossaryShell/narrative":{id:()=>27582,module:()=>a.A(27582)},"../models/glossaryShell/narrative.jsx":{id:()=>27582,module:()=>a.A(27582)},"../models/glossaryShell/neoliberalism":{id:()=>15950,module:()=>a.A(15950)},"../models/glossaryShell/neoliberalism.jsx":{id:()=>15950,module:()=>a.A(15950)},"../models/glossaryShell/park":{id:()=>66259,module:()=>a.A(66259)},"../models/glossaryShell/park.jsx":{id:()=>66259,module:()=>a.A(66259)},"../models/glossaryShell/periphery":{id:()=>28869,module:()=>a.A(28869)},"../models/glossaryShell/periphery.jsx":{id:()=>28869,module:()=>a.A(28869)},"../models/glossaryShell/placemaking":{id:()=>92267,module:()=>a.A(92267)},"../models/glossaryShell/placemaking.jsx":{id:()=>92267,module:()=>a.A(92267)},"../models/glossaryShell/power":{id:()=>4938,module:()=>a.A(4938)},"../models/glossaryShell/power.jsx":{id:()=>4938,module:()=>a.A(4938)},"../models/glossaryShell/precarity":{id:()=>63789,module:()=>a.A(63789)},"../models/glossaryShell/precarity.jsx":{id:()=>63789,module:()=>a.A(63789)},"../models/glossaryShell/privacy":{id:()=>11638,module:()=>a.A(11638)},"../models/glossaryShell/privacy.jsx":{id:()=>11638,module:()=>a.A(11638)},"../models/glossaryShell/public-space":{id:()=>34308,module:()=>a.A(34308)},"../models/glossaryShell/public-space.jsx":{id:()=>34308,module:()=>a.A(34308)},"../models/glossaryShell/redevelopment":{id:()=>47087,module:()=>a.A(47087)},"../models/glossaryShell/redevelopment.jsx":{id:()=>47087,module:()=>a.A(47087)},"../models/glossaryShell/rent":{id:()=>95467,module:()=>a.A(95467)},"../models/glossaryShell/rent.jsx":{id:()=>95467,module:()=>a.A(95467)},"../models/glossaryShell/residents":{id:()=>83948,module:()=>a.A(83948)},"../models/glossaryShell/residents.jsx":{id:()=>83948,module:()=>a.A(83948)},"../models/glossaryShell/segregation":{id:()=>13600,module:()=>a.A(13600)},"../models/glossaryShell/segregation.jsx":{id:()=>13600,module:()=>a.A(13600)},"../models/glossaryShell/sustainability":{id:()=>19035,module:()=>a.A(19035)},"../models/glossaryShell/sustainability.jsx":{id:()=>19035,module:()=>a.A(19035)},"../models/glossaryShell/typology":{id:()=>88313,module:()=>a.A(88313)},"../models/glossaryShell/typology.jsx":{id:()=>88313,module:()=>a.A(88313)},"../models/glossaryShell/urban-informality":{id:()=>20105,module:()=>a.A(20105)},"../models/glossaryShell/urban-informality.jsx":{id:()=>20105,module:()=>a.A(20105)},"../models/glossaryShell/urban-planning":{id:()=>13793,module:()=>a.A(13793)},"../models/glossaryShell/urban-planning.jsx":{id:()=>13793,module:()=>a.A(13793)},"../models/glossaryShell/urban-renewal":{id:()=>1550,module:()=>a.A(1550)},"../models/glossaryShell/urban-renewal.jsx":{id:()=>1550,module:()=>a.A(1550)},"../models/glossaryShell/waste":{id:()=>20442,module:()=>a.A(20442)},"../models/glossaryShell/waste.jsx":{id:()=>20442,module:()=>a.A(20442)},"../models/glossaryShell/zones-zoning":{id:()=>14596,module:()=>a.A(14596)},"../models/glossaryShell/zones-zoning.jsx":{id:()=>14596,module:()=>a.A(14596)}}).import(`../models/glossaryShell/${d}`),c=d}catch(a){throw a}}let d=c.split(/[-_]/).map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join("");fu[c]=b.default||b[d]||Object.values(b).find(a=>"function"==typeof a)}catch(a){return console.warn(`Could not load glossary shell for ${c}:`,a),null}return fu[c]};a.s(["default",0,()=>{let[a]=(0,ch.useStore)("cameraOptions"),[b]=(0,ch.useStore)("livingContinuity_sceneRotation",!1),[c,d]=(0,ch.useStore)("walkThroughActive",!1),[e,f]=(0,l.useState)(!0),[g,h]=(0,l.useState)(!0),[i,k]=(0,l.useState)(""),[n,o]=(0,l.useState)(null),[p,q]=(0,l.useState)(null),[s,t]=(0,l.useState)({}),[u,v]=(0,l.useState)({}),[w]=(0,ch.useStore)("selectedNodeStore",null),[x]=(0,ch.useStore)("cameraInteractionStore",!1),[y,z]=(0,l.useState)(!1),[A,B]=(0,l.useState)(!0),[C,D]=(0,l.useState)(!1),[E]=(0,l.useState)(()=>{let a;return[28*Math.cos(a=Math.random()*Math.PI*2),6,28*Math.sin(a)]});(0,l.useEffect)(()=>{fetch(`/data/nodes.json?t=${Date.now()}`).then(a=>{if(!a.ok)throw Error(`HTTP error! status: ${a.status}`);return a.json()}).then(a=>{var b;let c;(0,l.startTransition)(()=>{let b,c,d,e,f,g;o(a),q((b=[],c=[],d=new Map,e=a.articles?.length||0,g=e+(f=a.glossary?.length||0),a.articles&&a.articles.forEach((a,c)=>{let h=co(c,g,15,e,f),i={...a,type:"article",position:h,x:h[0],y:h[1],z:h[2],vx:0,vy:0,vz:0,fx:null,fy:null,fz:null};b.push(i),d.set(a.id,i)}),a.glossary&&a.glossary.forEach((a,c)=>{let h=co(e+c,g,15,e,f),i={...a,type:"glossary",position:h,x:h[0],y:h[1],z:h[2],vx:0,vy:0,vz:0,fx:null,fy:null,fz:null};b.push(i),d.set(a.id,i)}),b.forEach(a=>{a.connections&&a.connections.length>0&&a.connections.forEach(b=>{let e=d.get(b);e&&c.push({source:a.id,target:b,sourceNode:a,targetNode:e})})}),{nodes:b,links:c,nodeMap:d}))}),b=(a.articles?.length||0)+(a.glossary?.length||0),(c=(0,ch.getStore)("loadingState"))&&c.setState({nodesLoaded:0,totalNodes:b,isLoading:!0,nodesVisible:[]});let d=a=>{setTimeout(a,100)},e=async()=>{let b=a.articles||[],c=a.glossary||[],e=async(a,b,c,e)=>{for(let f=0;f<a.length;f+=5)await new Promise(g=>{d(async()=>{let d=a.slice(f,f+5),h=await Promise.allSettled(d.map(async a=>{try{let c=await b(a);return{id:a.id,component:c}}catch(b){return console.warn(`Failed to load ${e} component for ${a.id}:`,b),{id:a.id,component:null}}}));(0,l.startTransition)(()=>{c(a=>{let b={...a};return h.forEach(a=>{"fulfilled"===a.status&&a.value?.component&&(b[a.value.id]=a.value.component)}),b})}),setTimeout(g,50)})})};await Promise.all([e(b,a=>a.selectedModelPath?fw(a.id):Promise.resolve(null),t,"article"),e(c,a=>a.glossaryShellPath?fx(a.glossaryShellPath):Promise.resolve(null),v,"glossary")]),fd()};d(()=>{a&&(a.articles&&a.articles.forEach(a=>{a.modelPath&&""!==a.modelPath.trim()&&fq(a.modelPath)}),a.glossary&&a.glossary.forEach(a=>{a.modelPath&&""!==a.modelPath.trim()&&fq(a.modelPath)})),(function(a){if(!a)return Promise.resolve();let b=[],c=a.articles||[];for(let a=0;a<c.length;a+=6)c.slice(a,a+6).forEach(a=>{if(a.imageUrl){let c=new Image;c.crossOrigin="anonymous";let d=new Promise(b=>{c.onload=b,c.onerror=b,c.src=a.imageUrl});b.push(d)}}),a+6<c.length&&b.push(new Promise(a=>setTimeout(a,10)));return Promise.allSettled(b)})(a).catch(()=>{})}),d(()=>{e().catch(a=>{console.error("Error loading components:",a),fd()})})}).catch(a=>{console.error("Failed to load node data:",a),(0,l.startTransition)(()=>{o({articles:[],glossary:[]}),q({nodes:[],links:[],nodeMap:new Map})})})},[]),(0,l.useEffect)(()=>{let a,b=setTimeout(()=>{z(!0),a=setTimeout(()=>{B(!1)},20)},10);return()=>{clearTimeout(b),a&&clearTimeout(a)}},[]),(0,l.useEffect)(()=>{},[]);let F=(0,l.useCallback)(()=>{h(a=>!a)},[]);(0,l.useEffect)(()=>{let a=a=>{"Enter"===a.key&&g&&F()};return window.addEventListener("keydown",a),()=>{window.removeEventListener("keydown",a)}},[g,F]),(0,l.useEffect)(()=>{if(!g&&p&&n){let a=setTimeout(()=>{d(!0)},8e3);return()=>clearTimeout(a)}},[g,p,n,d]);let G=(0,l.useMemo)(()=>{if(!n)return{};let a={};return n.articles.forEach(b=>{a[b.id]=()=>k(b.title)}),n.glossary.forEach(b=>{a[b.id]=()=>k(b.title||"")}),a},[n]),H=(0,l.useCallback)(()=>k(""),[]),I=l.default.memo(()=>{let{scene:a}=(0,m.useThree)();return(0,l.useEffect)(()=>{a.background=new r.Color(1842204)},[a]),null});I.displayName="SceneBackground";let J=l.default.memo(({cameraOptions:a})=>{let b=(0,m.useThree)(),[c]=(0,ch.useStore)("selectedNodeStore",null);return(0,l.useEffect)(()=>{if(c||!a||!fv)return;let d={top:[.267,14.68,.6],reset:[5.29,-1.59,6],overview:[0,6,18]}[a];d&&(b.camera.position.set(...d),b.camera.lookAt(0,0,0),b.camera.updateProjectionMatrix())},[a,b.camera,c]),null}),K=l.default.memo(({initialPosition:a})=>{let{camera:b,set:c}=(0,m.useThree)(),d=l.default.useRef(a);return(0,l.useEffect)(()=>{if(!fv&&d.current){let a=setTimeout(()=>{fv||(b.position.set(...d.current),b.lookAt(0,0,0),b.updateProjectionMatrix(),c({camera:b}),fv=!0)},50);return()=>clearTimeout(a)}},[]),null});return K.displayName="InitialCameraSetup",J.displayName="CameraDolly",(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(cD.default,{isOpen:g,contentLabel:"Welcome Modal",shouldCloseOnOverlayClick:!0,shouldCloseOnEsc:!1,ariaHideApp:!1,className:"welcomeModalContent",overlayClassName:"welcomeModalOverlay",onRequestClose:F,closeTimeoutMS:150,preventScroll:!0,children:(0,j.jsx)("div",{onClick:F,children:(0,j.jsx)(cM,{onClick:F})})}),(!p||!n)&&(0,j.jsx)("div",{className:"welcomeLoading",children:"Loading..."}),(0,j.jsx)("div",{className:"welcomeTopbarWrapper",children:(0,j.jsx)(cL,{title:i})}),(0,j.jsx)("div",{className:"welcomeCanvasWrapper",children:(0,j.jsxs)(bR,{frameloop:e||x||A?"always":"demand",children:[(0,j.jsx)(I,{}),(0,j.jsx)(K,{initialPosition:E}),(0,j.jsx)("ambientLight",{intensity:1}),y&&(0,j.jsx)(l.Suspense,{fallback:null,children:(0,j.jsx)(bN,{preset:"city"})}),(0,j.jsx)(J,{cameraOptions:a}),p&&n&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(fr,{nodeData:n,processedData:p,isActive:c}),(0,j.jsx)(cC,{}),(0,j.jsx)(fm,{}),(0,j.jsx)(fn,{}),(0,j.jsx)(fs,{}),n.articles.map(a=>{let b=p.nodeMap.get(a.id);if(!b)return null;let c=s[a.id],d=G[a.id]||H;return(0,j.jsx)(l.Suspense,{fallback:null,children:(0,j.jsx)(fh,{nodeData:b,showAllLines:!1,setTitle:d,setDefault:H,selectedComponent:c})},a.id)}),n.glossary.map(a=>{let b=p.nodeMap.get(a.id);if(!b)return null;let c=u[a.id],d=G[a.id]||H;return(0,j.jsx)(l.Suspense,{fallback:null,children:(0,j.jsx)(fl,{nodeData:b,showAllLines:!1,title:a.title,setTitle:d,setDefault:H,glossaryShellComponent:c})},a.id)}),(0,j.jsx)(cB,{processedData:p})]}),(0,j.jsx)(bO.default,{autoRotate:!!b&&!c,autoRotateSpeed:.5,minDistance:1,maxDistance:60,enableDamping:!0,dampingFactor:.08,enablePan:!0,makeDefault:!1,rotateSpeed:.8,panSpeed:.8,zoomSpeed:.8,enableRotate:!0})]})})]})},"dynamic",0,"force-dynamic"],30100)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__cc254b0a._.js.map